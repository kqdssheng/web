<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Linux/Tcpdump 使用指南" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Tcpdump 使用指南 | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/web/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/web/docs/Linux/Tcpdump 使用指南"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Tcpdump 使用指南 | 扛枪的书生"><meta data-rh="true" name="description" content="论网络数据包的分析，我首选wireshark，因为图形化界面直观明了。但如果遇到没有图形化显示的Linux环境，那么此时会使用tcpdump该是一件多么美好的事情。"><meta data-rh="true" property="og:description" content="论网络数据包的分析，我首选wireshark，因为图形化界面直观明了。但如果遇到没有图形化显示的Linux环境，那么此时会使用tcpdump该是一件多么美好的事情。"><link data-rh="true" rel="icon" href="/web/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/web/docs/Linux/Tcpdump 使用指南"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/Linux/Tcpdump 使用指南" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/web/docs/Linux/Tcpdump 使用指南" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/web/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/web/blog/atom.xml" title="扛枪的书生 Atom Feed"><link rel="stylesheet" href="/web/assets/css/styles.b7abb307.css">
<script src="/web/assets/js/runtime~main.53f73fdc.js" defer="defer"></script>
<script src="/web/assets/js/main.fc57339d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/web/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/web/"><div class="navbar__logo"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/web/docs/category/️渗透">文章</a><a class="navbar__item navbar__link" href="/web/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/web/"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/web/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/️渗透">🕵️渗透</a><button aria-label="展开侧边栏分类 &#x27;🕵️渗透&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/web/docs/category/linux">🐧Linux</a><button aria-label="折叠侧边栏分类 &#x27;🐧Linux&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/Linux/Linux 特权 SUID_SGID 的详解">Linux 特权 SUID_SGID 的详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/Linux/OpenSSL 命令总结">OpenSSL 命令总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/Linux/Socat 命令总结">Socat 命令总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/web/docs/Linux/Tcpdump 使用指南">Tcpdump 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/web/docs/Linux/基于 Linux 的三种防火墙（IPtables、Firewall、UFW）">基于 Linux 的三种防火墙（IPtables、Firewall、UFW）</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/windows">💻Windows</a><button aria-label="展开侧边栏分类 &#x27;💻Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/杂项-1">📦杂项</a><button aria-label="展开侧边栏分类 &#x27;📦杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/web/docs/category/gpt-问答">🤖GPT 问答</a><button aria-label="展开侧边栏分类 &#x27;🤖GPT 问答&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/web/docs/">🛠️软件百宝箱</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/web/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/web/docs/category/linux"><span itemprop="name">🐧Linux</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Tcpdump 使用指南</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Tcpdump 使用指南</h1></header><blockquote>
<p>论网络数据包的分析，我首选wireshark，因为图形化界面直观明了。但如果遇到没有图形化显示的Linux环境，那么此时会使用tcpdump该是一件多么美好的事情。</p>
<p>网上关于tcpdump的介绍很多，但只有作者王炳明的这篇文章我甚是喜爱，便特此转录<a href="https://mp.weixin.qq.com/s/Txb6PeQzNest1lLNgIhdCQ" target="_blank" rel="noopener noreferrer">原文</a>。</p>
<p>注：本文的精髓在于介绍tcpdump语法的<a href="https://img2023.cnblogs.com/blog/1503193/202303/1503193-20230306234023292-1084143854.png" target="_blank" rel="noopener noreferrer">那张图</a>。</p>
</blockquote>
<hr>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="导航"><strong>导航</strong><a href="#导航" class="hash-link" aria-label="导航的直接链接" title="导航的直接链接">​</a></h2>
<ul>
<li>
<p><a href="#yi">壹 - tcpdump 核心参数图解</a></p>
</li>
<li>
<p><a href="#er">贰 - 理解 tcpdump 的输出</a></p>
</li>
<li>
<p><a href="#san">叁 - 常规过滤规则</a></p>
</li>
<li>
<p><a href="#si">肆 - 可选参数解析</a></p>
</li>
<li>
<p><a href="#wu">伍 - 过滤规则组合</a></p>
</li>
<li>
<p><a href="#liu">陆 - 特殊过滤规则</a></p>
</li>
<li>
<p><a href="#qi">柒 - 如何抓取到更精准的包？</a></p>
</li>
<li>
<p><a href="#ba">捌 - 抓包实战应用例子</a></p>
</li>
</ul>
<hr>
<p>在讲解 Tcpdump 之前，有以下两点需要声明：</p>
<ol>
<li>
<p>第三节到第六节里的 tcpdump 命令示例，只为了说明参数的使用，并不一定就能抓到包，如果要精准抓到你所需要的包，需要配合第五节的逻辑逻辑运算符进行组合搭配。</p>
</li>
<li>
<p>不同 Linux 发行版下、不同版本的 tcpdump 可能有小许差异， 本文是基于 CentOS 7.2 的 4.5.1 版本的tcpdump 进行学习的，若在你的环境中无法使用，请参考 man tcpdump 进行针对性学习。</p>
</li>
</ol>
<hr>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVQAAAA5CAMAAABeUSO3AAAClFBMVEUAAAAAAAAAAAAAAAAAAADRABfPAA7PAA3PAA7QAA7RAA7RAA7QAA8kGBgiFxckGRQjFxYjGBUjGBUjGBYkGBUlGxUkGxIkGRQkFxUiGBUkGBUjFxUjFxQhFhYzAAAAAAAgFRUhGBMkGBUkFxUjGRUjGRUiGBXVAAvPAA3QAA7QAA7dAA8WFhYiGBUjGBUjGBUjGBUjGBUjGBUjGRQjGhYjGBUjFxUjGBbRAA/QAA68AAsxFBQgGRUjGBUjGBUjGBYjGBYiGBUjGBUjGBUAAAAiGRTQAA3PAA7QAA/QAA7SAAvRAA3cAA4ZGhUjGBUgGhMkEhIjFxclGRMkGRYjGBUjGRUiGRQnFBQcHA4jGRQkGRYiGBUjGBUkFxQkGhUkGhQjGRQjGBUjGBXNAA7QAA7PAA4cGBQiGRUaGhojGBUkFxQjFxUjFxUkGRUjFxXPAA3QAA8jFxUkGBUjGBYjGBUiGRYkGBQjGBUkFxckGBbRAA7PABAjGBQjGBUjGBUkGBhAAAAjGBUhFhYrKwAjFxUjGRbQAA4lFxckFxUjGBUjGhIjGBUhFhYjGBQjGBYjFxXQAA7QAA8jGBUrFRUjGBQnFxcjGBUjGRXQAA/MABHfAADVABCAAAAhHBYiGBQmGhokJCQuFxckFhYjGBUiGRYkGBUjGBXQAA/QAA7QAA7QAA7QAA7YAA//AAAbGRYjGBUjGBUgGBQiGBUjGBUiFxQjGBUjGBXQABDQAA7aAA0ZGRUjGBUkGBYjGBYjGBUjGBUkGBQjFxMjGBWqAADRAA7QAA7QAA3QAA7aAA8UFBQhGRUiFxYiGBUkGBIiGBYiGBMjFxYkGBUAAAAAAAAAAAAAAAAAAADQAA4jGBXUAA4iGBUAAAA9VFD3AAAA13RSTlMAn9k6dAs1YJCflW9GFURxmZ+TdlUwHHKPn56DWC8FARg2VHmbfEoYhtj+NBeV5uJg+85nO+rkdVToFxra8/L51Xfx9QJbYrFWNi1NbJutKA4WKUZJkHANEjOlYetNMTJl7Ock9Eq8hgqoTsSE0O+FiVezdL9Slr447cZAQdHGKwTSRQauUdU3erUd8BfUjG2pnMcM4CHdha4PCDACLn8UBwsj/WidzHjy6e355AFd998/9Pxa+rhSytNv44Be/sJAQtgDOGyYgUUNPY6UKmk1mohL4Q8zLXavYF8AAALFSURBVHja7djXUxNRFAbwgwqCSlmwohgbYlcUsGJEExULYkRARBDEggqKKIooINiwgAWxi2Lvvffee9lP/WecCwFnA0/M3Nkd5vxeds/NfdjzzeTmbIgYY4wxxhhjjDHG5HNqZNdY7ydpQDhUCZo4CRyqBByqBByqBByqBByqBByqBByqBByqBByqBByqBHWE6uzS1NWtWfMWzkTk7uHppXj7tGxFrdu0befbvoNfR7HF1Klzl67dFP/u7no/vyHVCjWgR89eaqXe1KdvP1TpbxpQdRM4cBARBQXb10MG692AETmGOmSoavd72PARIrfQkWZgFIUB5tFjxIKXhayo4al3BwbkEOpYEee48eETXCZOoskAIqZERk61TYui6UB0TOyMOAAzKRqIn5WQODsJSNa7AwPShjonRVVT5lZX8wDMX2AvUoGF4hoBLKLFQJoorEC63h0YkDbUJaqqLq2pMsTXO2lZpp8olgNB4roCSLZkAStFsQrI1rsDA9KGulpV1Zz/5Zq1Vedmbh7lr0OgTawVAMGF64E4UWzgUOuiDXWjNlSiTZuL0gHEbykMwdZtYsUH2G7KBYpFUcKh1kUb6g5VVXc67IjZBcC6OxSl4njdEwJkURmQKT7bC5Tq3YEBaUPNET/++8L3H3AOOHjo8JHE8qOWYwViVg2qOI40i6n8RDBgrohJB6xi/0nglN4dGJDDSHW6ckQ9c/bc+QsXL/3B5eQr2eJQTTVdBcxlZdcAXL9BtpuAh9heBNzSuwMDchz+b9+xz/536V71fH//QT49tN8/evyE6CmABPG2+gxI1bsDA6r1mvr8xUtXN7dXr9/Q23cl7xXlQ1hULBF99PdWFN/iT5/FnkRF+SLe+vO/KkqG3h0YEP9LJQGHKoEm1G9/6+O73j0YDocqgSbUHz/r45fePTDGGGOMMcYYY4wxxhqqf3tPqViAXoWSAAAAAElFTkSuQmCC" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="壹---tcpdump-核心参数图解"><strong><div id="yi">壹 - tcpdump 核心参数图解</div></strong><a href="#壹---tcpdump-核心参数图解" class="hash-link" aria-label="壹---tcpdump-核心参数图解的直接链接" title="壹---tcpdump-核心参数图解的直接链接">​</a></h2>
<p>大家都知道，网络上的流量、数据包，非常的多，因此要想抓到我们所需要的数据包，就需要我们定义一个精准的过滤器，把这些目标数据包，从巨大的数据包网络中抓取出来。</p>
<p>所以学习抓包工具，其实就是学习如何定义过滤器的过程。</p>
<p>而在 tcpdump 的世界里，过滤器的实现，都是通过一个又一个的参数组合起来，一个参数不够精准，那就再加一个，直到我们能过滤掉无用的数据包，只留下我们感兴趣的数据包。</p>
<p>tcpdump 的参数非常的多，初学者在没有掌握 tcpdump 时，会对这个命令的众多参数产生很多的疑惑。</p>
<p>就比如下面这个命令，我们要通过 <code>host</code> 参数指定 host ip 进行过滤</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump host 192.168.10.100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><code>主程序</code> + <code>参数名</code>+ <code>参数值</code>  这样的组合才是我们正常认知里面命令行该有的样子。</p>
<p>可 tcpdump 却不走寻常路，我们居然还可以在 host 前再加一个限定词，来缩小过滤的范围？</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump src host 192.168.10.100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从字面上理解，确实很容易理解，但是这不符合编写命令行程序的正常逻辑，导致我们会有所疑虑：</p>
<ol>
<li>
<p>除了 src ，dst，可还有其它可以用的限定词？</p>
</li>
<li>
<p>src，host 应该如何理解它们，叫参数名？不合适，因为 src 明显不合适。</p>
</li>
</ol>
<p>如果你在网上看到有关 tcpdump 的博客、教程，无一不是给你一个参数组合，告诉你这是实现了怎样的一个过滤器？这样的教学方式，很容易让你依赖别人的文章来使用 tcpdump，而不能将 tcpdump 这样神器消化，达到灵活应用，灵活搭配过滤器的效果。</p>
<p>上面加了 src 本身就颠覆了我们的认知，你可知道在 src 之前还可以加更多的条件，比如 tcp, udp, icmp 等词，在你之前的基础上再过滤一层。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump tcp src host 192.168.10.100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这种参数的不确定性，让大多数人对 tcpdump 的学习始终无法得其精髓。</p>
<p>因此，在学习 tcpdump 之前，我觉得有必要要先让你知道：<strong>tcpdump 的参数是如何组成的？这非常重要。</strong></p>
<p>为此，我画了一张图，方便你直观的理解 tcpdump 的各种参数：</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/web/assets/images/1503193-20230306234023292-1084143854-6d1cb38e2a246a7e7a5673cde61cc45a.png" width="757" height="364" class="img_ev3q"></p>
<ol>
<li>
<p>option 可选参数：将在后边一一解释，对应本文 <strong>第四节：可选参数解析</strong></p>
</li>
<li>
<p>proto 类过滤器：根据协议进行过滤，可识别的关键词有：upd, udp, icmp, ip, ip6, arp, rarp,ether,wlan, fddi, tr, decnet</p>
</li>
<li>
<p>type 类过滤器：可识别的关键词有：host, net, port, portrange，这些词后边需要再接参数。</p>
</li>
<li>
<p>direction 类过滤器：根据数据流向进行过滤，可识别的关键字有：src, dst，同时你可以使用逻辑运算符进行组合，比如 src or dst</p>
</li>
</ol>
<p>proto、type、direction 这三类过滤器的内容比较简单，也最常用，因此我将其放在最前面，也就是 <strong>第三节：常规过滤规则</strong>一起介绍。</p>
<p>而 option 可选的参数非常多，有的甚至也不经常用到，因此我将其放到后面一点，也就是 <strong>第四节：可选参数解析</strong></p>
<p>当你看完前面六节，你对 tcpdump 的认识会上了一个台阶，至少能够满足你 80% 的使用需求。</p>
<p><strong>你一定会问了，还有 20% 呢？</strong></p>
<p>其实 tcpdump 还有一些过滤关键词，它不符合以上四种过滤规则，可能需要你单独记忆。关于这部分我会在  <strong>第六节：特殊过滤规则</strong>  里进行介绍。</p>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="贰---理解-tcpdump-的输出"><strong><div id="er">贰 - 理解 tcpdump 的输出</div></strong><a href="#贰---理解-tcpdump-的输出" class="hash-link" aria-label="贰---理解-tcpdump-的输出的直接链接" title="贰---理解-tcpdump-的输出的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21-输出内容结构">2.1 输出内容结构<a href="#21-输出内容结构" class="hash-link" aria-label="2.1 输出内容结构的直接链接" title="2.1 输出内容结构的直接链接">​</a></h3>
<p>tcpdump 输出的内容虽然多，却很规律。</p>
<p>这里以我随便抓取的一个 tcp 包为例来看一下</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">21:26:49.013621 IP 172.20.20.1.15605 &gt; 172.20.20.2.5920: Flags [P.], seq 49:97, ack 106048, win 4723, length 48</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>从上面的输出来看，可以总结出：</p>
<ol>
<li>
<p>第一列：时分秒毫秒 21:26:49.013621</p>
</li>
<li>
<p>第二列：网络协议 IP</p>
</li>
<li>
<p>第三列：发送方的ip地址+端口号，其中172.20.20.1是 ip，而15605 是端口号</p>
</li>
<li>
<p>第四列：箭头 &gt;， 表示数据流向</p>
</li>
<li>
<p>第五列：接收方的ip地址+端口号，其中 172.20.20.2 是 ip，而5920 是端口号</p>
</li>
<li>
<p>第六列：冒号</p>
</li>
<li>
<p>第七列：数据包内容，包括Flags 标识符，seq 号，ack 号，win 窗口，数据长度 length，其中 [P.] 表示 PUSH 标志位为 1，更多标识符见下面</p>
</li>
</ol>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22-flags-标识符">2.2 Flags 标识符<a href="#22-flags-标识符" class="hash-link" aria-label="2.2 Flags 标识符的直接链接" title="2.2 Flags 标识符的直接链接">​</a></h3>
<p>使用 tcpdump 抓包后，会遇到的 TCP 报文 Flags，有以下几种：</p>
<ul>
<li>
<p><code>[S]</code> : SYN（开始连接）</p>
</li>
<li>
<p><code>[P]</code> : PSH（推送数据）</p>
</li>
<li>
<p><code>[F]</code> : FIN （结束连接）</p>
</li>
<li>
<p><code>[R]</code> : RST（重置连接）</p>
</li>
<li>
<p><code>[.]</code> : 没有 Flag，由于除了 SYN 包外所有的数据包都有ACK，所以一般这个标志也可表示 ACK</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="叁---常规过滤规则"><strong><div id="san">叁 - 常规过滤规则</div></strong><a href="#叁---常规过滤规则" class="hash-link" aria-label="叁---常规过滤规则的直接链接" title="叁---常规过滤规则的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31-基于ip地址过滤host">3.1 基于IP地址过滤：host<a href="#31-基于ip地址过滤host" class="hash-link" aria-label="3.1 基于IP地址过滤：host的直接链接" title="3.1 基于IP地址过滤：host的直接链接">​</a></h3>
<p>使用 <code>host</code> 就可以指定 host ip 进行过滤</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump host 192.168.10.100</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>数据包的 ip 可以再细分为源ip和目标ip两种</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 根据源ip进行过滤$ tcpdump -i eth2 src 192.168.10.100# 根据目标ip进行过滤$ tcpdump -i eth2 dst 192.168.10.200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32-基于网段进行过滤net">3.2 基于网段进行过滤：net<a href="#32-基于网段进行过滤net" class="hash-link" aria-label="3.2 基于网段进行过滤：net的直接链接" title="3.2 基于网段进行过滤：net的直接链接">​</a></h3>
<p>若你的ip范围是一个网段，可以直接这样指定</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump net 192.168.10.0/24</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>网段同样可以再细分为源网段和目标网段</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 根据源网段进行过滤$ tcpdump src net 192.168# 根据目标网段进行过滤$ tcpdump dst net 192.168</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="33-基于端口进行过滤port">3.3 基于端口进行过滤：port<a href="#33-基于端口进行过滤port" class="hash-link" aria-label="3.3 基于端口进行过滤：port的直接链接" title="3.3 基于端口进行过滤：port的直接链接">​</a></h3>
<p>使用 <code>port</code> 就可以指定特定端口进行过滤</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump port 8088</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>端口同样可以再细分为源端口，目标端口</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 根据源端口进行过滤$ tcpdump src port 8088# 根据目标端口进行过滤$ tcpdump dst port 8088</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你想要同时指定两个端口你可以这样写</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump port 80 or port 8088</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>但也可以简写成这样</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump port 80 or 8088</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果你的想抓取的不再是一两个端口，而是一个范围，一个一个指定就非常麻烦了，此时你可以这样指定一个端口段。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump portrange 8000-8080$ tcpdump src portrange 8000-8080$ tcpdump dst portrange 8000-8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>对于一些常见协议的默认端口，我们还可以直接使用协议名，而不用具体的端口号</p>
<p>比如 http  == 80，https == 443 等</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump tcp port http</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="34-基于协议进行过滤proto">3.4 基于协议进行过滤：proto<a href="#34-基于协议进行过滤proto" class="hash-link" aria-label="3.4 基于协议进行过滤：proto的直接链接" title="3.4 基于协议进行过滤：proto的直接链接">​</a></h3>
<p>常见的网络协议有：tcp, udp, icmp, http, ip,ipv6 等</p>
<p>若你只想查看 icmp 的包，可以直接这样写</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump icmp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>protocol 可选值：ip, ip6, arp, rarp, atalk, aarp, decnet, sca, lat, mopdl,  moprc,  iso,  stp, ipx,  or  netbeui</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="35-基本ip协议的版本进行过滤">3.5 基本IP协议的版本进行过滤<a href="#35-基本ip协议的版本进行过滤" class="hash-link" aria-label="3.5 基本IP协议的版本进行过滤的直接链接" title="3.5 基本IP协议的版本进行过滤的直接链接">​</a></h3>
<p>当你想查看 tcp 的包，你也许会这样子写</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump tcp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这样子写也没问题，就是不够精准，为什么这么说呢？</p>
<p>ip 根据版本的不同，可以再细分为 IPv4 和 IPv6 两种，如果你只指定了 tcp，这两种其实都会包含在内。</p>
<p>那有什么办法，能够将 IPv4 和 IPv6 区分开来呢？</p>
<p>很简单，如果是 IPv4 的 tcp 包 ，就这样写（友情提示：数字 6 表示的是 tcp 在ip报文中的编号。）</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump &#x27;ip proto tcp&#x27;# or$ tcpdump ip proto 6# or$ tcpdump &#x27;ip protochain tcp&#x27;# or $ tcpdump ip protochain 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>而如果是 IPv6 的 tcp 包 ，就这样写</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump &#x27;ip6 proto tcp&#x27;# or$ tcpdump ip6 proto 6# or$ tcpdump &#x27;ip6 protochain tcp&#x27;# or $ tcpdump ip6 protochain 6</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>关于上面这几个命令示例，有两点需要注意：</p>
<ol>
<li>
<p>跟在 proto 和 protochain 后面的如果是 tcp, udp, icmp ，那么过滤器需要用引号包含，这是因为 tcp,udp, icmp 是 tcpdump 的关键字。</p>
</li>
<li>
<p>跟在ip 和 ip6 关键字后面的 proto 和 protochain 是两个新面孔，看起来用法类似，它们是否等价，又有什么区别呢？</p>
</li>
</ol>
<p>关于第二点，网络上没有找到很具体的答案，我只能通过 <code>man tcpdump</code> 的提示， 给出自己的个人猜测，但不保证正确。</p>
<p>proto 后面跟的 <code>&lt;protocol&gt;</code> 的关键词是固定的，只能是 ip, ip6, arp, rarp, atalk, aarp, decnet, sca, lat, mopdl,  moprc,  iso,  stp, ipx,  or  netbeui 这里面的其中一个。</p>
<p>而 protochain 后面跟的 protocol 要求就没有那么严格，它可以是任意词，只要 tcpdump 的 IP 报文头部里的 protocol 字段为 <code>&lt;protocol&gt;</code> 就能匹配上。</p>
<p>理论上来讲，下面两种写法效果是一样的</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump &#x27;ip &amp;&amp; tcp&#x27;$ tcpdump &#x27;ip proto tcp&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>同样的，这两种写法也是一样的</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump &#x27;ip6 &amp;&amp; tcp&#x27;$ tcpdump &#x27;ip6 proto tcp&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="肆---可选参数解析"><strong><div id="si">肆 - 可选参数解析</div></strong><a href="#肆---可选参数解析" class="hash-link" aria-label="肆---可选参数解析的直接链接" title="肆---可选参数解析的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="41-设置不解析域名提升速度">4.1 设置不解析域名提升速度<a href="#41-设置不解析域名提升速度" class="hash-link" aria-label="4.1 设置不解析域名提升速度的直接链接" title="4.1 设置不解析域名提升速度的直接链接">​</a></h3>
<ul>
<li>
<p><code>-n</code>：不把ip转化成域名，直接显示  ip，避免执行 DNS lookups 的过程，速度会快很多</p>
</li>
<li>
<p><code>-nn</code>：不把协议和端口号转化成名字，速度也会快很多。</p>
</li>
<li>
<p><code>-N</code>：不打印出host 的域名部分.。比如,，如果设置了此选现，tcpdump 将会打印&#x27;nic&#x27; 而不是 &#x27;nic.ddn.mil&#x27;.</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="42-过滤结果输出到文件">4.2 过滤结果输出到文件<a href="#42-过滤结果输出到文件" class="hash-link" aria-label="4.2 过滤结果输出到文件的直接链接" title="4.2 过滤结果输出到文件的直接链接">​</a></h3>
<p>使用 tcpdump 工具抓到包后，往往需要再借助其他的工具进行分析，比如常见的 wireshark 。</p>
<p>而要使用wireshark ，我们得将 tcpdump 抓到的包数据生成到文件中，最后再使用 wireshark 打开它即可。</p>
<p>使用 <code>-w</code> 参数后接一个以 <code>.pcap</code> 后缀命令的文件名，就可以将 tcpdump 抓到的数据保存到文件中。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump icmp -w icmp.pcap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="43-从文件中读取包数据">4.3 从文件中读取包数据<a href="#43-从文件中读取包数据" class="hash-link" aria-label="4.3 从文件中读取包数据的直接链接" title="4.3 从文件中读取包数据的直接链接">​</a></h3>
<p>使用 <code>-w</code> 是写入数据到文件，而使用 <code>-r</code> 是从文件中读取数据。</p>
<p>读取后，我们照样可以使用上述的过滤器语法进行过滤分析。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump icmp -r all.pcap</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="44-控制详细内容的输出">4.4 控制详细内容的输出<a href="#44-控制详细内容的输出" class="hash-link" aria-label="4.4 控制详细内容的输出的直接链接" title="4.4 控制详细内容的输出的直接链接">​</a></h3>
<ul>
<li>
<p><code>-v</code>：产生详细的输出. 比如包的TTL，id标识，数据包长度，以及IP包的一些选项。同时它还会打开一些附加的包完整性检测，比如对IP或ICMP包头部的校验和。</p>
</li>
<li>
<p><code>-vv</code>：产生比-v更详细的输出. 比如NFS回应包中的附加域将会被打印, SMB数据包也会被完全解码。（摘自网络，目前我还未使用过）</p>
</li>
<li>
<p><code>-vvv</code>：产生比-vv更详细的输出。比如 telent 时所使用的SB, SE 选项将会被打印, 如果telnet同时使用的是图形界面，其相应的图形选项将会以16进制的方式打印出来（摘自网络，目前我还未使用过）</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="45-控制时间的显示">4.5 控制时间的显示<a href="#45-控制时间的显示" class="hash-link" aria-label="4.5 控制时间的显示的直接链接" title="4.5 控制时间的显示的直接链接">​</a></h3>
<ul>
<li>
<p><code>-t</code>：在每行的输出中不输出时间</p>
</li>
<li>
<p><code>-tt</code>：在每行的输出中会输出时间戳</p>
</li>
<li>
<p><code>-ttt</code>：输出每两行打印的时间间隔(以毫秒为单位)</p>
</li>
<li>
<p><code>-tttt</code>：在每行打印的时间戳之前添加日期的打印（此种选项，输出的时间最直观）</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="46-显示数据包的头部">4.6 显示数据包的头部<a href="#46-显示数据包的头部" class="hash-link" aria-label="4.6 显示数据包的头部的直接链接" title="4.6 显示数据包的头部的直接链接">​</a></h3>
<ul>
<li>
<p><code>-x</code>：以16进制的形式打印每个包的头部数据（但不包括数据链路层的头部）</p>
</li>
<li>
<p><code>-xx</code>：以16进制的形式打印每个包的头部数据（包括数据链路层的头部）</p>
</li>
<li>
<p><code>-X</code>：以16进制和 ASCII码形式打印出每个包的数据(但不包括连接层的头部)，这在分析一些新协议的数据包很方便。</p>
</li>
<li>
<p><code>-XX</code>：以16进制和 ASCII码形式打印出每个包的数据(包括连接层的头部)，这在分析一些新协议的数据包很方便。</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="47-过滤指定网卡的数据包">4.7 过滤指定网卡的数据包<a href="#47-过滤指定网卡的数据包" class="hash-link" aria-label="4.7 过滤指定网卡的数据包的直接链接" title="4.7 过滤指定网卡的数据包的直接链接">​</a></h3>
<ul>
<li><code>-i</code>：指定要过滤的网卡接口，如果要查看所有网卡，可以 <code>-i any</code></li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="48-过滤特定流向的数据包">4.8 过滤特定流向的数据包<a href="#48-过滤特定流向的数据包" class="hash-link" aria-label="4.8 过滤特定流向的数据包的直接链接" title="4.8 过滤特定流向的数据包的直接链接">​</a></h3>
<ul>
<li><code>-Q</code>：选择是入方向还是出方向的数据包，可选项有：in, out, inout，也可以使用  --direction=[direction] 这种写法</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="49-其他常用的一些参数">4.9 其他常用的一些参数<a href="#49-其他常用的一些参数" class="hash-link" aria-label="4.9 其他常用的一些参数的直接链接" title="4.9 其他常用的一些参数的直接链接">​</a></h3>
<ul>
<li>
<p><code>-A</code>：以ASCII码方式显示每一个数据包(不显示链路层头部信息). 在抓取包含网页数据的数据包时, 可方便查看数据</p>
</li>
<li>
<p><code>-l</code> : 基于行的输出，便于你保存查看，或者交给其它工具分析</p>
</li>
<li>
<p><code>-q</code> : 简洁地打印输出。即打印很少的协议相关信息, 从而输出行都比较简短.</p>
</li>
<li>
<p><code>-c</code> : 捕获 count 个包 tcpdump 就退出</p>
</li>
<li>
<p><code>-s</code> :  tcpdump 默认只会截取前 <code>96</code> 字节的内容，要想截取所有的报文内容，可以使用 <code>-s number</code>， <code>number</code> 就是你要截取的报文字节数，如果是 0 的话，表示截取报文全部内容。</p>
</li>
<li>
<p><code>-S</code> : 使用绝对序列号，而不是相对序列号</p>
</li>
<li>
<p><code>-C</code>：file-size，tcpdump 在把原始数据包直接保存到文件中之前, 检查此文件大小是否超过file-size. 如果超过了, 将关闭此文件,另创一个文件继续用于原始数据包的记录. 新创建的文件名与-w 选项指定的文件名一致, 但文件名后多了一个数字.该数字会从1开始随着新创建文件的增多而增加. file-size的单位是百万字节(nt: 这里指1,000,000个字节,并非1,048,576个字节, 后者是以1024字节为1k, 1024k字节为1M计算所得, 即1M=1024 ＊ 1024 ＝ 1,048,576)</p>
</li>
<li>
<p><code>-F</code>：使用file 文件作为过滤条件表达式的输入, 此时命令行上的输入将被忽略.</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="410-对输出内容进行控制的参数">4.10 对输出内容进行控制的参数<a href="#410-对输出内容进行控制的参数" class="hash-link" aria-label="4.10 对输出内容进行控制的参数的直接链接" title="4.10 对输出内容进行控制的参数的直接链接">​</a></h3>
<ul>
<li>
<p><code>-D</code> : 显示所有可用网络接口的列表</p>
</li>
<li>
<p><code>-e</code> : 每行的打印输出中将包括数据包的数据链路层头部信息</p>
</li>
<li>
<p><code>-E</code> : 揭秘IPSEC数据</p>
</li>
<li>
<p><code>-L</code> ：列出指定网络接口所支持的数据链路层的类型后退出</p>
</li>
<li>
<p><code>-Z</code>：后接用户名，在抓包时会受到权限的限制。如果以root用户启动tcpdump，tcpdump将会有超级用户权限。</p>
</li>
<li>
<p><code>-d</code>：打印出易读的包匹配码</p>
</li>
<li>
<p><code>-dd</code>：以C语言的形式打印出包匹配码.</p>
</li>
<li>
<p><code>-ddd</code>：以十进制数的形式打印出包匹配码</p>
</li>
</ul>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="伍---过滤规则组合"><strong><div id="wu">伍 - 过滤规则组合</div></strong><a href="#伍---过滤规则组合" class="hash-link" aria-label="伍---过滤规则组合的直接链接" title="伍---过滤规则组合的直接链接">​</a></h2>
<p>有编程基础的同学，对于下面三个逻辑运算符应该不陌生了吧</p>
<ul>
<li>
<p>and：所有的条件都需要满足，也可以表示为 &amp;&amp;</p>
</li>
<li>
<p>or：只要有一个条件满足就可以，也可以表示为 <code>||</code></p>
</li>
<li>
<p>not：取反，也可以使用 <code>!</code></p>
</li>
</ul>
<p>举个例子，我想需要抓一个来自<code>10.5.2.3</code>，发往任意主机的3389端口的包</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump src 10.5.2.3 and dst port 3389</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>当你在使用多个过滤器进行组合时，有可能需要用到括号，而括号在 shell 中是特殊符号，因为你需要使用引号将其包含。例子如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump &#x27;src 10.0.2.4 and (dst port 3389 or 22)&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>而在单个过滤器里，常常会判断一条件是否成立，这时候，就要使用下面两个符号</p>
<ul>
<li>
<p><code>=</code>：判断二者相等</p>
</li>
<li>
<p><code>==</code>：判断二者相等</p>
</li>
<li>
<p><code>!=</code>：判断二者不相等</p>
</li>
</ul>
<p>当你使用这两个符号时，tcpdump 还提供了一些关键字的接口来方便我们进行判断，比如</p>
<ul>
<li>
<p>if：表示网卡接口名、</p>
</li>
<li>
<p>proc：表示进程名</p>
</li>
<li>
<p>pid：表示进程 id</p>
</li>
<li>
<p>svc：表示 service class</p>
</li>
<li>
<p>dir：表示方向，in 和 out</p>
</li>
<li>
<p>eproc：表示 effective process name</p>
</li>
<li>
<p>epid：表示 effective process ID</p>
</li>
</ul>
<p>比如我现在要过滤来自进程名为 <code>nc</code> 发出的流经 en0 网卡的数据包，或者不流经 en0 的入方向数据包，可以这样子写</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump &quot;( if=en0 and proc =nc ) || (if != en0 and dir=in)&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="陆---特殊过滤规则"><strong><div id="liu">陆 - 特殊过滤规则</div></strong><a href="#陆---特殊过滤规则" class="hash-link" aria-label="陆---特殊过滤规则的直接链接" title="陆---特殊过滤规则的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="61-根据-tcpflags-进行过滤">6.1 根据 tcpflags 进行过滤<a href="#61-根据-tcpflags-进行过滤" class="hash-link" aria-label="6.1 根据 tcpflags 进行过滤的直接链接" title="6.1 根据 tcpflags 进行过滤的直接链接">​</a></h3>
<p>通过TCP报文头部，我们知道了 tcp 的首部有一个标志位。</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/web/assets/images/1503193-20230306234023313-1573647487-7b9c463bab5df0867b60ddbb08aa3dbb.png" title="TCP 报文首部" width="1080" height="872" class="img_ev3q"></p>
<p>TCP 报文首部</p>
<p>tcpdump 支持我们根据数据包的标志位进行过滤</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">proto [ expr:size ]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><code>proto</code>：可以是熟知的协议之一（如ip，arp，tcp，udp，icmp，ipv6）</p>
</li>
<li>
<p><code>expr</code>：可以是数值，也可以是一个表达式，表示与指定的协议头开始处的字节偏移量。</p>
</li>
<li>
<p><code>size</code>：是可选的，表示从字节偏移量开始取的字节数量。</p>
</li>
</ul>
<p>接下来，我将举几个例子，让人明白它的写法，不过在那之前，有几个点需要你明白，这在后面的例子中会用到：</p>
<p>**1、**tcpflags 可以理解为是一个别名常量，相当于 13，它代表着与指定的协议头开头相关的字节偏移量，也就是标志位，所以 tcp[tcpflags] 等价于 tcp[13] ，对应下图中的报文位置。</p>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="496" height="86" class="img_ev3q"></p>
<p>**2、**tcp-fin, tcp-syn, tcp-rst, tcp-push, tcp-ack, tcp-urg 这些同样可以理解为别名常量，分别代表 1，2，4，8，16，32，64。这些数字是如何计算出来的呢？</p>
<p>以 tcp-syn 为例，你可以参照下面这张图，计算出来的值 是就是 2</p>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="814" height="265" class="img_ev3q"></p>
<p>由于数字不好记忆，所以一般使用这样的“别名常量”表示。</p>
<p>因此当下面这个表达式成立时，就代表这个包是一个 syn 包。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tcp[tcpflags] == tcp-syn</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>要抓取特定数据包，方法有很多种。</p>
<p>下面以最常见的 syn包为例，演示一下如何用 tcpdump 抓取到 syn 包，而其他的类型的包也是同样的道理。</p>
<p>据我总结，主要有三种写法：</p>
<p>1、第一种写法：使用数字表示偏移量</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i eth0 &quot;tcp[13] &amp; 2 != 0&quot; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2、第二种写法：使用别名常量表示偏移量</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i eth0 &quot;tcp[tcpflags] &amp; tcp-syn != 0&quot; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3、第三种写法：使用混合写法</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i eth0 &quot;tcp[tcpflags] &amp; 2 != 0&quot; # or$ tcpdump -i eth0 &quot;tcp[13] &amp; tcp-syn != 0&quot; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>如果我想同时捕获多种类型的包呢，比如 syn + ack 包</p>
<p>1、第一种写法</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i eth0 &#x27;tcp[13] == 2 or tcp[13] == 16&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>2、第二种写法</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i eth0 &#x27;tcp[tcpflags] == tcp-syn or tcp[tcpflags] == tcp-ack&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>3、第三种写法</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i eth0 &quot;tcp[tcpflags] &amp; (tcp-syn|tcp-ack) != 0&quot; </span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>4、第四种写法：注意这里是 单个等号，而不是像上面一样两个等号，18（syn+ack） = 2（syn） + 16（ack）</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i eth0 &#x27;tcp[13] = 18&#x27;# or$ tcpdump -i eth0 &#x27;tcp[tcpflags] = 18&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>tcp 中有 类似 tcp-syn 的别名常量，其他协议也是有的，比如 icmp 协议，可以使用的别名常量有</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">icmp-echoreply, icmp-unreach, icmp-sourcequench, icmp-redirect, icmp-echo, icmp-routeradvert,icmp-routersolicit, icmp-timx-ceed, icmp-paramprob, icmp-tstamp, icmp-tstampreply,icmp-ireq, icmp-ireqreply, icmp-maskreq, icmp-maskreply</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="62--基于包大小进行过滤">6.2  基于包大小进行过滤<a href="#62--基于包大小进行过滤" class="hash-link" aria-label="6.2  基于包大小进行过滤的直接链接" title="6.2  基于包大小进行过滤的直接链接">​</a></h3>
<p>若你想查看指定大小的数据包，也是可以的</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump less 32 $ tcpdump greater 64 $ tcpdump &lt;= 128</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="63-根据-mac-地址进行过滤">6.3 根据 mac 地址进行过滤<a href="#63-根据-mac-地址进行过滤" class="hash-link" aria-label="6.3 根据 mac 地址进行过滤的直接链接" title="6.3 根据 mac 地址进行过滤的直接链接">​</a></h3>
<p>例子如下，其中 ehost 是记录在 /etc/ethers 里的 name</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump ether host [ehost]$ tcpdump ether dst    [ehost]$ tcpdump ether src    [ehost]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="64-过滤通过指定网关的数据包">6.4 过滤通过指定网关的数据包<a href="#64-过滤通过指定网关的数据包" class="hash-link" aria-label="6.4 过滤通过指定网关的数据包的直接链接" title="6.4 过滤通过指定网关的数据包的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump gateway [host]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="65-过滤广播多播数据包">6.5 过滤广播/多播数据包<a href="#65-过滤广播多播数据包" class="hash-link" aria-label="6.5 过滤广播/多播数据包的直接链接" title="6.5 过滤广播/多播数据包的直接链接">​</a></h3>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump ether broadcast$ tcpdump ether multicast$ tcpdump ip broadcast$ tcpdump ip multicast$ tcpdump ip6 multicast</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="柒---如何抓取到更精准的包"><strong><div id="qi">柒 - 如何抓取到更精准的包？</div></strong><a href="#柒---如何抓取到更精准的包" class="hash-link" aria-label="柒---如何抓取到更精准的包的直接链接" title="柒---如何抓取到更精准的包的直接链接">​</a></h2>
<p>先给你抛出一个问题：如果我只想抓取 HTTP 的 POST 请求该如何写呢？</p>
<p>如果只学习了上面的内容，恐怕你还是无法写法满足这个抓取需求的过滤器。</p>
<p>在学习之前，我先给出答案，然后再剖析一下，这个过滤器是如何生效的，居然能让我们对包内的内容进行判断。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -s 0 -A -vv &#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4]&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>命令里的可选参数，在前面的内容里已经详细讲过了。这里不再细讲。</p>
<p>本节的重点是引号里的内容，看起来很复杂的样子。</p>
<p>将它逐一分解，我们只要先理解了下面几种用法，就能明白</p>
<ul>
<li>
<p><code>tcp[n]</code>：表示 tcp 报文里 第 n 个字节</p>
</li>
<li>
<p><code>tcp[n:c]</code>：表示 tcp 报文里从第n个字节开始取 c 个字节，tcp[12:1] 表示从报文的第12个字节（因为有第0个字节，所以这里的12其实表示的是13）开始算起取一个字节，也就是 8 个bit。查看 tcp 的报文首部结构，可以得知这 8 个bit 其实就是下图中的红框圈起来的位置，而在这里我们只要前面 4个bit，也就是实际数据在整个报文首部中的偏移量。</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/web/assets/images/1503193-20230306234023292-348206778-83407daeb58337ffe3316fdd6a0f3985.png" width="1080" height="328" class="img_ev3q"></p>
</li>
<li>
<p><code>&amp;</code>：是位运算里的 and 操作符，比如 <code>0011 &amp; 0010 = 0010</code></p>
</li>
<li>
<p><code>&gt;&gt;</code>：是位运算里的右移操作，比如 <code>0111 &gt;&gt; 2 = 0011</code></p>
</li>
<li>
<p><code>0xf0</code>：是 10 进制的 240 的 16 进制表示，但对于位操作来说，10进制和16进制都将毫无意义，我们需要的是二进制，将其转换成二进制后是：11110000，这个数有什么特点呢？前面个 4bit 全部是 1，后面4个bit全部是0，往后看你就知道这个特点有什么用了。</p>
</li>
</ul>
<p>分解完后，再慢慢合并起来看</p>
<p>1、<code>tcp[12:1] &amp; 0xf0</code> 其实并不直观，但是我们将它换一种写法，就好看多了，假设 tcp 报文中的 第12 个字节是这样组成的 <code>10110000</code>，那么这个表达式就可以变成 10110110 &amp;&amp; 11110000 = 10110000，得到了 10110000 后，再进入下一步。</p>
<p>2、<code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> ：如果你不理解 tcp 报文首部里的数据偏移，请先点击这个前往我的<a href="http://mp.weixin.qq.com/s?__biz=MzIzMzMzOTI3Nw==&amp;mid=2247488180&amp;idx=1&amp;sn=09526224732ebfcccb52847f27298c70&amp;chksm=e8867256dff1fb40c9f47bafd0e87a9237c5a9ebf33c8a3d0a598276b496d29cdaa3fbff8d26&amp;scene=21#wechat_redirect" target="_blank" rel="noopener noreferrer">上一篇文章</a>，搞懂数据偏移的意义，否则我保证你这里会绝对会听懵了。</p>
<p><code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> 这个表达式实际是 <code>(tcp[12:1] &amp; 0xf0) &gt;&gt; 4 ) &lt;&lt; 2</code> 的简写形式。所以要搞懂 <code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> 只要理解了<code>(tcp[12:1] &amp; 0xf0) &gt;&gt; 4 ) &lt;&lt; 2</code>  就行了 。</p>
<p>从上一步我们算出了 <code>tcp[12:1] &amp; 0xf0</code>  的值其实是一个字节，也就是 8 个bit，但是你再回去看下上面的 tcp 报文首部结构图，表示数据偏移量的只有 4个bit，也就是说 上面得到的值 10110000，前面 4 位（1011）才是正确的偏移量，那么为了得到 1011，只需要将 10110000 右移4位即可，也就是 <code>tcp[12:1] &amp; 0xf0) &gt;&gt; 4</code>，至此我们是不是已经得出了实际数据的正确位置呢，很遗憾还没有，前一篇文章里我们讲到 Data Offset 的单位是 4个字节，因为要将 1011 乘以 4才可以，除以4在位运算中相当于左移2位，也就是 <code>&lt;&lt;2</code>，与前面的 <code>&gt;&gt;4</code> 结合起来一起算的话，最终的运算可以简化为 <code>&gt;&gt;2</code></p>
<p>至此，我们终于得出了实际数据开始的位置是 <code>tcp[12:1] &amp; 0xf0) &gt;&gt; 2</code> （单位是字节）。</p>
<p>找到了数据的起点后，可别忘了我们的目的是从数据中打到 HTTP 请求的方法，是 GET 呢 还是 POST ，或者是其他的？</p>
<p>有了上面的经验，我们自然懂得使用 <code>tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4]</code> 从数据开始的位置再取出四个字节，然后将结果与 <code>GET</code> （注意 GET最后还有个空格）的 16进制写法（也就是 <code>0x47455420</code>）进行比对。</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">0x47   --&gt;   71    --&gt;  G0x45   --&gt;   69    --&gt;  E0x54   --&gt;   84    --&gt;  T0x20   --&gt;   32    --&gt;  空格</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" alt="图片" src="/web/assets/images/1503193-20230306234023913-1472253510-83edb8129f502be56d56c9f123a5dd3c.png" width="1080" height="762" class="img_ev3q"></p>
<p>如果相等，则该表达式为True，tcpdump 认为这就是我们所需要抓的数据包，将其输出到我们的终端屏幕上。</p>
<p><img decoding="async" loading="lazy" alt="图片" src="data:image/png;base64,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" width="340" height="57" class="img_ev3q"></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="捌---抓包实战应用例子"><strong><div id="ba">捌 - 抓包实战应用例子</div></strong><a href="#捌---抓包实战应用例子" class="hash-link" aria-label="捌---抓包实战应用例子的直接链接" title="捌---抓包实战应用例子的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="以下例子摘自httpsfuckcloudnativeiopoststcpdump-examples">以下例子摘自：<em><a href="https://fuckcloudnative.io/posts/tcpdump-examples/" target="_blank" rel="noopener noreferrer">https://fuckcloudnative.io/posts/tcpdump-examples/</a></em><a href="#以下例子摘自httpsfuckcloudnativeiopoststcpdump-examples" class="hash-link" aria-label="以下例子摘自httpsfuckcloudnativeiopoststcpdump-examples的直接链接" title="以下例子摘自httpsfuckcloudnativeiopoststcpdump-examples的直接链接">​</a></h3>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="81-提取-http-的-user-agent">8.1 提取 HTTP 的 User-Agent<a href="#81-提取-http-的-user-agent" class="hash-link" aria-label="8.1 提取 HTTP 的 User-Agent的直接链接" title="8.1 提取 HTTP 的 User-Agent的直接链接">​</a></h3>
<p>从 HTTP 请求头中提取 HTTP 用户代理：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -nn -A -s1500 -l | grep &quot;User-Agent:&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>通过 <code>egrep</code> 可以同时提取用户代理和主机名（或其他头文件）：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -nn -A -s1500 -l | egrep -i &#x27;User-Agent:|Host:&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="82-抓取-http-get-和-post-请求">8.2 抓取 HTTP GET 和 POST 请求<a href="#82-抓取-http-get-和-post-请求" class="hash-link" aria-label="8.2 抓取 HTTP GET 和 POST 请求的直接链接" title="8.2 抓取 HTTP GET 和 POST 请求的直接链接">​</a></h3>
<p>抓取 HTTP GET 请求包：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -s 0 -A -vv &#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420&#x27;# or$ tcpdump -vvAls0 | grep &#x27;GET&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>可以抓取 HTTP POST 请求包：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -s 0 -A -vv &#x27;tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504f5354&#x27;# or $ tcpdump -vvAls0 | grep &#x27;POST&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意：该方法不能保证抓取到 HTTP POST 有效数据流量，因为一个 POST 请求会被分割为多个 TCP 数据包。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="83-找出发包数最多的-ip">8.3 找出发包数最多的 IP<a href="#83-找出发包数最多的-ip" class="hash-link" aria-label="8.3 找出发包数最多的 IP的直接链接" title="8.3 找出发包数最多的 IP的直接链接">​</a></h3>
<p>找出一段时间内发包最多的 IP，或者从一堆报文中找出发包最多的 IP，可以使用下面的命令：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -nnn -t -c 200 | cut -f 1,2,3,4 -d &#x27;.&#x27; | sort | uniq -c | sort -nr | head -n 20</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<ul>
<li>
<p><strong>cut -f 1,2,3,4 -d &#x27;.&#x27;</strong> : 以 <code>.</code> 为分隔符，打印出每行的前四列。即 IP 地址。</p>
</li>
<li>
<p><strong>sort | uniq -c</strong> : 排序并计数</p>
</li>
<li>
<p><strong>sort -nr</strong> : 按照数值大小逆向排序</p>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="84-抓取-dns-请求和响应">8.4 抓取 DNS 请求和响应<a href="#84-抓取-dns-请求和响应" class="hash-link" aria-label="8.4 抓取 DNS 请求和响应的直接链接" title="8.4 抓取 DNS 请求和响应的直接链接">​</a></h3>
<p>DNS 的默认端口是 53，因此可以通过端口进行过滤</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -i any -s0 port 53</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="85-切割-pcap-文件">8.5 切割 pcap 文件<a href="#85-切割-pcap-文件" class="hash-link" aria-label="8.5 切割 pcap 文件的直接链接" title="8.5 切割 pcap 文件的直接链接">​</a></h3>
<p>当抓取大量数据并写入文件时，可以自动切割为多个大小相同的文件。例如，下面的命令表示每 3600 秒创建一个新文件 <code>capture-(hour).pcap</code>，每个文件大小不超过 <code>200*1000000</code> 字节：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump  -w /tmp/capture-%H.pcap -G 3600 -C 200</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这些文件的命名为 <code>capture-{1-24}.pcap</code>，24 小时之后，之前的文件就会被覆盖。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="86-提取-http-post-请求中的密码">8.6 提取 HTTP POST 请求中的密码<a href="#86-提取-http-post-请求中的密码" class="hash-link" aria-label="8.6 提取 HTTP POST 请求中的密码的直接链接" title="8.6 提取 HTTP POST 请求中的密码的直接链接">​</a></h3>
<p>从 HTTP POST 请求中提取密码和主机名：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -s 0 -A -n -l | egrep -i &quot;POST /|pwd=|passwd=|password=|Host:&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="87-提取-http-请求的-url">8.7 提取 HTTP 请求的 URL<a href="#87-提取-http-请求的-url" class="hash-link" aria-label="8.7 提取 HTTP 请求的 URL的直接链接" title="8.7 提取 HTTP 请求的 URL的直接链接">​</a></h3>
<p>提取 HTTP 请求的主机名和路径：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump -s 0 -v -n -l | egrep -i &quot;POST /|GET /|Host:&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="88-抓取-http-有效数据包">8.8 抓取 HTTP 有效数据包<a href="#88-抓取-http-有效数据包" class="hash-link" aria-label="8.8 抓取 HTTP 有效数据包的直接链接" title="8.8 抓取 HTTP 有效数据包的直接链接">​</a></h3>
<p>抓取 80 端口的 HTTP 有效数据包，排除 TCP 连接建立过程的数据包（SYN / FIN / ACK）：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ tcpdump &#x27;tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="89-结合-wireshark-进行分析">8.9 结合 Wireshark 进行分析<a href="#89-结合-wireshark-进行分析" class="hash-link" aria-label="8.9 结合 Wireshark 进行分析的直接链接" title="8.9 结合 Wireshark 进行分析的直接链接">​</a></h3>
<p>通常 <code>Wireshark</code>（或 tshark）比 tcpdump 更容易分析应用层协议。一般的做法是在远程服务器上先使用 <code>tcpdump</code> 抓取数据并写入文件，然后再将文件拷贝到本地工作站上用 <code>Wireshark</code> 分析。</p>
<p>还有一种更高效的方法，可以通过 ssh 连接将抓取到的数据实时发送给 Wireshark 进行分析。以 MacOS 系统为例，可以通过 <code>brew cask install wireshark</code> 来安装，然后通过下面的命令来分析：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh root@remotesystem &#x27;tcpdump -s0 -c 1000 -nn -w - not port 22&#x27; | /Applications/Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>例如，如果想分析 DNS 协议，可以使用下面的命令：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ ssh root@remotesystem &#x27;tcpdump -s0 -c 1000 -nn -w - port 53&#x27; | /Applications/Wireshark.app/Contents/MacOS/Wireshark -k -i -</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>抓取到的数据：</p>
<p><img decoding="async" loading="lazy" alt="图片" src="/web/assets/images/1503193-20230306234023472-1931946480-fa16a8ae9791d086a0ebdbf06c67eaa9.png" width="1080" height="857" class="img_ev3q"></p>
<p><code>-c</code> 选项用来限制抓取数据的大小。如果不限制大小，就只能通过 <code>ctrl-c</code> 来停止抓取，这样一来不仅关闭了 tcpdump，也关闭了 wireshark。</p>
<p>到这里，我已经将我所知道的 tcpdump 的用法全部说了一遍，如果你有认真地看完本文，相信会有不小的收获，掌握一个上手的抓包工具，对于以后我们学习网络、分析网络协议、以及定位网络问题，会很有帮助，而 tcpdump 是我推荐的一个抓包工具。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/web/docs/Linux/Socat 命令总结"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Socat 命令总结</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/web/docs/Linux/基于 Linux 的三种防火墙（IPtables、Firewall、UFW）"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">基于 Linux 的三种防火墙（IPtables、Firewall、UFW）</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#导航" class="table-of-contents__link toc-highlight"><strong>导航</strong></a></li><li><a href="#壹---tcpdump-核心参数图解" class="table-of-contents__link toc-highlight"><strong><div>壹 - tcpdump 核心参数图解</div></strong></a></li><li><a href="#贰---理解-tcpdump-的输出" class="table-of-contents__link toc-highlight"><strong><div>贰 - 理解 tcpdump 的输出</div></strong></a><ul><li><a href="#21-输出内容结构" class="table-of-contents__link toc-highlight">2.1 输出内容结构</a></li><li><a href="#22-flags-标识符" class="table-of-contents__link toc-highlight">2.2 Flags 标识符</a></li></ul></li><li><a href="#叁---常规过滤规则" class="table-of-contents__link toc-highlight"><strong><div>叁 - 常规过滤规则</div></strong></a><ul><li><a href="#31-基于ip地址过滤host" class="table-of-contents__link toc-highlight">3.1 基于IP地址过滤：host</a></li><li><a href="#32-基于网段进行过滤net" class="table-of-contents__link toc-highlight">3.2 基于网段进行过滤：net</a></li><li><a href="#33-基于端口进行过滤port" class="table-of-contents__link toc-highlight">3.3 基于端口进行过滤：port</a></li><li><a href="#34-基于协议进行过滤proto" class="table-of-contents__link toc-highlight">3.4 基于协议进行过滤：proto</a></li><li><a href="#35-基本ip协议的版本进行过滤" class="table-of-contents__link toc-highlight">3.5 基本IP协议的版本进行过滤</a></li></ul></li><li><a href="#肆---可选参数解析" class="table-of-contents__link toc-highlight"><strong><div>肆 - 可选参数解析</div></strong></a><ul><li><a href="#41-设置不解析域名提升速度" class="table-of-contents__link toc-highlight">4.1 设置不解析域名提升速度</a></li><li><a href="#42-过滤结果输出到文件" class="table-of-contents__link toc-highlight">4.2 过滤结果输出到文件</a></li><li><a href="#43-从文件中读取包数据" class="table-of-contents__link toc-highlight">4.3 从文件中读取包数据</a></li><li><a href="#44-控制详细内容的输出" class="table-of-contents__link toc-highlight">4.4 控制详细内容的输出</a></li><li><a href="#45-控制时间的显示" class="table-of-contents__link toc-highlight">4.5 控制时间的显示</a></li><li><a href="#46-显示数据包的头部" class="table-of-contents__link toc-highlight">4.6 显示数据包的头部</a></li><li><a href="#47-过滤指定网卡的数据包" class="table-of-contents__link toc-highlight">4.7 过滤指定网卡的数据包</a></li><li><a href="#48-过滤特定流向的数据包" class="table-of-contents__link toc-highlight">4.8 过滤特定流向的数据包</a></li><li><a href="#49-其他常用的一些参数" class="table-of-contents__link toc-highlight">4.9 其他常用的一些参数</a></li><li><a href="#410-对输出内容进行控制的参数" class="table-of-contents__link toc-highlight">4.10 对输出内容进行控制的参数</a></li></ul></li><li><a href="#伍---过滤规则组合" class="table-of-contents__link toc-highlight"><strong><div>伍 - 过滤规则组合</div></strong></a></li><li><a href="#陆---特殊过滤规则" class="table-of-contents__link toc-highlight"><strong><div>陆 - 特殊过滤规则</div></strong></a><ul><li><a href="#61-根据-tcpflags-进行过滤" class="table-of-contents__link toc-highlight">6.1 根据 tcpflags 进行过滤</a></li><li><a href="#62--基于包大小进行过滤" class="table-of-contents__link toc-highlight">6.2  基于包大小进行过滤</a></li><li><a href="#63-根据-mac-地址进行过滤" class="table-of-contents__link toc-highlight">6.3 根据 mac 地址进行过滤</a></li><li><a href="#64-过滤通过指定网关的数据包" class="table-of-contents__link toc-highlight">6.4 过滤通过指定网关的数据包</a></li><li><a href="#65-过滤广播多播数据包" class="table-of-contents__link toc-highlight">6.5 过滤广播/多播数据包</a></li></ul></li><li><a href="#柒---如何抓取到更精准的包" class="table-of-contents__link toc-highlight"><strong><div>柒 - 如何抓取到更精准的包？</div></strong></a></li><li><a href="#捌---抓包实战应用例子" class="table-of-contents__link toc-highlight"><strong><div>捌 - 抓包实战应用例子</div></strong></a><ul><li><a href="#以下例子摘自httpsfuckcloudnativeiopoststcpdump-examples" class="table-of-contents__link toc-highlight">以下例子摘自：<em>https://fuckcloudnative.io/posts/tcpdump-examples/</em></a></li><li><a href="#81-提取-http-的-user-agent" class="table-of-contents__link toc-highlight">8.1 提取 HTTP 的 User-Agent</a></li><li><a href="#82-抓取-http-get-和-post-请求" class="table-of-contents__link toc-highlight">8.2 抓取 HTTP GET 和 POST 请求</a></li><li><a href="#83-找出发包数最多的-ip" class="table-of-contents__link toc-highlight">8.3 找出发包数最多的 IP</a></li><li><a href="#84-抓取-dns-请求和响应" class="table-of-contents__link toc-highlight">8.4 抓取 DNS 请求和响应</a></li><li><a href="#85-切割-pcap-文件" class="table-of-contents__link toc-highlight">8.5 切割 pcap 文件</a></li><li><a href="#86-提取-http-post-请求中的密码" class="table-of-contents__link toc-highlight">8.6 提取 HTTP POST 请求中的密码</a></li><li><a href="#87-提取-http-请求的-url" class="table-of-contents__link toc-highlight">8.7 提取 HTTP 请求的 URL</a></li><li><a href="#88-抓取-http-有效数据包" class="table-of-contents__link toc-highlight">8.8 抓取 HTTP 有效数据包</a></li><li><a href="#89-结合-wireshark-进行分析" class="table-of-contents__link toc-highlight">8.9 结合 Wireshark 进行分析</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/web/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>